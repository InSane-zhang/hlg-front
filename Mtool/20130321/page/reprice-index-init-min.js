KISSY.add("page/reprice-index-init",function(a,b){var c=a.DOM,d=a.Event;return reprice={panel:null,msg:null,init:function(){reprice.panel=new b.Dialog({width:500,headerContent:"\u786e\u8ba4\u63d0\u4ea4",bodyContent:"",mask:!1,align:{points:["cc","cc"]},closable:!0,draggable:!0,aria:!0}),d.on("#J_BtnPublish","click",function(){if(!showPermissions("editor_tool","\u5de5\u5177\u7bb1"))return;if(isVersionPer("tool"))return;var a=IsExpired();if(a>-5e3){var b=function(a){var b="",e="\u60a8\u5f53\u524d\u8bbe\u7f6e\u7684\u6539\u4ef7\u65b9\u6848\u4e3a\uff1a<br>";if(c.attr("#J_Modifytype_1","checked"))e+='\u7edf\u4e00\u4ef7:<font color="red">'+c.val("#J_Samevalue")+"</font>";else{e+='\u539f\u4ef7 X <font color="red">'+c.val("#J_Percent")+"</font>%";var f=parseFloat(c.val("#J_PriceDiff"));f>=0?e+=' + <font color="red">'+f+"</font>.":e+=' - <font color="red">'+f*-1+"</font>.",e+=" <br>\u5982\u539f\u4ef7=100\uff0c\u6539\u540e\u4ef7="+(parseFloat(c.val("#J_Percent"))+f)+"."}e+="<br>\u70b9\u51fb\u3010\u786e\u5b9a\u3011\u5f00\u59cb\u4fee\u6539\u4ef7\u683c\uff0c\u6539\u5b8c\u540e\u65e0\u6cd5\u6062\u590d\uff0c\u60a8\u786e\u8ba4\u8981\u8fdb\u884c\u4fee\u6539\u5417\uff1f",b='<div class="point" style="height: 150px;"><div class="point-w" style="height: auto;"><span class="point-img-2"></span><span class=""><span id="J_ScheMess">'+e+'</span><div class="btm-content btm-margin-15auto" style="width:160px;"><input type="button" id="J_Sure" class="btm-68-orange fl" value="\u786e\u5b9a" /><input type="button" id="J_Cancel" class="btm-68-gray fl" value="\u53d6\u6d88" /></div></div></div>',reprice.panel.set("bodyContent",b),reprice.panel.show(),d.remove("#J_Sure"),d.remove("#J_Cancel"),d.on("#J_Sure","click",function(a){if(isVersionPer("tool"))return;a.preventDefault();if(!reprice.checkForm())return reprice.panel.hide(),!1;reprice.msg=new H.widget.msgBox({type:"error",content:"\u7cfb\u7edf\u6b63\u5728\u5904\u7406\u4e2d",dialogType:"loading"}),c.get("#J_subform").submit()}),d.on("#J_Cancel","click",function(a){a.preventDefault(),reprice.panel.hide();return});return},e=function(a){KISSY.Event.fire(".J_TopExpired","click")},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(b).setErrorHandle(e).setData(f).send()}else{var g="",h="\u60a8\u5f53\u524d\u8bbe\u7f6e\u7684\u6539\u4ef7\u65b9\u6848\u4e3a\uff1a<br>";if(c.attr("#J_Modifytype_1","checked"))h+='\u7edf\u4e00\u4ef7:<font color="red">'+c.val("#J_Samevalue")+"</font>";else{h+='\u539f\u4ef7 X <font color="red">'+c.val("#J_Percent")+"</font>%";var i=parseFloat(c.val("#J_PriceDiff"));i>=0?h+=' + <font color="red">'+i+"</font>.":h+=' - <font color="red">'+i*-1+"</font>.",h+=" <br>\u5982\u539f\u4ef7=100\uff0c\u6539\u540e\u4ef7="+(parseFloat(c.val("#J_Percent"))+i)+"."}h+="<br>\u70b9\u51fb\u3010\u786e\u5b9a\u3011\u5f00\u59cb\u4fee\u6539\u4ef7\u683c\uff0c\u6539\u5b8c\u540e\u65e0\u6cd5\u6062\u590d\uff0c\u60a8\u786e\u8ba4\u8981\u8fdb\u884c\u4fee\u6539\u5417\uff1f",g='<div class="point" style="height: 150px;"><div class="point-w" style="height: auto;"><span class="point-img-2"></span><span class=""><span id="J_ScheMess">'+h+'</span><div class="btm-content btm-margin-15auto" style="width:160px;"><input type="button" id="J_Sure" class="btm-68-orange fl" value="\u786e\u5b9a" /><input type="button" id="J_Cancel" class="btm-68-gray fl" value="\u53d6\u6d88" /></div></div></div>',reprice.panel.set("bodyContent",g),reprice.panel.show(),d.remove("#J_Sure"),d.remove("#J_Cancel"),d.on("#J_Sure","click",function(a){if(isVersionPer("tool"))return;a.preventDefault();if(!reprice.checkForm())return reprice.panel.hide(),!1;reprice.msg=new H.widget.msgBox({type:"error",content:"\u7cfb\u7edf\u6b63\u5728\u5904\u7406\u4e2d",dialogType:"loading"}),c.get("#J_subform").submit()}),d.on("#J_Cancel","click",function(a){a.preventDefault(),reprice.panel.hide();return})}})},toggleCal:function(){c.attr("#J_Modifytype_1","checked")?c.hide(".J_CalStrategy"):c.show(".J_CalStrategy")},checkForm:function(){if(!reprice.checkCategory())return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u8bf7\u9009\u62e9\u8981\u4fee\u6539\u7684\u5206\u7c7b\uff01",type:"error",autoClose:!0,timeOut:2e3}),!1;if(!c.attr("#J_Modifyonsale","checked")&&!c.attr("#J_Modifyinstock","checked"))return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u8bf7\u9009\u62e9\u8981\u4fee\u6539\u7684\u5206\u7c7b\uff01",type:"error",autoClose:!0,timeOut:2e3}),alert("\u9009\u62e9\u8981\u4fee\u6539\u7684\u8303\u56f4\uff01"),!1;if(c.attr("#J_Modifytype_1","checked")){if(a.trim(c.val("#J_Samevalue"))=="")return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u5bf9\u4e0d\u8d77\uff0c\u8bf7\u8f93\u5165\u7edf\u4e00\u4ef7\uff01",type:"error",autoClose:!0,timeOut:2e3}),!1}else{var b=a.trim(c.val("#J_Percent")),d=a.trim(c.val("#J_PriceDiff")),e=/^[\+\-]?[0-9]+(\.[0-9]{1,2})?$/;if(parseInt(b)<=0)return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u767e\u5206\u6bd4\u5fc5\u987b\u5927\u4e8e0\uff0c\u8bf7\u786e\u8ba4\uff01",type:"error",autoClose:!0,timeOut:2e3}),!1;if(d!=""&&!e.test(d))return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u5bf9\u4e0d\u8d77\uff0c\u60a8\u8f93\u5165\u7684\u5dee\u4ef7\u5fc5\u987b\u662f\u6570\u5b57\uff0c\u53ef\u4ee5\u652f\u6301\u5c0f\u6570\u70b9\u540e2\u4f4d\uff01",type:"error",autoClose:!0,timeOut:2e3}),!1}return!0},checkCategory:function(){var a=document.getElementsByName("category[]");for(var b=0;b<a.length;b++)if(a[b].checked)return!0;return!1}}},{requires:["overlay"]}); 