KISSY.add("page/configure-importdata-init",function(a,b,c){var d=a.DOM,e=a.Event;return importdataControl={msg:null,msg1:null,dialog:null,flag:!0,init:function(){e.on("#J_userAccouts","focus",function(a){d.val("#J_userAccouts")=="\u8bf7\u8f93\u5165\u60a8\u7684\u652f\u4ed8\u5b9d\u8d26\u53f7\u540d\u79f0"&&d.val("#J_userAccouts","")}),e.on("#J_userAccouts","blur",function(a){d.val("#J_userAccouts")==""&&d.val("#J_userAccouts","\u8bf7\u8f93\u5165\u60a8\u7684\u652f\u4ed8\u5b9d\u8d26\u53f7\u540d\u79f0")}),e.on("#J_inportData","click",function(){var a=d.val("#J_userAccouts");d.val("#J_account",a);var b=function(a){var b=a.payload;d.val("#J_status",b);if(b==""){var c=d.val("#J_userAccouts");importdataControl.checkEMail(c)}else importdataControl.showPop()},c="&account="+a;(new H.widget.asyncRequest).setURI(educeStartUrl).setMethod("GET").setHandle(b).setData(c).send()})},checkEMail:function(a){var b=/(^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$)|(^1[0-9]{10}$)/;if(!b.test(a))return new H.widget.msgBox({title:"",content:"\u652f\u4ed8\u5e10\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e",type:"error"}),!1;if(a=="\u8bf7\u8f93\u5165\u60a8\u7684\u652f\u4ed8\u5b9d\u8d26\u53f7\u540d\u79f0")return new H.widget.msgBox({title:"",content:"\u652f\u4ed8\u5e10\u53f7\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a",type:"error"}),!1;importdataControl.showPop()},showPop:function(){var a=d.val("#J_account");if(!importdataControl.dialog){importdataControl.dialog=new c.Dialog({width:380,height:210,mask:!0,buttons:[{text:"\u5b8c\u6210\u6388\u6743",elCls:"bui-button bui-button-primary",handler:function(){var a=d.val("#J_account"),b=function(a){var b=a.payload;b==""?(new H.widget.msgBox({type:"sucess",content:"\u6388\u6743\u6210\u529f",dialogType:"msg",autoClose:!0,timeOut:3e3}),importdataControl.importData()):new H.widget.msgBox({type:"error",content:"\u6388\u6743\u5931\u8d25",dialogType:"msg",autoClose:!0,timeOut:3e3})};this.hide();var c="&account="+a;(new H.widget.asyncRequest).setURI(educeStartUrl).setMethod("GET").setHandle(b).setData(c).send()}},{text:"\u53d6\u6d88",elCls:"bui-button",handler:function(){this.hide()}}]});var b=d.val("#J_status"),e='<div style="text-align:center;"><div class="ui-confirm-message-content" style="color:#656D7A;font-size:15px;height:20px;line-height:20px;margin-bottom:5px;font-weight:bold;">\u8bf7\u5230\u65b0\u6253\u5f00\u9875\u7684\u6388\u6743\u9875\u9762\u5b8c\u6210\u652f\u4ed8\u5b9d\u6388\u6743</div><p>\u652f\u4ed8\u5b9d\u5e10\u53f7\uff1a'+a+'<a href="'+b+'">\u53bb\u6388\u6743</a></p></div>';importdataControl.dialog.set("bodyContent",e),importdataControl.dialog.render(),importdataControl.dialog.show()}},importData:function(){var b=a.later(function(){var a=function(a){var c=a.payload;d.val("#J_importVal",c);var c=d.val("#J_importVal");c==100?(b.cancel(),importdataControl.msg1.hide(),new H.widget.msgBox({type:"sucess",content:"\u6570\u636e\u5bfc\u5165\u6210\u529f",dialogType:"msg",autoClose:!0,timeOut:5e3}),importdataControl.getStatusProgress()):importdataControl.msg1||(importdataControl.msg1=new H.widget.msgBox({dialogType:"loading",content:"\u6b63\u5728\u4e3a\u60a8\u52a0\u8f7d\u652f\u4ed8\u5b9d\u6570\u636e\u5230\u8d22\u52a1\u7ba1\u7406\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85..."}))};(new H.widget.asyncRequest).setURI(rateUrl).setMethod("GET").setHandle(a).setData(null).send()},1e3,!0)},getStatusProgress:function(){d.hide(".J_stepOne"),d.show(".J_costSet");var a=function(a){totalRecords=a.payload.totalRecords;var b=a.payload.already,c=a.payload.all,e=c-b;c==b&&(d.show(".J_setSuccess"),d.hide(".J_baobeiSet")),d.removeClass(".J_step1","current"),d.addClass(".J_step2","current"),d.html(".J_already",b),d.html(".J_all",c);var f=(b/c*100).toFixed(2)+"%";d.css("#J_ui-progress1","width",f),d.html(".J_less",e)};(new H.widget.asyncRequest).setURI(getCostsSetUrl).setMethod("GET").setHandle(a).setData(null).send()}}},{requires:["bui/tooltip","bui/overlay"]}); 