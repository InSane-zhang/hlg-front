KISSY.add("page/mods/icon-control",function(S,showPages,Overlay){return iconControl={mode:0,commIcons:null,commDesignIcons:null,smartIcons:null,meIcons:null,designIconPanel:null,currentIconType:null,currentIconId:null,currentPositionId:0,currentColorId:0,customString:!1,currentIconPic:null,currentXmlPath:null,currentItemId:null,currentItemPic:null,commPaginator:null,commDesignPaginator:null,smartPaginator:null,mePaginator:null,initCommFlag:!1,initCommDesignFlag:!1,initSmartFlag:!1,initMeFlag:!1,initDesignFlag:!1,pageId:1,totalRecords:0,currentMode:"comm",msg:null,show:function(a){iconControl.currentMode=a;var b=!1;a=="comm"&&!iconControl.initCommFlag&&(b=!0),a=="commDesign"&&!iconControl.initCommDesignFlag&&(b=!0),a=="smart"&&!iconControl.initSmartFlag&&(b=!0),a=="me"&&!iconControl.initMeFlag&&(b=!0),b&&iconControl.getIcons(1,1)},getIcons:function(pageId,frontPageId){var data="mode="+iconControl.currentMode+"&page_id="+pageId,submitHandle=function(o){DOM.hide("#J_LeftLoading"),DOM.show("#icon_list_content"),o=eval(o);switch(iconControl.currentMode){case"comm":iconControl.commIcons=o.icons;break;case"commDesign":iconControl.commDesignIcons=o.icons;break;case"smart":iconControl.smartIcons=o.icons;break;case"me":iconControl.meIcons=o.icons}iconControl.totalRecords=o.totalRecords;if(iconControl.initCommFlag&&iconControl.initCommDesignFlag&&iconControl.initSmartFlag&&iconControl.initMeFlag){iconControl.initIconList(frontPageId);return}if(iconControl.currentMode=="comm"&&!iconControl.initCommFlag){iconControl.initCommFlag=!0,iconControl.initPaginator();return}if(iconControl.currentMode=="commDesign"&&!iconControl.initCommDesignFlag){iconControl.initCommDesignFlag=!0,iconControl.initPaginator();return}if(iconControl.currentMode=="smart"&&!iconControl.initSmartFlag){iconControl.initSmartFlag=!0,iconControl.initPaginator();return}if(iconControl.currentMode=="me"&&!iconControl.initMeFlag){iconControl.initMeFlag=!0,iconControl.initPaginator();return}iconControl.initIconList(frontPageId)};DOM.show("#J_LeftLoading"),DOM.hide("#icon_list_content"),(new H.widget.asyncRequest).setURI(getIconsUrl).setMethod("GET").setHandle(submitHandle).setData(data).send()},initIconList:function(a){var b=Math.floor(a/iconControl.scale);b<Number(a/iconControl.scale)&&b++;switch(iconControl.currentMode){case"comm":var c=DOM.get("#J_CommIconList"),d=iconControl.commIcons;break;case"commDesign":var c=DOM.get("#J_CommDesignIconList"),d=iconControl.commDesignIcons;break;case"smart":var c=DOM.get("#J_SmartIconList"),d=iconControl.smartIcons;break;case"me":var c=DOM.get("#J_MeIconList"),d=iconControl.meIcons}if(b!=iconControl.pageId){iconControl.pageId=b,iconControl.getIcons(b,a);return}var e=a-(b-1)*iconControl.scale,f=iconControl.frontPageNum*(e-1),g=iconControl.frontPageNum*e;g>d.length&&(g=d.length);var h="";KISSY.UA.ie==6&&(c.innerHTML="");for(i=f;i<g;i++){var j=d[i].id,k=d[i].type;if(k=="1"||k=="3")var l=d[i].pic;else var l=d[i].pic+j+".png";if(KISSY.UA.ie==6){var m=document.createElement("img");m.className="icon",m.id=j,m.style.width="100px",m.style.height="100px",m.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+l+"', sizingMethod='crop')",m.src="http://cdn.huanleguang.com/space.gif";if(iconControl.currentMode=="me"){var n=document.createElement("span");n.className="iconDele";var o=document.createElement("a");o.className="iconDeletelink",o.href="javascript:void(0);",o.data=j,n.appendChild(m),n.appendChild(o),c.appendChild(n)}else c.appendChild(m)}else iconControl.currentMode=="me"?(h+='<span  class="iconDele">',h+='<img class="icon" width="100px" height="100px" id="'+j+'" src="'+l+'" />',h+='<a href="javascript:void(0)" data="'+j+'" class="iconDeletelink"></a></span>'):h+='<img class="icon" width="100px" height="100px" id="'+j+'" src="'+l+'" />'}KISSY.UA.ie!=6&&(c.innerHTML=h),iconControl.attachIconEvent()},attachIconEvent:function(){var a=function(a){switch(iconControl.currentMode){case"comm":var b=iconControl.commIcons;break;case"commDesign":var b=iconControl.commDesignIcons;break;case"smart":var b=iconControl.smartIcons;break;case"me":var b=iconControl.meIcons}DOM.removeClass(iconEls,"hightLight"),DOM.addClass(this,"hightLight"),iconControl.currentIconId=this.id;var c=b.length;for(i=0;i<c;i++)if(b[i].id==this.id){iconControl.initIcon(b[i]);break}};iconEls=DOM.query(".icon"),Event.on(iconEls,"click",a)},initIcon:function(a,b,c,d){iconControl.currentIconId=a.id,iconControl.currentIconType=a.type;var e=a.type;if(e=="1"||e=="3"){var f=a.pic;iconControl.currentIconPic=a.pic,iconControl.currentXmlPath=a.xml_path,DOM.addClass(DOM.get("#J_IconProperty"),"ks-hidden"),DOM.removeClass(DOM.get("#J_IconDesign"),"ks-hidden"),Event.on(DOM.query(".design-online"),"click",iconControl.showDesign)}else{DOM.removeClass(DOM.get("#J_IconProperty"),"ks-hidden"),DOM.addClass(DOM.get("#J_IconDesign"),"ks-hidden");var f=a.pic;positions=a.position.split(","),colors=a.color.split(","),b==null&&(b=0),c==null&&(c=0),iconControl.currentPositionId=b,iconControl.currentColorId=c;if(a.custom_prop!=null){customs=a.custom_prop.split(","),d!=null&&(d=d.split(",")),customInput="";var g="",h="",i="";for(var j=0;j<customs.length;j++)customStr=customs[j].split("_"),d!=null&&d[j]!=null&&(g=d[j]),customStr[1]!=null&&(i=customStr[1]),customStr[0]!=null&&(h=customStr[0]),customInput+="\u81ea\u5b9a\u4e49"+Number(j+1)+'\uff1a<input type="text" value="'+g+'" limit="'+h+'" name="custom[]" size="15" /> '+i+"<br />";DOM.get("#J_IconCustom").style.display="",DOM.get("#J_Custom").innerHTML=customInput}else DOM.get("#J_IconCustom").style.display="none",DOM.get("#J_Custom").innerHTML="";var k=a.id+"_"+positions[b]+"_"+(Number(c)+1);iconControl.initIconProperty(positions,colors,iconControl.currentPositionId,iconControl.currentColorId),f+=k+".png"}if(KISSY.UA.ie==6){var l=document.createElement("img");l.style.width="160px",l.style.height="160px",l.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+f+"', sizingMethod='crop')",l.src="http://cdn.huanleguang.com/space.gif",DOM.get("#J_IconPreviewBox").innerHTML="",DOM.get("#J_IconPreviewBox").appendChild(l)}else{var l='<img src="'+f+'"  style="width:160px;height:160px"/>';DOM.get("#J_IconPreviewBox").innerHTML=l}},initPaginator:function(){var a=Math.ceil(iconControl.totalRecords/iconControl.frontPageNum);switch(iconControl.currentMode){case"comm":iconControl.commPaginator=(new showPages("iconControl.commPaginator")).setRender(iconControl.paginationHandle).setPageCount(a).printHtml("#J_CommIconPaginator",2);break;case"commDesign":iconControl.commDesignPaginator=(new showPages("iconControl.commDesignPaginator")).setRender(iconControl.paginationHandle).setPageCount(a).printHtml("#J_CommDesignIconPaginator",2);break;case"smart":iconControl.smartPaginator=(new showPages("iconControl.smartPaginator")).setRender(iconControl.paginationHandle).setPageCount(a).printHtml("#J_SmartIconPaginator",2);break;case"me":iconControl.mePaginator=(new showPages("iconControl.mePaginator")).setRender(iconControl.paginationHandle).setPageCount(a).printHtml("#J_MeIconPaginator",2)}iconControl.initIconList(1)},paginationHandle:function(a){var b=a;iconControl.initIconList(b);switch(iconControl.currentMode){case"comm":iconControl.commPaginator.setPage(b).printHtml("#J_CommIconPaginator",2);break;case"commDesign":iconControl.commDesignPaginator.setPage(b).printHtml("#J_CommDesignIconPaginator",2);break;case"smart":iconControl.smartPaginator.setPage(b).printHtml("#J_SmartIconPaginator",2);break;case"me":iconControl.mePaginator.setPage(b).printHtml("#J_MeIconPaginator",2)}return},initIconProperty:function(a,b,c,d){var e=b.length,f="";for(var g=0;g<e;g++)g==d?selected="selected":selected="",f+='<li class="'+selected+'" data="'+g+'" style="background:#'+b[g]+';"><span title="\u989c\u8272" >\u989c\u8272</span></li>';DOM.html(DOM.get("#J_UlColor"),f),colorLis=DOM.query("#J_UlColor li");var h=function(){var a=this.getAttribute("data");if(iconControl.currentColorId==a)return;iconControl.currentColorId=a,DOM.removeClass(colorLis,"selected"),DOM.addClass(this,"selected"),m()};Event.on(colorLis,"click",h);var i=a.length,j="";for(var g=0;g<i;g++){var k=a[g];g==c?selected="selected":selected="";if(k==1){j+='<li data="1" position_id="'+g+'" class="icon-position p-lt '+selected+'"><span>\u5de6\u4e0a</span></li>';continue}if(k==2){j+='<li data="2" position_id="'+g+'" class="icon-position p-rt '+selected+'"><span>\u53f3\u4e0a</span></li>';continue}if(k==3){j+='<li data="3" position_id="'+g+'" class="icon-position p-rb '+selected+'"><span>\u53f3\u4e0b</span></li>';continue}if(k==4){j+='<li data="4" position_id="'+g+'" class="icon-position p-lb '+selected+'"><span>\u5de6\u4e0b</span></li>';continue}if(k==5){j+='<li data="5" position_id="'+g+'" class="icon-position p-t '+selected+'"><span>\u4e0a</span></li>';continue}if(k==6){j+='<li data="6" position_id="'+g+'" class="icon-position p-b '+selected+'"><span>\u4e0b</span></li>';continue}if(k==7){j+='<li data="7" position_id="'+g+'" class="icon-position p-l '+selected+'"><span>\u5de6</span></li>';continue}if(k==8){j+='<li data="8" position_id="'+g+'" class="icon-position p-r '+selected+'"><span>\u53f3</span></li>';continue}if(k==9){j+='<li data="9" position_id="'+g+'" class="icon-position p-r '+selected+'"><span>\u4e2d</span></li>';continue}}DOM.html(DOM.get("#J_UlPosition"),j),positionLis=DOM.query("#J_UlPosition li");var l=function(a){var b=this.getAttribute("data"),c=this.getAttribute("position_id");if(iconControl.currentPositionId==c)return;iconControl.currentPositionId=c,DOM.removeClass(positionLis,"selected"),DOM.addClass(this,"selected"),m()};Event.on(positionLis,"click",l);var m=function(){var b="http://img01.huanleguang.com/icon/",c="";if(iconControl.currentIconId==null)return alert("\u8bf7\u5148\u9009\u62e9\u4fc3\u9500\u6807\u7b7e"),!1;var d=a[iconControl.currentPositionId]+"_"+(Number(iconControl.currentColorId)+1);c=iconControl.currentIconId+"_"+d,b+=c+".png";if(KISSY.UA.ie==6){var e=document.createElement("img");e.style.width="160px",e.style.height="160px",e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b+"', sizingMethod='crop')",e.src="http://cdn.huanleguang.com/space.gif",DOM.get("#J_IconPreviewBox").innerHTML="",DOM.get("#J_IconPreviewBox").appendChild(e)}else{var e='<img src="'+b+'" style="width:160px;height:160px" />';DOM.get("#J_IconPreviewBox").innerHTML=e}}},showDesign:function(){if(iconControl.mode==1)var a=iconControl.currentItemPic+"_310x310.jpg";else var a="http://img03.taobaocdn.com/bao/uploaded/i3/T1xc4QXoppXXaxXvA9_073332.jpg_310x310.jpg";iconControl.designIcon(iconControl.currentIconId,iconControl.currentXmlPath,iconControl.currentItemId,a)},thisMovie:function(a){return navigator.appName.indexOf("Microsoft")!=-1?window[a]:document[a]},designIcon:function(a,b,c,d){var e={allowScriptAccess:"always",allowFullScreen:!0,base:"http://img01.huanleguang.com/main/"},f={mode:"2",designId:a,sid:sid,xmlUrl:b,productId:c,stageBg:d};if(!iconControl.initDesignFlag){var g=DOM.val("#J_ShopId");g==44281?swfobject.embedSWF("http://img01.huanleguang.com/main/Main.swf?v=50","hlgFlash","1080","575","7","expressInstall.swf",f,e):g==146483?swfobject.embedSWF("http://img01.huanleguang.com/main/Main.swf","hlgFlash","1080","575","7","expressInstall.swf",f,e):swfobject.embedSWF("http://img01.huanleguang.com/main/Main.swf?v=50","hlgFlash","1080","575","7","expressInstall.swf",f,e)}else iconControl.thisMovie("hlgFlash").initDesign(f);iconControl.designIconPanel||(iconControl.designIconPanel=new Overlay.Dialog({title:"\u7f16\u8f91\u4fc3\u9500\u56fe\u6807",width:1120,height:600,elAttrs:{id:"J_design_icon_panel"},mask:!1,footerStyle:{display:"none"}}),iconControl.designIconPanel.set("bodyContent",KISSY.clone(DOM.get("#hlgFlash"))),iconControl.designIconPanel.render(),iconControl.designIconPanel.on("hide",function(){DOM.get("#J_design_icon_panel").style.display="none",DOM.get("#hlgFlash").style.visibility="hidden"})),iconControl.designIconPanel.show(),DOM.get("#J_design_icon_panel").style.display="block"},designFinish:function(a,b,c){iconControl.currentIconId=a,iconControl.currentIconPic=c,iconControl.currentXmlPath=b,iconControl.initMeFlag&&(iconControl.initMeFlag=!1);if(KISSY.UA.ie==6){var d=document.createElement("img");d.style.width="160px",d.style.height="160px",d.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c+"', sizingMethod='crop')",d.src="http://cdn.huanleguang.com/space.gif",DOM.get("#J_IconPreviewBox").innerHTML="",DOM.get("#J_IconPreviewBox").appendChild(d)}else{var d='<img src="'+c+'" style="width:160px;height:160px" />';DOM.get("#J_IconPreviewBox").innerHTML=d}iconControl.currentMode=="commDesign"&&(DOM.addClass(DOM.get("#icon_list_commDesign_content"),"ks-hidden"),DOM.removeClass(DOM.get("#icon_list_me_content"),"ks-hidden"),DOM.addClass(DOM.get("#icon_list_me"),"active"),DOM.removeClass(DOM.get("#icon_list_commDesign"),"active")),DOM.get("#hlgFlash").style.visibility="hidden",iconControl.designIconPanel.hide()}}},{requires:["utils/showPages/index","bui/overlay"]}),KISSY.add("utils/showPages/index",function(a){function e(a){var b=this;if(!(b instanceof e))return new e(a);this.pageNum=4,this.name=a,this.page=1,this.pageCount=200,this.argName="page"}var b=a.DOM,c=a.Event,d=document;return a.mix(e.prototype,{jump:function(){return undefined},checkPages:function(){isNaN(parseInt(this.page))&&(this.page=1),isNaN(parseInt(this.pageCount))&&(this.pageCount=1),this.page<1&&(this.page=1),this.pageCount<1&&(this.pageCount=1),this.page>this.pageCount&&(this.page=this.pageCount),this.page=parseInt(this.page),this.pageCount=parseInt(this.pageCount)},_createHtml:function(a){var b=this,c="",d=this.page-1,e=this.page+1;if(a==""||typeof a=="undefined")a=1;switch(a){case 1:c+='<div class="page-bottom"> <div class="sabrosus">',c+='<font class="number">',c+="\u5171"+this.pageCount+"\u9875&nbsp;",c+='<input style="" type="text"  class="page-input" id="pageInput'+b.name+'"  value="\u9875\u7801" onkeypress="return window.'+b.name+".formatInputPage(event);\" onfocus=\"this.className='page-input page-input-text-on ';if(this.value=='\u9875\u7801'){this.value = '';}\" onblur=\"this.className='page-input';if(this.value==''){this.value = '\u9875\u7801'}\">",c+='<input type="button" value="Go" class="btm-go" onclick="javascript:var page = document.getElementById(\'pageInput'+b.name+"').value; if(isNaN(Number(page))|| Number(page)==0) { var turnTo = 1;} else if(page>"+this.pageCount+"){ var turnTo = "+this.pageCount+";} else{var turnTo = page;}  window."+b.name+'.toPage(turnTo);" >',c+="</font>",d<1?c+='<span class="pre-none page-pic-no"></span>':c+='<span title="\u4e0a\u4e00\u9875" class="pre page-pic-no" onclick="'+b.name+".toPage("+d+');"></span>',e>this.pageCount?c+='<span class="next-none page-pic-no"></span>':c+='<span title="\u4e0b\u4e00\u9875" class="next page-pic-no" onclick="'+b.name+".toPage("+e+');"></span>',c+='<div style="clear:both"></div></div></div> ';break;case 2:if(this.pageCount>1){c+='<div class="page-bottom"> <div class="sabrosus">',this.pageCount>5&&(c+='<font class="number">',c+="\u5171"+this.pageCount+"\u9875&nbsp;",c+='<input style="" type="text"  class="page-input" id="pageInput'+b.name+'"  value="\u9875\u7801" onkeypress="return window.'+b.name+".formatInputPage(event);\" onfocus=\"this.className='page-input page-input-text-on ';if(this.value=='\u9875\u7801'){this.value = '';}\" onblur=\"this.className='page-input';if(this.value==''){this.value = '\u9875\u7801'}\">",c+='<input type="button" value="Go" class="btm-go" onclick="javascript:var page = document.getElementById(\'pageInput'+b.name+"').value; if(isNaN(Number(page))|| Number(page)==0) { var turnTo = 1;} else if(page>"+this.pageCount+"){ var turnTo = "+this.pageCount+";} else{var turnTo = page;}  window."+b.name+'.toPage(turnTo);" >',c+="</font>"),d<1?c+='<span class="pre-none page-pic-no"></span>':c+='<span title="\u4e0a\u4e00\u9875" class="pre page-pic-no" onclick="'+b.name+".toPage("+d+');"></span>',this.page==1;if(this.page-2<=0){var f=1;if(this.pageCount>this.page+4)var g=this.page+4;else var g=this.pageCount}else if(this.page+2>=this.pageCount){var f=this.pageCount-4;if(this.pageCount>this.page+4)var g=this.page+4;else var g=this.pageCount}else{var f=this.page-2;if(this.pageCount>this.page+2)var g=this.page+2;else var g=this.pageCount}for(var h=f;h<=g;h++)h>0&&(h==this.page?c+='<span class="current a-padding">'+h+"</span>":c+='<a class="a-padding" href="javascript:'+b.name+".toPage("+h+');">'+h+"</a>");this.page+5<this.pageCount&&(c+='<a class="a-padding" title="" href="javascript:'+b.name+".toPage("+(this.page+3)+');">...</a>'),this.page==this.pageCount,e>this.pageCount?c+='<span class="next-none page-pic-no"></span>':c+='<span title="\u4e0b\u4e00\u9875" class="next page-pic-no" onclick="'+b.name+".toPage("+e+');"></span>',c+='<div style="clear:both"></div></div></div> '}break;case 3:c+='<div class="page-top"><div class="sabrosus"><span class="count">'+this.page+" / "+this.pageCount+"</span>",d<1?c+=' <span class="pre-none page-pic-no"></span>':c+='<a class="border-left-dedede" href="javascript:'+b.name+".toPage("+d+');" title="\u4e0a\u4e00\u9875"><span class="pre page-pic-no"></span></a>',e>this.pageCount?c+='<span class="next-none page-pic-no"></span>':c+='<a href="javascript:'+b.name+".toPage("+e+');" title="\u4e0b\u4e00\u9875"><span class="next page-pic-no"></span></a>',c+='<div style="clear:both"></div></div></div>'}return c},formatInputPage:function(a){var b=navigator.appName=="Microsoft Internet Explorer"?!0:!1;if(!b)var c=a.which;else var c=event.keyCode;return c==8||c==46||c>=48&&c<=57?!0:!1},toPage:function(a,b){var c=1,d=this;typeof a=="object"?c=a.options[a.selectedIndex].value:c=a,d.jump(c,b,"")},printHtml:function(a,c){return this.checkPages(),b.html(a,this._createHtml(c)),this},setPageCount:function(a){return this.pageCount=a,this},getPageCount:function(){return this.pageCount},setRender:function(a){return this.jump=a,this},setPageNum:function(a){return this.pageNum=a,this},setPage:function(a){return this.page=a,this}}),e}),KISSY.add("page/add-init",function(a,b,c,e){return addControl={msg:null,init:function(){var f=DOM.filter(DOM.query("input"),function(a){if(a.type=="text")return!0});Event.on(f,"focus blur",function(a){a.type=="focus"?(DOM.removeClass(a.target,"text-error"),DOM.addClass(a.target,"input-text-on")):a.type=="blur"&&DOM.removeClass(a.target,"input-text-on")});if(a.one("#J_startDate")){var g=new e.DatePicker({trigger:"#J_startDate",showTime:!0,autoRender:!0,autoSetValue:!1,textField:"2",hour:0,minute:0,second:0,minDate:new Date});g.on("selectedchange",function(b){var c=KISSY.one("#J_ParamsErrorBox");c.hide();var e=H.util.stringToDate(a.one("#J_endDate").val()),f=b.value;if(e!=""&&f.getTime()>=e.getTime())DOM.addClass(promotionForm.start_date,"text-error"),c=KISSY.one("#J_ParamsErrorBox"),DOM.html("#J_ParamsErrorMsg","\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65f6\u95f4"),c.css("display")==="none"&&c.slideDown();else{a.one("#J_startDate").val(b.text),DOM.removeClass(promotionForm.start_date,"text-error");var g=parseInt((e.getTime()-f.getTime())/1e3);d=parseInt(g/86400%1e4),h=parseInt(g/3600%24),str='\u6d3b\u52a8\u6301\u7eed<b class="color-red">'+d+'</b>\u5929<b class="color-red">'+h+"</b>\u5c0f\u65f6",DOM.html("#J_PromoTimeLast",str)}})}if(a.one("#J_endDate")){var i=new e.DatePicker({trigger:"#J_endDate",showTime:!0,autoRender:!0,autoSetValue:!1,textField:"2",hour:"23",minute:"59",second:"59",minDate:new Date});i.on("selectedchange",function(b){var c=KISSY.one("#J_ParamsErrorBox");c.hide();var e=b.value,f=new Date,g=H.util.stringToDate(a.one("#J_startDate").val()),i=H.util.stringToDate(e),j=H.util.stringToDate(j);if((i.getTime()<=g.getTime()||i.getTime()<=f.getTime())&&g!="")DOM.addClass(promotionForm.end_date,"text-error"),DOM.html("#J_ParamsErrorMsg","\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65f6\u95f4"),c.css("display")==="none"&&c.slideDown();else{a.one("#J_endDate").val(b.text),DOM.removeClass(promotionForm.end_date,"text-error");var k=parseInt((i.getTime()-g.getTime())/1e3);d=parseInt(k/86400%1e4),h=parseInt(k/3600%24),str='\u6d3b\u52a8\u6301\u7eed<b class="color-red">'+d+'</b>\u5929<b class="color-red">'+h+"</b>\u5c0f\u65f6",DOM.html("#J_PromoTimeLast",str)}})}window.tabs=(new c.Tabs("#icon_panel",{navCls:"ks-switchable-nav",contentCls:"icon-content",triggerType:"click",activeTriggerCls:"current"})).on("switch",function(a){var c=a.currentIndex;switch(c){case 0:b.show("comm");break;case 1:b.show("commDesign");break;case 2:b.show("smart");break;case 3:b.show("me")}}),b.scale=2,b.frontPageNum=14,b.show("comm"),Event.delegate(document,"click",".iconDeletelink",function(a){var c=DOM.attr(a.currentTarget,"data");new H.widget.msgBox({title:"\u5220\u9664\u56fe\u6807",content:"\u4eb2\uff01\u60a8\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u56fe\u6807?",type:"confirm",buttons:[{value:"\u786e\u5b9a\u5220\u9664"},{value:"\u53d6\u6d88"}],success:function(d){if(d=="\u786e\u5b9a\u5220\u9664"){a.preventDefault();var e=function(a){b.initMeFlag=!1,b.show("me")},f=function(a){new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.payload,type:"error"})},g="iconId="+c+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(delIconUrl).setMethod("POST").setHandle(e).setErrorHandle(f).setData(g).send()}}})})},initIcon:function(a,c,d,e){b.initIcon(a,c,d,e)},showDesign:function(){b.showDesign()},designFinish:function(a,c,d){b.designFinish(a,c,d)},save:function(){if(isVersionPer("icon"))return;ParamsErrorBox=KISSY.one("#J_ParamsErrorBox");var c=DOM.val("#J_PromoId"),d=c.split("_")[0];if(d==0){if(KISSY.one("#J_startDate")){var e=DOM.val("#J_startDate"),f=a.one("#J_endDate").val();if(f!=""&&e>=f){DOM.html("#J_ParamsErrorMsg","\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65f6\u95f4\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9"),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown(),DOM.addClass("#J_startDate","text-error");return}}if(KISSY.one("#J_endDate")){var f=a.one("#J_endDate").val(),g=new Date,h=H.util.stringToDate(a.one("#J_startDate").val()),i=H.util.stringToDate(f),j=H.util.stringToDate(invaliDate);if(i.getTime()<=g.getTime()||i.getTime()<=h){DOM.html("#J_ParamsErrorMsg","\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65f6\u95f4\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9"),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown(),DOM.addClass("#J_endDate","text-error");return}}}if(b.currentIconId!=null){promotionForm.iconId.value=b.currentIconId;if(b.mode==0)if(b.currentIconType==2||b.currentIconType==4){promotionForm.iconId.value+="_"+b.currentPositionId+"_"+b.currentColorId;if(b.currentIconType==2){var k=c.split("_")[1];if(!KISSY.inArray(k,["2","9","10"])){DOM.show("#J_ShowSmartIconMsg");return}}}}promotionForm.iconType.value=b.currentIconType;if(b.currentIconId==null||b.currentIconType==null){DOM.html("#J_ParamsErrorMsg","\u8bf7\u9009\u62e9\u56fe\u6807"),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown();return}return promotionForm.promoId.value=d,DOM.get("#promotion_edit_form").submit(),!0},changePromo:function(b){if(b!=0){DOM.attr("#J_startDate","disabled","disabled"),DOM.removeClass("#J_startDate","input-day"),DOM.style("#J_startDate",{border:"0",background:"none"}),DOM.attr("#J_endDate","disabled","disabled"),DOM.removeClass("#J_endDate","input-day"),DOM.style("#J_endDate",{border:"0",background:"none"});var c=b.split("_")[1];DOM.val("#J_startDate",b.split("_")[2]),DOM.val("#J_endDate",b.split("_")[3])}else{DOM.val("#J_startDate",startAt),DOM.style("#J_startDate",{border:"1px solid #A7A6AA",background:"url(http://cdn.huanleguang.com/img/hlg/v3/input-dayman.gif) right 0",width:"184px"}),DOM.style("#J_endDate",{border:"1px solid #A7A6AA",background:"url(http://cdn.huanleguang.com/img/hlg/v3/input-dayman.gif) right 0",width:"184px"}),DOM.val("#J_endDate",endAt);var c=0;DOM.attr("#J_startDate","disabled",!1),DOM.attr("#J_endDate","disabled",!1)}KISSY.inArray(c,["2","9","10"])&&DOM.hide("#J_ShowSmartIconMsg");var e=H.util.stringToDate(a.one("#J_startDate").val()),f=H.util.stringToDate(a.one("#J_endDate").val()),g=parseInt((f.getTime()-e.getTime())/1e3);d=parseInt(g/86400%1e4),h=parseInt(g/3600%24),str='\u6d3b\u52a8\u6301\u7eed<b class="color-red">'+d+'</b>\u5929<b class="color-red">'+h+"</b>\u5c0f\u65f6",DOM.html("#J_PromoTimeLast",str)}}},{requires:["./mods/icon-control","switchable","bui/calendar"]}); 