KISSY.add("utils/countdown/index",function(a){function b(a,c,d){var e=this;if(!(e instanceof b))return new b(a,c,d);this.timer=null,e.init(a,c,d)}return a.mix(b.prototype,{init:function(b,c,e){var f=this;if(e==""||typeof e=="undefined")e=1;e==1&&DOM.html(DOM.get(b),' <span class="day"></span>\u5929<span class="hour"></span>\u65f6<span class="min"></span>\u5206<span class="sec"></span>\u79d2 '),e==2&&DOM.html(DOM.get(b),' <span class="hour">19</span>\u65f6<span class="min">19</span>\u5206<span class="sec">26</span>\u79d2'),e==3&&DOM.html(DOM.get(b),'<span class="hour"><b>0</b><b>0</b></span><span class="min"><b>0</b><b>0</b></span><span class="sec"><b>0</b><b>0</b></span>');var g=function(a){var c=new Date,g=a,h=parseInt((g.getTime()-c.getTime())/1e3);d=parseInt(h/86400%1e4),i=parseInt(h/3600%24),j=parseInt(h/60%60),k=parseInt(h%60);if(e==3)var i=i+d*24;d>=0&&d<10&&(d="0"+d),i>=0&&i<10&&(i="0"+i),j>=0&&j<10&&(j="0"+j),k>=0&&k<10&&(k="0"+k),e==1&&(DOM.html(DOM.get(b+" .day"),d),DOM.html(DOM.get(b+" .hour"),i),DOM.html(DOM.get(b+" .min"),j),DOM.html(DOM.get(b+" .sec"),k));if(e==2||e==3){if(e==3){var i=i.toString(),j=j.toString(),k=k.toString();i="<b>"+i.charAt(0)+"</b><b>"+i.charAt(1)+"</b>",j="<b>"+j.charAt(0)+"</b><b>"+j.charAt(1)+"</b>",k="<b>"+k.charAt(0)+"</b><b>"+k.charAt(1)+"</b>"}DOM.html(DOM.get(b+" .hour"),i),DOM.html(DOM.get(b+" .min"),j),DOM.html(DOM.get(b+" .sec"),k)}h<=0&&f.endDo()};f.timer&&f.timer.cancel(),f.timer=a.later(g,1e3,!0,null,c)},setRender:function(a){var b=this;return this.endDo=a,this},endDo:function(){var a=this;a.timer.cancel()}}),b},{requires:[]}),KISSY.add("page/dashboard-init",function(a,b,c){var a=KISSY,d=a.DOM,e=a.Event;return dashboardControl={msg:null,panel:null,init:function(){dashboardControl.panel=new c.Dialog({title:"",width:400,height:300,mask:!1,buttons:[{text:"\u786e\u5b9a",elCls:"bui-button bui-button-primary",handler:function(){this.hide()}},{text:"\u5173\u95ed",elCls:"bui-button",handler:function(){this.hide()}}],bodyContent:""}),e.on(".list-item","mouseenter mouseleave",function(a){a.type=="mouseenter"?d.addClass(a.currentTarget,"current"):d.removeClass(a.currentTarget,"current")});var a=H.util.stringToDate(d.val("#J_W2Curtime")),b=H.util.stringToDate("2013-07-11 22:30:00"),f=H.util.stringToDate("2013-07-12 00:30:00");dashboardControl.posterShow()},GetPoster:function(){var a=function(a){},b=function(a){},c="";(new H.widget.asyncRequest).setURI(updateActivityFlag).setMethod("POST").setHandle(a).setErrorHandle(b).setData(c).send()},posterShow:function(){var a=function(a){var c=H.util.stringToDate(d.val("#J_W2Curtime")),e=H.util.stringToDate(a.payload.end_time),f=H.util.stringToDate(a.payload.begin_time).getTime(),g=e.getTime(),h=c.getTime();if(f<h&&h<g){var i=a.payload.link_mode==1?'target="_blank"':"",j='<a href="'+a.payload.link_url+'" '+i+'  ><img src="'+a.payload.poster_url+'" data-poster-track="'+a.payload.poster_id+'"></a>';a.payload.is_countdown&&(j+='<div  id="PromoCountDown"></div>'),d.html(d.get("#J_MonitorBox_Dash"),j),a.payload.is_countdown&&new b("#PromoCountDown",e,1),a.payload.pop_up&&(dashboardControl.panel.set("headerContent","\u6e29\u99a8\u63d0\u793a"),dashboardControl.panel.set("bodyContent",a.payload.pop_up_con))}},c=function(a){},e="";(new H.widget.asyncRequest).setURI(getShowPosterUrl).setMethod("GET").setHandle(a).setErrorHandle(c).setData(e).send()}}},{requires:["utils/countdown/index","bui/overlay"]}); 