H.add("widget~Dialog",function(a){function r(a){var c=this;if(!(c instanceof r))return new r(a);this.config=b.merge(i,a||{});var c=this,f=c.config,g,h;c._createHTML(),!0===f.keypress&&d.on(e,"keypress",function(a){27===a.keyCode&&200===c._status&&c.hide()})}var b=KISSY,c=b.DOM,d=b.Event,e=document,f=b.UA.ie,g=r.prototype,h=0,i={ID:null,head:"Title",body:'<div class="ui-dialog-loading">\u6b63\u5728\u52a0\u8f7d\uff0c\u8bf7\u7a0d\u5019...</div>',foot:"",center:!0,width:"580px",zIndex:"1000002",keypress:!0,mask:!1,drag:!1,maskClassName:"ui-dialog-mask",close:!0,className:"ui-dialog",classNameHd:"ui-dialog-hd",classNameBd:"ui-dialog-bd",classNameFt:"ui-dialog-ft",scroll:!0},j="changeHeader",k="changeBody",l="changeFooter",m="center",n="beforeShow",o="show",p="beforeHide",q="hide";b.mix(g,b.EventTarget),b.mix(g,{_status:400,center:function(){var a=this,b=this.elem,d,e,f=b.offsetWidth,g=b.offsetHeight,h=c.viewportWidth(),i=c.viewportHeight();return f<h?d=h/2-f/2+c.scrollLeft():d=c.scrollLeft(),g<i?e=i/2-g/2+c.scrollTop():e=c.scrollTop(),c.css(b,{left:d,top:e}),c.css(a.mask,"height",c.docHeight()+"px"),a.fire(m),a},setHeader:function(a){var b=this;return a+="",b.elemHead.innerHTML=a,b.fire(j),b},setBody:function(a){var b=this;return a.nodeType?(b.elemBody.innerHTML="",b.elemBody.appendChild(a)):(a+="",b.elemBody.innerHTML=a),b.fire(k),b},setFooter:function(a){var b=this;return a+="",b.elemFoot.innerHTML=a,b.fire(l),b},show:function(){var a=this,b=this.config;a.fire(n),c.css(a.elem,"visibility",""),c.css(a.elem,"display",""),!0===b.center&&a.center(),c.css(a.mask,"visibility",""),f&&6===f&&c.addClass(e.body,"fix-select"),a._status=200,a.fire(o);if(b.scroll){var d=function(){a.center()};window.onscroll=d}return a},hide:function(){var a=this,b=a.config;if(400===a._status)return;return a.fire(p),c.css(a.elem,"display","none"),c.css(a.elem,"visibility","hidden"),c.css(a.mask,"visibility","hidden"),c.css(a.mask,"height",0),f&&6===f&&c.removeClass(e.body,"fix-select"),a._status=400,a.fire(q),a},align:function(){},_createHTML:function(){var a=this,f=a.config;a.elem=e.createElement("dialog"),a.elem.id=f.ID||"ui-dialog-"+h++,a.elem.className=f.className,c.css(a.elem,"width",f.width),c.css(a.elem,"visibility","hidden"),c.css(a.elem,"z-index",f.zIndex),a.elemHead=e.createElement("hd"),a.elemHead.className=f.classNameHd,a.elemHead.innerHTML=f.head,a.elemBody=e.createElement("bd"),a.elemBody.className=f.classNameBd,a.setBody(f.body),a.elemFoot=e.createElement("ft"),a.elemFoot.className=f.classNameFt,a.elemFoot.innerHTML=f.foot,a.elem.appendChild(a.elemHead),a.elem.appendChild(a.elemBody),a.elem.appendChild(a.elemFoot),e.body.appendChild(a.elem),!0===f.close&&(a.elem.appendChild(c.create('<a href="javascript:void(0);" class="close">closes</a>')),d.on(c.query(".close",a.elem),"click",function(b){b.preventDefault(),a.hide()})),!0===f.mask&&(a.mask=e.createElement("mask"),a.mask.id=a.elem.id+"_"+f.maskClassName,a.mask.className=f.maskClassName,c.css(a.mask,"height",c.docHeight()+"px"),c.css(a.mask,"visibility","hidden"),c.css(a.mask,"z-index",a.config.zIndex-1),e.body.appendChild(a.mask)),!0===f.drag&&(c.addClass(a.elem,"ui-dialog-dd"),b.use("dd",function(){var c=b.one("#"+a.elem.id);(new b.Draggable({node:c,handlers:[b.one("."+f.classNameHd)],shim:!0})).on("drag",function(a){if(a.left<0||a.top<0)return;this.get("node").offset(a)})}))}}),H.widget.Dialog=r,H.widget.DialogMgr={list:{},get:function(a,b){if(!a||!this.list[a]){var c=new H.widget.Dialog(b);a=a?a:c.elem.id,this.list[a]=c}return this.list[a]}}}),H.add("widget~msg",function(a){function g(){var a=this;if(!(a instanceof g))return new g;this.msgMask=null,this.elem=null,this.panel=null,this.msg=null,this.header="\u9519\u8bef\u63d0\u793a",this.contain=null,this.status="msg"}var b=KISSY,c=b.DOM,d=b.Event,e=document,f="hidden";num=0,b.mix(g.prototype,{setHeader:function(a){var c=this;return b.isString(a)&&(c.header=a),this},setMsg:function(a){var b=this;return a==undefined?b.msg=null:b.msg=a,this},setBody:function(a,c){var d=this;return c==1?b.isString(a)&&(d.elem.innerHTML=a):c==2?b.isString(a)&&(d.contain.innerHTML=a):d.panel.setBody(a),this},createDiv:function(){var a=c.create('<div class="messages-prompt" ><div class="fbloader"><img  src=" http://img.huanleguang.com/hlg//fbloader.gif" width="16" height="11" /></div></div>');this.elem=e.createElement("div"),this.elem.className="mini_dialog_content",c.append(this.elem,a),e.body.appendChild(a)},createDialog:function(){var a="msg_panel"+num++;this.panel=H.widget.DialogMgr.get(a,{ID:a,head:"\u9519\u8bef\u63d0\u793a",body:"",foot:"",center:!0,width:"400px",keypress:!0,mask:!0,drag:!0})},center:function(){var a=this,b,d,e=c.parent(this.elem),f=e.offsetWidth,g=e.offsetHeight;return viewPortWidth=c.viewportWidth(),viewPortHeight=c.viewportHeight(),f<viewPortWidth?b=viewPortWidth/2-f/2+c.scrollLeft():b=c.scrollLeft(),g<viewPortHeight?d=viewPortHeight/2-g/2+c.scrollTop():d=c.scrollTop(),c.css(e,{left:b,top:d}),a},show:function(a){var b=this,d=b.msg;if(a==undefined){this.elem||b.createDiv(),c.css(c.parent(b.elem),"opacity","1"),b.setBody(d,1),b.mask(),c.show(c.parent(b.elem)),b.center();function e(){b.center()}window.onscroll=e,b.status="msg"}else this.contain=c.get(a),b.setBody(d,2),c.show(b.contain),b.status="contain"},showDialog:function(){var a=this;this.panel||a.createDialog(),a.panel.setHeader(a.header),a.setBody(a.msg),a.panel.show(),a.status="dialog"},mask:function(){var a=this;return mask=e.createElement("mask"),a.msgMask=mask,mask.id="messageMask",mask.className="msg-mask",c.css(mask,"height",c.docHeight()+"px"),c.css(mask,"height",c.docHeight()+"px"),e.body.appendChild(mask),KISSY.UA.ie==6&&c.append(c.create('<iframe style="position:absolute; top:0px; left:0px; width:100%; height:100%; opacity:0; filter:alpha(opacity=0);z-index:-1; scrolling:no; visibility:inherit" frameborder="5" src=""></iframe>'),c.get("#messageMask")),this},hide:function(a,b){var d=this;if(a==undefined)d.panel!=null&&d.panel.hide(),d.elem&&(c.hide(c.parent(d.elem)),c.remove(d.msgMask)),d.contain&&(c.hide(d.contain),c.remove(d.msgMask));else{if(isNaN(Number(a))==1||a<=0||a==1)a=3e3;b==undefined?KISSY.later(function(a,b,d,e){a!=null&&a.hide(),b&&(c.hide(c.parent(b)),c.remove(e)),d&&(c.hide(d),c.remove(e))},a,!1,null,[d.panel,d.elem,d.contain,d.msgMask]):b=="dialog"?KISSY.later(function(a){a!=null&&a.hide()},a,!1,null,d.panel):b=="msg"?KISSY.later(function(a,b){a&&(c.hide(c.parent(a)),c.remove(b))},a,!1,null,[d.elem,d.msgMask]):b=="contain"&&KISSY.later(function(a,b){a&&(c.hide(a),c.remove(b))},a,!1,null,[d.contain,d.msgMask])}}}),H.util.Msg=g}),H.add("widget~RandomBox",function(a){function f(a,c){var d=this;if(!(d instanceof f))return new f;d.config=b.mix(e,a),d.list=d.config.list,d.domNum=d.list.length,d.rollTimes=d.config.rollTimes,d.cls=d.config.cls,d.beginIndex=0,d.duration=d.config.duration,d.speedSteps=d.config.speedSteps,d._init(),d.callback=typeof c=="function"?c:undefined}var b=KISSY,c=b.all,d=b.Event,e={rollTimes:4,cls:"sel-item",duration:40,speedSteps:[1,2,5],probability:[]};b.augment(f,{_init:function(){var a=this,b=a.domNum;a.$domList=[],a.curRollTimes=0;for(var d=0;d<b;d++)a.$domList[d]=c(a.list[d]);a.changeTimes=b*a.rollTimes,a.config.finalId?(a.finalId=a.config.finalId,a.finalNum=a.changeTimes+a.indexOfArray(a.list,a.finalId)+1):a.finalNum=1e6},rolling:function(){var a=this;a.choose(a.$domList[a.beginIndex%a.domNum]),a.beginIndex+=1,a.start(),a.beginIndex==a.finalNum&&(a._clearInterval(),a.callback(a.curTarget))},_setInterval:function(a){var b=this;b.interval=setInterval(function(){b.rolling()},a)},_clearInterval:function(){var a=this;clearInterval(a.interval)},start:function(){var a=this,b=a.duration,c=a.speedSteps;a.stop(),a.beginIndex<a.finalNum&&(a.beginIndex>a.finalNum-10?a._setInterval(b*c[2]):a.beginIndex<=a.finalNum-10&&a.beginIndex>=a.finalNum-20?a._setInterval(b*c[1]):a._setInterval(b*c[0]))},stop:function(){var a=this;a._clearInterval()},reset:function(){var a=this,b=a.$domList,c=a.domNum,d=a.cls;a.stop(),a.beginIndex=0,a._init();for(var e=0,f=c;e<f;e++)b[e].hasClass(d)?b[e].removeClass(d):null},choose:function(a){var c=this;b.each(c.$domList,function(a){a.removeClass(c.cls)}),a.addClass(c.cls),c.curTarget="#"+a.attr("id")||""},indexOfArray:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1}}),H.widget.RandomBox=f}),H.add("SMART",function(a){var b=KISSY,c=b.DOM,e=b.Event,f={active_tab:function(a){return new b.Tabs("#J_Smart",{navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",activeTriggerCls:"current",autoplay:!0}),this},StringToDate:function(a){if(typeof a=="undefined")return new Date;if(typeof a=="date")return a;var b=Date.parse(a),c=new Date(b);if(isNaN(c)){a=a.replace(/:/g,"-"),a=a.replace(" ","-"),a=a.replace(".","-");var d=a.split("-");switch(d.length){case 7:c=new Date(d[0],--d[1],d[2],d[3],d[4],d[5],d[6]);break;case 6:c=new Date(d[0],--d[1],d[2],d[3],d[4],d[5]);break;default:c=new Date(d[0],--d[1],d[2])}}return c},shareToQzone:function(a,b){return url="http://item.taobao.com/item.htm?id="+a,window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(url)+"&title"+encodeURIComponent(b)),!1},shareToSina:function(a,b){url="http://item.taobao.com/item.htm?id="+a,void function(a,c,d){function h(){window.open([e,g].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(a.width-620)/2,",top=",(a.height-450)/2].join(""))||(f.href=[e,g].join(""))}try{}catch(d){}var e="http://v.t.sina.com.cn/share/share.php?",f=url,g=["url=",d(f),"&title=",d(b),"&appkey=1226626340"].join("");/Firefox/.test(navigator.userAgent)?setTimeout(h,0):h()}(screen,document,encodeURIComponent)},shareToQq:function(a,b){return url="http://item.taobao.com/item.htm?id="+a,window.open("http://v.t.qq.com/share/share.php?url="+encodeURIComponent(url)+"&appkey=&site=&title="+encodeURI(b),"","width=700, height=680, top=0, left=0, toolbar=no,menubar=no, scrollbars=no, location=yes, resizable=no, status=no"),!1},shareToRenren:function(a,b){url="http://item.taobao.com/item.htm?id="+a,void function(a,c,d){function i(){window.open([e,h].join(""),"xnshare",["toolbar=0,status=0,resizable=1,width=626,height=436,left=",(a.width-626)/2,",top=",(a.height-436)/2].join(""))||(f.href=[e,h].join(""))}if(/xiaonei\.com/.test(url))return;var e="http://share.xiaonei.com/share/buttonshare.do?link=",f=url,g=b,h=[d(f),"&title=",d(g)].join("");/Firefox/.test(navigator.userAgent)?setTimeout(i,0):i()}(screen,document,encodeURIComponent)},shareToKaixin:function(a,b){var c="http://item.taobao.com/item.htm?id="+a;d=document,t=d.selection?d.selection.type!="None"?d.selection.createRange().text:"":d.getSelection?d.getSelection():"",void (kaixin=window.open("http://www.kaixin001.com/~repaste/repaste.php?&rurl="+escape(c)+"&rtitle="+escape(b)+"&rcontent="+escape(d.title),"kaixin")),kaixin.focus()},shareToDouban:function(a,b){var c="http://item.taobao.com/item.htm?id="+a;void function(){var a=document,d=encodeURIComponent,e=window.getSelection,f=a.getSelection,g=a.selection,h=e?e():f?f():g?g.createRange().text:"",i="http://www.douban.com/recommend/?url="+d(c)+"&title="+d(b)+"&sel="+d(h)+"&v=1",j=function(){window.open(i,"douban","toolbar=0,resizable=1,scrollbars=yes,status=1,width=700,height=680")||(location.href=i+"&r=1")};/Firefox/.test(navigator.userAgent)?setTimeout(j,0):j()}()},shareToBaidu:function(a,b){return url="http://item.taobao.com/item.htm?id="+a,window.open("http://apps.hi.baidu.com/share/?title="+encodeURIComponent(b.substring(0,76))+"&url="+encodeURIComponent(url)),!1},getItemVolume:function(a,b,d,e){var f=function(a){c.html("#"+b,a.payload)},g=function(a){c.html("#"+b,"0")},h="item_id="+b.substr(9)+"&nick="+encodeURIComponent(d)+"&mode="+e;(new H.widget.asyncRequest).setURI(a).setMethod("GET").setHandle(f).setErrorHandle(g).setData(h).send()},getItemCollect:function(a,b){var d=function(a){c.html("#"+b,a.payload)},e=function(a){c.html("#"+b,"0")},f="item_id="+b.substr(10);(new H.widget.asyncRequest).setURI(a).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}};H.app.smart||(H.app.smart=f)}); 