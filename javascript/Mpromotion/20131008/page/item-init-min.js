KISSY.add("utils/showPages/index",function(a){function e(a){var b=this;if(!(b instanceof e))return new e(a);this.pageNum=4,this.name=a,this.page=1,this.pageCount=200,this.argName="page"}var b=a.DOM,c=a.Event,d=document;return a.mix(e.prototype,{jump:function(){return undefined},checkPages:function(){isNaN(parseInt(this.page))&&(this.page=1),isNaN(parseInt(this.pageCount))&&(this.pageCount=1),this.page<1&&(this.page=1),this.pageCount<1&&(this.pageCount=1),this.page>this.pageCount&&(this.page=this.pageCount),this.page=parseInt(this.page),this.pageCount=parseInt(this.pageCount)},_createHtml:function(a){var b=this,c="",d=this.page-1,e=this.page+1;if(a==""||typeof a=="undefined")a=1;switch(a){case 1:c+='<div class="page-bottom"> <div class="sabrosus">',c+='<font class="number">',c+="\u5171"+this.pageCount+"\u9875&nbsp;",c+='<input style="" type="text"  class="page-input" id="pageInput'+b.name+'"  value="\u9875\u7801" onkeypress="return window.'+b.name+".formatInputPage(event);\" onfocus=\"this.className='page-input page-input-text-on ';if(this.value=='\u9875\u7801'){this.value = '';}\" onblur=\"this.className='page-input';if(this.value==''){this.value = '\u9875\u7801'}\">",c+='<input type="button" value="Go" class="btm-go" onclick="javascript:var page = document.getElementById(\'pageInput'+b.name+"').value; if(isNaN(Number(page))|| Number(page)==0) { var turnTo = 1;} else if(page>"+this.pageCount+"){ var turnTo = "+this.pageCount+";} else{var turnTo = page;}  window."+b.name+'.toPage(turnTo);" >',c+="</font>",d<1?c+='<span class="pre-none page-pic-no"></span>':c+='<span title="\u4e0a\u4e00\u9875" class="pre page-pic-no" onclick="'+b.name+".toPage("+d+');"></span>',e>this.pageCount?c+='<span class="next-none page-pic-no"></span>':c+='<span title="\u4e0b\u4e00\u9875" class="next page-pic-no" onclick="'+b.name+".toPage("+e+');"></span>',c+='<div style="clear:both"></div></div></div> ';break;case 2:if(this.pageCount>1){c+='<div class="page-bottom"> <div class="sabrosus">',this.pageCount>5&&(c+='<font class="number">',c+="\u5171"+this.pageCount+"\u9875&nbsp;",c+='<input style="" type="text"  class="page-input" id="pageInput'+b.name+'"  value="\u9875\u7801" onkeypress="return window.'+b.name+".formatInputPage(event);\" onfocus=\"this.className='page-input page-input-text-on ';if(this.value=='\u9875\u7801'){this.value = '';}\" onblur=\"this.className='page-input';if(this.value==''){this.value = '\u9875\u7801'}\">",c+='<input type="button" value="Go" class="btm-go" onclick="javascript:var page = document.getElementById(\'pageInput'+b.name+"').value; if(isNaN(Number(page))|| Number(page)==0) { var turnTo = 1;} else if(page>"+this.pageCount+"){ var turnTo = "+this.pageCount+";} else{var turnTo = page;}  window."+b.name+'.toPage(turnTo);" >',c+="</font>"),d<1?c+='<span class="pre-none page-pic-no"></span>':c+='<span title="\u4e0a\u4e00\u9875" class="pre page-pic-no" onclick="'+b.name+".toPage("+d+');"></span>',this.page==1;if(this.page-2<=0){var f=1;if(this.pageCount>this.page+4)var g=this.page+4;else var g=this.pageCount}else if(this.page+2>=this.pageCount){var f=this.pageCount-4;if(this.pageCount>this.page+4)var g=this.page+4;else var g=this.pageCount}else{var f=this.page-2;if(this.pageCount>this.page+2)var g=this.page+2;else var g=this.pageCount}for(var h=f;h<=g;h++)h>0&&(h==this.page?c+='<span class="current a-padding">'+h+"</span>":c+='<a class="a-padding" href="javascript:'+b.name+".toPage("+h+');">'+h+"</a>");this.page+5<this.pageCount&&(c+='<a class="a-padding" title="" href="javascript:'+b.name+".toPage("+(this.page+3)+');">...</a>'),this.page==this.pageCount,e>this.pageCount?c+='<span class="next-none page-pic-no"></span>':c+='<span title="\u4e0b\u4e00\u9875" class="next page-pic-no" onclick="'+b.name+".toPage("+e+');"></span>',c+='<div style="clear:both"></div></div></div> '}break;case 3:c+='<div class="page-top"><div class="sabrosus"><span class="count">'+this.page+" / "+this.pageCount+"</span>",d<1?c+=' <span class="pre-none page-pic-no"></span>':c+='<a class="border-left-dedede" href="javascript:'+b.name+".toPage("+d+');" title="\u4e0a\u4e00\u9875"><span class="pre page-pic-no"></span></a>',e>this.pageCount?c+='<span class="next-none page-pic-no"></span>':c+='<a href="javascript:'+b.name+".toPage("+e+');" title="\u4e0b\u4e00\u9875"><span class="next page-pic-no"></span></a>',c+='<div style="clear:both"></div></div></div>'}return c},formatInputPage:function(a){var b=navigator.appName=="Microsoft Internet Explorer"?!0:!1;if(!b)var c=a.which;else var c=event.keyCode;return c==8||c==46||c>=48&&c<=57?!0:!1},toPage:function(a,b){var c=1,d=this;typeof a=="object"?c=a.options[a.selectedIndex].value:c=a,d.jump(c,b,"")},printHtml:function(a,c){return this.checkPages(),b.html(a,this._createHtml(c)),this},setPageCount:function(a){return this.pageCount=a,this},getPageCount:function(){return this.pageCount},setRender:function(a){return this.jump=a,this},setPageNum:function(a){return this.pageNum=a,this},setPage:function(a){return this.page=a,this}}),e}),KISSY.add("page/mods/item-handle",function(a){return itemHandle={strProcess:function(a){return a.replace(/\\/g,"\\\\").replace(/\"/g,'\\"').replace(/[\t\n&]/g,"%26")},checkPrice:function(a){return KISSY.isNumber(a)===!1||a<=0?!1:!0},isNull:function(a){return a==null||a==""?!0:!1},isDate:function(a){if(a==null)return!1;if(a.length!=19)return!1;var b=a.substring(0,4),c=a.substring(5,7),e=a.substring(8,10),f=a.substring(11,13),g=a.substring(14,16),h=a.substring(17,19);if(parseInt(b)<2011)return!1;y=parseInt(b,10),d=parseInt(e,10);switch(c){case"01":case"03":case"05":case"07":case"08":case"10":case"12":if(d>31)return!1;break;case"02":if(y%4==0&&d>29||y%4!=0&&d>28)return!1;break;case"04":case"06":case"09":case"11":if(d>30)return!1;break;default:return!1}return parseInt(f)>23||parseInt(g)>59||parseInt(h)>59?!1:a.substring(4,5)!="-"||a.substring(7,8)!="-"||a.substring(13,14)!=":"||a.substring(16,17)!=":"?!1:!0},generalTgParams:function(a,b){var c=[],d=[];result=itemHandle._generalTbSpecParams(a,b),paramsGeneral=result[0];var e=paramsGeneral[0],f=paramsGeneral[1],g=paramsGeneral[2],b=result[1];if(b)DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error");else{d.push(e),d.push(f);var h=DOM.val(DOM.get("#J_Promo_Start_Time")),i=DOM.val(DOM.get("#J_Promo_End_Time")),j=Number(DOM.val(DOM.get("#J_ItemParam_startNum_"+a))),k=Number(DOM.val(DOM.get("#J_ItemParam_minNum_"+a))),l=Number(DOM.val(DOM.get("#J_ItemParam_maxNum_"+a))),m=Number(DOM.val(DOM.get("#J_ItemParam_maxBuy_"+a))),n=DOM.val(DOM.get("#J_ItemParam_startAt_"+a)),o=DOM.val(DOM.get("#J_ItemParam_endAt_"+a)),p=DOM.val(DOM.get("#J_ItemParam_lastBuy_"+a)),q=DOM.val(DOM.get("#J_ItemParam_time_interval_"+a)),r=DOM.val(DOM.get("#J_ItemParam_tgtype_"+a));!KISSY.isNumber(j)||j<0?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u56e2\u8d2d\u521d\u59cb\u53c2\u56e2\u4eba\u6570\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e0\uff01",type:"error"}),DOM.get("#J_ItemParam_startNum_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_startNum_"+a),"text-error"),b=!0):!KISSY.isNumber(k)||k<0?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u6700\u5c11\u53c2\u56e2\u4eba\u6570\u5fc5\u987b\u5927\u4e8e0\uff01",type:"error"}),DOM.get("#J_ItemParam_minNum_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_minNum_"+a),"text-error"),b=!0):!KISSY.isNumber(l)||l<0||l<k?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u6700\u5927\u53c2\u56e2\u4eba\u6570\u5fc5\u987b\u5927\u4e8e0\u4e14\u5927\u4e8e\u7b49\u4e8e\u6700\u5c0f\u53c2\u56e2\u4eba\u6570\uff01",type:"error"}),DOM.get("#J_ItemParam_maxNum_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_maxNum_"+a),"text-error"),b=!0):!KISSY.isNumber(m)||m<0?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u6bcf\u4eba\u6700\u5927\u8d2d\u4e70\u91cf\u5fc5\u987b\u5927\u4e8e0\uff01",type:"error"}),DOM.get("#J_ItemParam_maxBuy_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_maxBuy_"+a),"text-error"),b=!0):itemHandle.isNull(n)||!itemHandle.isDate(n)?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u56e2\u8d2d\u5f00\u59cb\u65f6\u95f4\u5fc5\u987b\u4e3a\u65e5\u671f\u683c\u5f0f(\u4f8b2010-01-01 18:00:00\uff01",type:"error"}),DOM.get("#J_ItemParam_startAt_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_startAt_"+a),"text-error"),b=!0):itemHandle.isNull(o)||!itemHandle.isDate(o)?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u56e2\u8d2d\u7ed3\u675f\u65f6\u95f4\u5fc5\u987b\u4e3a\u65e5\u671f\u683c\u5f0f(\u4f8b2010-01-01 18:00:00)\uff09\uff01",type:"error"}),DOM.get("#J_ItemParam_endAt_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_endAt_"+a),"text-error"),b=!0):itemHandle.isNull(p)||!itemHandle.isDate(p)?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4ed8\u6b3e\u622a\u81f3\u65f6\u95f4\u5fc5\u987b\u4e3a\u65e5\u671f\u683c\u5f0f\uff01",type:"error"}),DOM.get("#J_ItemParam_lastBuy_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_lastBuy_"+a),"text-error"),b=!0):n<h&&(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u56e2\u8d2d\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u65e9\u4e8e\u6d3b\u52a8\u5f00\u59cb\u65f6\u95f4"+h+"\uff01",type:"error"}),DOM.get("#J_ItemParam_startAt_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_startAt_"+a),"text-error"),b=!0)}return d.push(j),d.push(k),d.push(l),d.push(m),d.push(p),d.push(n),d.push(o),d.push(g),d.push(r),d.push(q),c.push(b),c.push(d),c},_generalTbSpecParams:function(a,b){var c=[],d=DOM.get("#J_IsInt_"+a).value,e=Number(DOM.val(DOM.get("#J_SpecPrice_"+a))),f=Number(DOM.val(DOM.get("#J_ItemPrice_"+a))),g=Number(DOM.attr(DOM.get("#J_DecreaseNum_"+a),"title")),h=Number(DOM.val(DOM.get("#J_IsSku_"+a))),i=DOM.val(DOM.get("#J_Discount")),j=DOM.val("#J_minPrivilege"),k=DOM.val(DOM.get("#J_joinType")),l=0;if(h==1){var m="1";l=Number(DOM.val(DOM.get("#J_PromoValue_"+a)))}else if(d!=0||Number(DOM.val(DOM.get("#J_FinalType_"+a)))==3){var m="0";l=Number((f-e).toFixed(2))}else{var m=Number(DOM.get("#J_PromoType_"+a).value);m=="0"?l=Number(DOM.val(DOM.get("#J_Promo2Value_"+a))):l=Number(DOM.val(DOM.get("#J_PromoValue_"+a)))}if(e>=f||itemHandle.checkPrice(l)===!1||itemHandle.checkPrice(e)==0)new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u7279\u4ef7\u91d1\u989d\u6709\u8bef\uff08\u7279\u4ef7\u5fc5\u987b\u5c0f\u4e8e\u539f\u4ef7\uff09\uff0c\u8bf7\u68c0\u67e5\u540e\u518d\u52a0\u5165\uff01",type:"error"}),b=!0;else if(m=="0")if(type=="tbspec"||type=="tbspec_buyerLimit"||type=="onetbspec"||type=="tg"){if(DOM.val("#J_joinAgain")!="again"){if(k=="all")var n=j;else var n=l;n<=2&&(new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u9192",content:'\u60a8\u8981\u52a0\u5165\u7684\u5b9d\u8d1d\u4e2d\u6709\u6298\u6263\u7b49\u4e8e\u6216\u4f4e\u4e8e <em class="color-red">2</em> \u6298\uff0c\u786e\u5b9a\u52a0\u5165\u5417\uff1f',type:"confirm",buttons:[{value:"\u786e\u5b9a"},{value:"\u53d6\u6d88"}],success:function(a){a=="\u786e\u5b9a"&&l>Number((f*((10-i)/10)).toFixed(2))&&(new H.widget.msgBox({title:"\u8bf7\u4fee\u6539\u5e97\u94fa\u6700\u4f4e\u6298\u6263",content:'\u60a8\u8bbe\u7f6e\u7684\u5b9d\u8d1d\u6700\u4f4e\u6298\u6263\u7387\u4e3a <em class="color-red">'+n+"</em> \u6298\uff0c"+'\u60a8\u7684\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u4e3a <em class="color-red">'+i+"</em> \u6298\u53ef\u80fd\u4f1a\u4e0d\u751f\u6548\uff0c\u8bf7\u4fee\u6539\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u4f4e\u4e8e\u5b9d\u8d1d\u6298\u6263 "+'<a target="_blank" href="http://ecrm.taobao.com/promotion/show_other_activity.htm">\u4fee\u6539\u5e97\u94fa\u6700\u4f4e\u6298\u6263>></a>',type:"confirm",buttons:[{value:"\u5df2\u4fee\u6539\u5b8c\u6298\u6263\u4ef7\uff0c\u786e\u5b9a\u52a0\u5165\u6d3b\u52a8"}],success:function(a){a=="\u5df2\u4fee\u6539\u5b8c\u6298\u6263\u4ef7\uff0c\u786e\u5b9a\u52a0\u5165\u6d3b\u52a8"&&(DOM.val("#J_joinAgain","again"),promotionControl.getLowestDisAdd())}}),b=!0)}}),b=!0)}}else l>Number((f*.3).toFixed(2))&&(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f18\u60e0\u91d1\u989d\u6709\u8bef\uff0c\u6298\u6263\u6709\u6548\u8303\u56f4\u5728 7.00~9.99\u4e4b\u95f4\uff01",type:"error"}),b=!0);else if(type=="tbspec"||type=="tbspec_buyerLimit"||type=="tg"||type=="onetbspec"){if(DOM.val("#J_joinAgain")!="again"){if(k=="all")var n=j;else var n=l;n<=2&&(new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u9192",content:'\u60a8\u8981\u52a0\u5165\u7684\u5b9d\u8d1d\u4e2d\u6709\u6298\u6263\u7b49\u4e8e\u6216\u4f4e\u4e8e <em class="color-red">2</em> \u6298\uff0c\u786e\u5b9a\u52a0\u5165\u5417\uff1f',type:"confirm",buttons:[{value:"\u786e\u5b9a"},{value:"\u53d6\u6d88"}],success:function(a){a=="\u786e\u5b9a"&&l<i&&(new H.widget.msgBox({title:"\u8bf7\u4fee\u6539\u5e97\u94fa\u6700\u4f4e\u6298\u6263",content:'\u60a8\u8bbe\u7f6e\u7684\u5b9d\u8d1d\u6700\u4f4e\u6298\u6263\u4e3a <em class="color-red">'+n+"</em> \u6298\uff0c\u60a8\u7684\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u4e3a "+'<em class="color-red">'+i+"</em> \u6298\u53ef\u80fd\u4f1a\u4e0d\u751f\u6548\uff0c\u8bf7\u4fee\u6539\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u4f4e\u4e8e\u5b9d\u8d1d\u6298\u6263 "+'<a target="_blank" href="http://ecrm.taobao.com/promotion/show_other_activity.htm">\u4fee\u6539\u5e97\u94fa\u6700\u4f4e\u6298\u6263>></a>',type:"confirm",buttons:[{value:"\u5df2\u4fee\u6539\u5b8c\u6298\u6263\uff0c\u786e\u5b9a\u52a0\u5165\u6d3b\u52a8"}],success:function(a){a=="\u5df2\u4fee\u6539\u5b8c\u6298\u6263\uff0c\u786e\u5b9a\u52a0\u5165\u6d3b\u52a8"&&(DOM.val("#J_joinAgain","again"),promotionControl.getLowestDisAdd())}}),b=!0)}}),b=!0)}}else if(!KISSY.isNumber(l)||l<7||l>=10)new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 7.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),b=!0;else{var o=/(^[0-9]([.][0-9]{1,2})?$)|(^1[0-9]([.][0-9]{1,2})?$)|(^2[0-3]([.][0-9]{1,2})?$)|(^10([.]0{1,2})?$)/;o.test(l)||(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 7.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),b=!0)}return l.toFixed(2),c.push(m),c.push(l),c.push(g),[c,b]},generalSpecParams:function(a,b){var c=[],d=[],e=Number(DOM.val(DOM.get("#J_PromoPrice_"+a)));itemHandle.checkPrice(e)===!1&&(b=!0,DOM.addClass(DOM.get("#J_PromoPrice_"+a),"text-error")),d.push(e);if(DOM.get("#J_ItemSkus_"+a)==null)return d.push(""),c.push(b),c.push(d),c;var f=DOM.val(DOM.get("#J_ItemSkus_"+a)),g=DOM.val(DOM.get("#J_PropsName_"+a)),h=DOM.val(DOM.get("#J_PropsValue_"+a)),i=[],j="",k="",l=DOM.query("#J_SkuTable_"+a+" .J_SkuOrigPrice"),m=DOM.query("#J_SkuTable_"+a+" .J_SkuPromoPrice"),n=l.length;for(var o=0;o<n;o++)spp=Number(m[o].value),sop=Number(l[o].value),itemHandle.checkPrice(spp)===!1?(DOM.addClass(m[o],"text-error"),b=!0):DOM.removeClass(m[o],"text-error"),k+=m[o].value+",",j+=l[o].value+",";return j=j.substring(0,j.length-1),k=k.substring(0,k.length-1),i.push(j),i.push(k),i.push(f),i.push(g),i.push(h),d.push(i),c.push(b),c.push(d),c},generalTbSpecParams:function(a,b){var c=[],d=[];result=itemHandle._generalTbSpecParams(a,b),d=result[0];var b=result[1];return b&&DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),c.push(b),c.push(d),c},generalJtjParams:function(a,b){var c=[],d=DOM.val("#J_IsSku_"+a),e=Number(DOM.val(DOM.get("#J_ItemPrice_"+a))),f=DOM.query("#J_PromoType_"+a+" .J_promoType"),g=DOM.query("#J_PromoType_"+a+" .J_PromoValue"),h=DOM.query("#J_PromoType_"+a+" .J_PromoIsInt");if(h.length<=0)var i=DOM.get("#J_IsInt_"+a).value;var j=g.length;for(var k=0;k<j;k++){if(h.length>0)var i=Number(DOM.val(h[k]));if(i!=0){var l="0",m=g[k].id.replace("PromoValue","SpecPrice"),n=Number(DOM.val(DOM.get("#"+m)));newValue=Number((e-n).toFixed(2))}else{var l=Number(DOM.val(f[k]));if(l=="0"){var m=g[k].id.replace("PromoValue","SpecPrice"),n=Number(DOM.val(DOM.get("#"+m)));newValue=Number((e-n).toFixed(2))}else newValue=Number(DOM.val(g[k]))}n>=e&&(DOM.addClass(g[k],"text-error"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u7279\u4ef7\u91d1\u989d\u6709\u8bef\uff08\u7279\u4ef7\u5fc5\u987b\u5c0f\u4e8e\u539f\u4ef7\uff09\uff0c\u8bf7\u68c0\u67e5\u540e\u518d\u52a0\u5165\uff01",type:"error"}),b=!0);if(d=="1"||l=="1")if(!KISSY.isNumber(newValue)||newValue<=0||newValue>=10)DOM.addClass(g[k],"text-error"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\uff01",type:"error"}),b=!0;else{var o=/(^[0-9]([.][0-9]{1,2})?$)|(^1[0-9]([.][0-9]{1,2})?$)|(^2[0-3]([.][0-9]{1,2})?$)|(^10([.]0{1,2})?$)/;o.test(newValue)||(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(g[k],"text-error"),b=!0)}else itemHandle.checkPrice(newValue)===!1&&(DOM.addClass(g[k],"text-error"),b=!0);if(b==1)break;param=[l,newValue],c.push(param)}return[b,c]}}},{requires:[]}),KISSY.add("utils/beautifyForm/index",function(a){function g(b,c){var d=this;defaultCfg={init:!0};if(!(d instanceof g))return new g(b,c);var e=a.merge(defaultCfg,c);d._init(b,e)}var b=a.DOM,c=a.Event,d=document,e=b.get("body"),f=!1;return a.UA.safari!="undefined"&&a.UA.safari<3&&(f=!0),a.UA.ie==6&&b.replaceClass("#J_BodyHtml","has-js","no-js"),a.augment(g,{_init:function(a,b){var c=this;c.renderAll(a)},renderAll:function(a){var c=this;a=typeof a=="undefined"?"#J_BodyHtml":a;var d=b.filter(b.query(a+" input"),function(a){if(a.type=="checkbox"||a.type=="radio")return!0});for(var e=d.length-1;e>=0;e--)c.renderInput(d[e])},renderInput:function(a){var c=this,d=b.get(a),e=b.parent(d);e.tagName.toUpperCase()=="LABEL"&&e.className.indexOf("beautify_")>-1?e.className=="beautify_check"?c.renderCheckbox(d):e.className=="beautify_radio"&&c.renderRadio(d):e.tagName.toUpperCase()=="SPAN"&&b.hasClass(d,"beautify_input")&&c.renderCheckPro(d)},renderAllCheckPro:function(a){var c=this,d=b.filter(b.query(a+" input"),function(a){if((a.type=="checkbox"||a.type=="radio")&&b.hasClass(a,"beautify_input"))return!0});if(d.length<1)return;for(var e=d.length-1;e>=0;e--)c.renderCheckPro(d[e])},renderAllCheckbox:function(c){var d=this,e=b.filter(b.query(c+" input"),function(a){if(a.type=="checkbox")return!0});if(e.length<1){a.log("\u6b64id\u4e0b\u6ca1\u6709input(renderAllCheckbox)");return}for(var f=e.length-1;f>=0;f--)d.renderCheckbox(e[f])},renderAllRadio:function(c){var d=this,e=b.filter(b.query(c+" input"),function(a){if(a.type=="radio")return!0});if(e.length<1){a.log("\u6b64id\u4e0b\u6ca1\u6709input(renderAllRadio)");return}for(var f=e.length-1;f>=0;f--)d.renderRadio(e[f])},renderCheckPro:function(d){var e=this,g=b.get(d),h=b.prop(g,"type")=="checkbox",i=b.parent(g,"label")||b.parent(g,"span");if(!b.hasClass(g,"beautify_input")){a.log("input\u5fc5\u987b\u6709class=\u201dbeautify_input\u201c(renderCheckPro)");return}h?f&&g.checked==1||g.checked?(b.removeClass(i,"radio-checkoff-span"),b.addClass(i,"radio-checkon-span"),b.addClass(b.parent(i),"radio-checkstyle")):(b.removeClass(i,"radio-checkon-span"),b.addClass(i,"radio-checkoff-span"),b.removeClass(b.parent(i),"radio-checkstyle")):f&&g.checked==1||g.checked?(b.removeClass(i,"beautify_radio_off"),b.addClass(i,"beautify_radio_on"),b.addClass(b.parent(i),"radio-checkstyle")):(b.removeClass(i,"beautify_radio_on"),b.addClass(i,"beautify_radio_off"),b.removeClass(b.parent(i),"radio-checkstyle")),c.on(i,"click",function(a){a.stopPropagation();if(a.target.tagName.toUpperCase()=="LABEL")return;e.toggleCheckPro(g)})},renderCheckbox:function(a){var d=this,e=b.get(a),g=b.parent(e,"label")||b.parent(e,"span");if(!b.hasClass(g,"beautify_check"))return;e.disabled==1?f&&e.checked==1||e.checked?g.className="beautify_check c_on_disable":g.className="beautify_check beautify_check_disable":(f&&e.checked==1||e.checked?g.className="beautify_check c_on":g.className="beautify_check c_off",c.on(g,"click",function(a){a.stopPropagation();if(a.target.tagName.toUpperCase()=="LABEL")return;d.toggleCheckbox(e)}))},renderRadio:function(a){var d=this,e=b.get(a),g=b.parent(e,"label")||b.parent(e,"span");if(!b.hasClass(g,"beautify_radio"))return;e.disabled==1?f&&e.checked==1||e.checked?g.className="beautify_radio r_on_disable":g.className="beautify_radio beautify_radio_disable":(f&&e.checked==1||e.checked?g.className="beautify_radio r_on":g.className="beautify_radio r_off",c.on(g,"click",function(a){a.stopPropagation();if(a.target.tagName.toUpperCase()=="LABEL")return;d.toggleRadio(e)}))},setCheckboxOn:function(a){var c=b.get(a),d=b.parent(c,"label");d.className="beautify_check c_on",c.checked=!0},setCheckboxOff:function(a){var c=b.get(a),d=b.parent(c,"label");d.className="beautify_check c_off",c.checked=!1},setCheckboxDisabled:function(a){var c=b.get(a),d=b.parent(c,"label");f&&c.checked==1||c.checked?d.className="beautify_check c_on_disable":d.className="beautify_check beautify_check_disable",c.disabled=!0},setCheckboxNoDisabled:function(a){var c=b.get(a),d=b.parent(c,"label");f&&c.checked==1||c.checked?d.className="beautify_check c_on_disable":d.className="beautify_check beautify_check_disable",c.disabled=!1},toggleCheckbox:function(a){var c=b.get(a),d=b.parent(c,"label");d.className=="beautify_check c_off"?(d.className=="beautify_check c_on_disable"?d.className="beautify_check c_on_disable":d.className="beautify_check c_on",f&&c.click()):d.className=="beautify_check c_on_disable"?(d.className="beautify_check c_on_disable",f&&c.click()):d.className=="beautify_check beautify_check_disable"?(d.className="beautify_check beautify_check_disable",f&&c.click()):(d.className="beautify_check c_off",f&&c.click())},toggleRadio:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(c,"label");if(e.className=="beautify_radio r_off"||c.checked){var g=b.filter(b.query("input"),function(a){if(a.type=="radio")return!0});for(var h=0;h<g.length;h++){var i=b.parent(g[h]);if(i.className.indexOf("beautify_radio")==-1)continue;if(b.attr(g[h],"name")!==d)continue;i.className="beautify_radio r_off"}e.className="beautify_radio r_on",f&&c.click()}else e.className=="beautify_radio beautify_radio_disable"?(e.className="beautify_radio beautify_radio_disable",f&&c.click()):(e.className="beautify_radio r_off",f&&c.click())},setRadioOn:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(c,"label");if(e.className=="beautify_radio r_off"||c.checked){var f=b.filter(b.query("input"),function(a){if(a.type=="radio")return!0});for(var g=0;g<f.length;g++){var h=b.parent(f[g]);if(h.className.indexOf("beautify_radio")==-1)continue;if(b.attr(f[g],"name")!==d)continue;h.className="beautify_radio r_off"}e.className="beautify_radio r_on",c.checked=!0}},toggleCheckPro:function(a){var c=b.get(a),d=b.prop(c,"type")=="checkbox",e=b.attr(c,"name"),g=b.parent(a,"span");if(d)b.hasClass(g,"radio-checkon-span")?(b.removeClass(b.parent(g),"radio-checkstyle"),b.removeClass(g,"radio-checkon-span"),b.hasClass(g,"radio-checkoff-span")||b.addClass(g,"radio-checkoff-span")):(b.addClass(b.parent(g),"radio-checkstyle"),b.toggleClass(g,"radio-checkon-span","radio-checkoff-span"));else if(b.hasClass(g,"beautify_radio_off")){var h=b.filter(b.query(".beautify_input"),function(a){if(a.type=="radio")return!0});for(var c=0;c<h.length;c++){var i=h[c],j=b.parent(h[c]);if(i.className.indexOf("beautify_input")==-1)continue;if(b.attr(i,"name")!==e)continue;j.className="beautify_radio_off",b.removeClass(b.parent(j),"radio-checkstyle")}b.addClass(b.parent(g),"radio-checkstyle"),g.className="beautify_radio_on",f&&c.click()}else b.addClass(b.parent(g),"radio-checkstyle"),g.className="beautify_radio_on",f&&c.click()},setRadioPro:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(a,"span"),f=b.filter(b.query(".beautify_input"),function(a){if(a.type=="radio")return!0});for(var c=0;c<f.length;c++){var g=f[c],h=b.parent(f[c]);if(g.className.indexOf("beautify_input")==-1)continue;if(b.attr(g,"name")!==d)continue;h.className="beautify_radio_off",b.removeClass(b.parent(h),"radio-checkstyle")}b.addClass(b.parent(e),"radio-checkstyle"),e.className="beautify_radio_on",b.get(a).checked=!0},setRadioProOff:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(a,"span"),f=b.filter(b.query(".beautify_input"),function(a){if(a.type=="radio")return!0});for(var c=0;c<f.length;c++){var g=f[c],h=b.parent(f[c]);if(g.className.indexOf("beautify_input")==-1)continue;if(b.attr(g,"name")!==d)continue;h.className="beautify_radio_on"}e.className="beautify_radio_off",b.get(a).checked=!1},setCheckboxProOn:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(a,"span");b.addClass(b.parent(e),"radio-checkstyle"),b.toggleClass(e,"radio-checkon-span","radio-checkoff-span"),b.get(a).checked=!0},setCheckboxProOff:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(a,"span");b.removeClass(b.parent(e),"radio-checkstyle"),b.removeClass(e,"radio-checkon-span"),b.hasClass(e,"radio-checkoff-span")||b.addClass(e,"radio-checkoff-span"),b.get(a).checked=!1}}),g}),KISSY.add("page/mods/check",function(a){return checkUtil={checkSpecTitle:function(a){var b=[],c=!1,d=null,e=/(淘宝)|(限时折扣)|(限时打折)|(良品)|(淘金币)|(天天特价)|(满就送)/i;if(e.test(a)){var f=e.exec(a);f!=null&&(c=!0,d="\u542b\u6709\u8fdd\u7981\u5b57"+f[0]+"\uff01")}return b.push(c),b.push(d),b},checkPromoName:function(a){var b=[],c=!1,d=null,e=/^[\u4E00-\u9FA5\uf900-\ufa2d\A-Za-z0-9]{2,5}$/;if(!e.test(a))if(a.length<2||a.length>5)c=!0,d="\u957f\u5ea62~5\u4e2a\u5b57\u7b26\uff01";else{var f=/[^\u4E00-\u9FA5\uf900-\ufa2d\A-Za-z0-9]+/,g=a.match(f);g!=null&&(c=!0,d="\u542b\u6709\u975e\u6cd5\u5b57\u7b26"+g[0]+"\uff01")}return b.push(c),b.push(d),b},checkPromoDesc:function(a){var b=[],c=!1,d=null,e=/^[\u4E00-\u9FA5\uf900-\ufa2d\w\s\，！。《》（）、—]{0,30}$/;if(!e.test(a))if(a.length>30)c=!0,d="\u957f\u5ea630\u4e2a\u5b57\u4ee5\u5185\uff01";else{var f=/[^\u4E00-\u9FA5\uf900-\ufa2d\w\s\，！。《》（）、—]+/,g=a.match(f);g!=null&&(c=!0,d="\u542b\u6709\u975e\u6cd5\u5b57\u7b26"+g[0]+"\uff01")}return b.push(c),b.push(d),b},checkUrl:function(a){var b=[],c=!1,d=null,e=/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/;return e.test(a)||(c=!0,d="\u975e\u6cd5URl\u5730\u5740\uff01"),b.push(c),b.push(d),b},checkDiscount:function(a){var b=[],c=!1,d=null;if(isNaN(Number(a))||a<=0||a>=10)c=!0,d="\u6298\u6263\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\u54e6\uff01";else{var e=/(^[0-9]([.][0-9]{1,2})?$)|(^1[0-9]([.][0-9]{1,2})?$)|(^2[0-3]([.][0-9]{1,2})?$)|(^10([.]0{1,2})?$)/;e.test(a)||(c=!0,d="\u6298\u6263\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\u54e6\uff01")}return b.push(c),b.push(d),b},strProcess:function(a){return a.replace(/\\/g,"\\\\").replace(/\"/g,'\\"').replace(/[\t\n&]/g,"%26").replace(/%/g,"%25")},FormatNumber:function(a,b){var a,b,c,d;a=""+a+"",strLen=a.length,dotPos=a.indexOf(".",0);if(dotPos==-1){c=a+".";for(i=0;i<b;i++)c+="0";return c}if(strLen-dotPos-1>=b){nAfter=dotPos+b+1,d=1;for(j=0;j<b;j++)d*=10;return c=Math.floor(parseFloat(a)*d)/d,c}c=a;for(i=0;i<b-strLen+dotPos+1;i++)c+="0";return c},isNull:function(a){var b=[],c=!1,d=null;if(a==null||a=="")c=!0,d="\u8bf7\u586b\u5199\uff0c\u6b64\u9879\u4e0d\u80fd\u4e3a\u7a7a\uff01";return b.push(c),b.push(d),b}}}),KISSY.add("page/item-init",function(S,showPages,itemHandle,Select,beautifyForm,Tooltip,Overly,itemCheck,Overlay,Calendar){var DOM=S.DOM,Event=S.Event,tbTabArray=new Array("1","2"),promoTabArray=new Array("3","4","5");return promotionControl={isTarget:!1,processStatus:0,paginator:null,promotionItemPaginator:null,msg:null,Form:null,tabs:null,skuPriceTip:null,select:null,select1:null,isChanged:!1,isSelected:!1,popResetPromoItemDialog:null,init:function(){promotionControl.Form=new beautifyForm,promotionControl.select=new Select.Select({render:"#J_SelectItemCid",valueField:"#J_SelectItemCidHide",items:cidItem}),promotionControl.select.render(),promotionControl.select.setSelectedValue("0"),promotionControl.select1=new Select.Select({render:"#J_SortType",valueField:"#J_SortValue",items:sortItems}),promotionControl.select1.render(),promotionControl.select1.setSelectedValue("0"),promotionControl.select1.on("change",function(a){promotionControl.searchTbItems()}),Event.on(".J_ChooseShowType","click",function(a){var b=Number(DOM.attr(a.currentTarget,"data"));DOM.val("#J_CurrentTab",b),promotionControl.searchReset();switch(b){case 1:case 2:DOM.val("#J_TBTabType",b),DOM.hide(".J_PromoCont"),DOM.show(".J_TbCont"),promotionControl.isTarget=!1,promotionControl.searchTbItems();break;case 3:DOM.val("#J_PromoTabType","0"),DOM.hide(".J_TbCont"),DOM.show(".J_PromoCont"),promotionControl.loadPromotionItems();break;case 4:DOM.val("#J_PromoTabType","4"),DOM.hide(".J_TbCont"),DOM.show(".J_PromoCont"),promotionControl.loadPromotionItems();break;case 5:DOM.val("#J_PromoTabType","1"),DOM.hide(".J_TbCont"),DOM.show(".J_PromoCont"),promotionControl.loadPromotionItems()}DOM.removeClass("#J_ControlBtm","fix-bottom"),DOM.removeClass(".J_ChooseShowType","current"),DOM.addClass(a.currentTarget,"current")}),Event.on("#J_FilterItem","click",function(a){if(!promotionControl.popResetPromoItemDialog){if(DOM.hasClass(a.currentTarget,"ing"))return;DOM.addClass(a.currentTarget,"ing");var b=function(b){var c='<div class="pop-reset-promoItem ks-clear" id="J_PopResetPromoItemBox"><div class="input_style"><span><input type="radio" id="J_filterCurrent" class="fl beautify_input" name="filterType" checked="checked" value="0"></span><label for="J_filterCurrent">&nbsp;\u7b5b\u9009\u5b9d\u8d1d</label></div><div class="input_style"><span><input type="radio" id="J_filterSimilar" class="fl beautify_input" name="filterType" value="1"></span><label for="J_filterSimilar">&nbsp;\u6392\u9664\u5b9d\u8d1d</label></div>'+b.payload.body+"</div>";promotionControl.popResetPromoItemDialog=new Overlay.Dialog({title:"\u6392\u9664\u6d3b\u52a8",width:360,mask:!0,buttons:[{text:"\u786e\u5b9a",elCls:"bui-button bui-button-primary",handler:function(){DOM.prop("#J_filterCurrent","checked")&&DOM.val("#J_filter","4"),DOM.prop("#J_filterSimilar","checked")&&DOM.val("#J_filter","3");var a=DOM.query("#J_PopResetPromoItemBox .J_check"),b=a.length,c=[];for(var d=0;d<b;d++){if(a[d].disabled)continue;a[d].checked==1&&c.push(DOM.val(a[d]))}DOM.val("#J_FilterGrade",c.join(",")),c==""&&DOM.val("#J_filter","1"),promotionControl.searchTbItems(),this.hide()}},{text:"\u53d6\u6d88",elCls:"bui-button J_buttonCancel",handler:function(){this.hide()}}],bodyContent:c}),promotionControl.popResetPromoItemDialog.show(),DOM.removeClass(a.currentTarget,"ing"),promotionControl.Form.renderAll("#J_PopResetPromoItemBox"),promotionControl.popResetPromoItemDialog.on("hide",function(){var a=DOM.val("#J_FilterGrade");a?DOM.addClass("#J_FilterItem","filter-btn-on"):DOM.removeClass("#J_FilterItem","filter-btn-on")}),Event.on(DOM.query(".J_LeftCheckBox"),"click",function(a){var b=DOM.val(a.currentTarget),c=DOM.query(".J_check","#J_FilterTypeBox_"+b),d=c.length;for(i=0;i<d;i++){if(c[i].disabled)continue;a.currentTarget.checked?promotionControl.Form.setCheckboxOn(c[i]):promotionControl.Form.setCheckboxOff(c[i])}}),Event.on(DOM.query("#J_PopResetPromoItemBox .J_check"),"click",function(a){var b=DOM.attr(a.currentTarget,"data");if(this.checked){var c=DOM.query("#J_FilterTypeBox_"+b+" .J_check"),d=c.length,e=!0;for(i=0;i<d;i++){if(c[i].disabled)continue;if(!c[i].checked){e=!1;break}}e&&promotionControl.Form.setCheckboxOn(DOM.get("#J_FilterListPromoType_"+b))}else promotionControl.Form.setCheckboxOff(DOM.get("#J_FilterListPromoType_"+b))})},c="";(new H.widget.asyncRequest).setURI(loadInPromoUrl).setMethod("GET").setHandle(b).setData(c).send()}else promotionControl.popResetPromoItemDialog.show()}),isEditMode?promotionControl.loadPromotionItems():promotionControl.searchTbItems(),new Calendar.DatePicker({trigger:".J_tiems",showTime:!0,autoRender:!0,autoSetValue:!0,delegateTigger:!0}),Event.on("#J_editAll","click",function(a){DOM.show("#J_CancelEditAll"),DOM.hide("#J_editAll"),DOM.show("#J_BatchSet"),!DOM.prop("#J_TopCheckAll","checked")&&DOM.val("#J_CurrentTab")<=2&&DOM.show("#J_BatchTip")}),Event.on("#J_CancelEditAll","click",function(a){DOM.hide("#J_CancelEditAll"),DOM.show("#J_editAll"),DOM.hide("#J_BatchSet"),DOM.hide("#J_BatchTip")}),Event.delegate(document,"click",".J_jtjYouhui",function(a){var b=DOM.attr(a.currentTarget,"data"),c=DOM.attr(a.currentTarget,"type");DOM.val("#J_Type_"+b,c);var d=DOM.query(".J_jtjYouhui","#J_jtjList"+b);DOM.removeAttr(d,"id"),DOM.removeClass(d,"J_PromoValue"),DOM.removeClass(d,"input-price-focus"),DOM.addClass(d,"input-price"),DOM.attr(a.currentTarget,{id:"J_PromoValue_"+b}),DOM.addClass(a.currentTarget,"J_PromoValue"),DOM.removeClass(a.currentTarget,"input-price"),DOM.addClass(a.currentTarget,"input-price-focus")}),Event.on("#J_BatchSet input","focus change keyup",function(a){var b=DOM.attr(a.currentTarget,"data");a.type=="focus"?b=="1"?(DOM.val("#J_Zhe","1"),DOM.val("#J_value2ToAll","")):(DOM.val("#J_Zhe","0"),DOM.val("#J_valueToAll","")):(promotionControl.Form.setCheckboxOff(DOM.get("#J_QuzhengTo1")),promotionControl.Form.setCheckboxOff(DOM.get("#J_QuzhengTo2")),type=="jtj"?promotionControl.editAllJtj():promotionControl.editAll())}),Event.on("#J_SyncItemsButton","click",function(a){var b=DOM.parent(a.currentTarget);DOM.hide(b);var c=function(a){new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u540c\u6b65\u6570\u636e\u8bf7\u6c42\u6210\u529f\uff0c\u8bf7\u70b9\u51fb\u641c\u7d22\u67e5\u770b\u5b9d\u8d1d\u3002\u5982\u65e0\u6cd5\u663e\u793a\u8bf7\u8fc71\u5206\u949f\u5de6\u53f3\u518d\u67e5\u770b\uff01",type:"info"}),KISSY.later(function(a){DOM.show(a)},6e4,!1,null,b)},d="";(new H.widget.asyncRequest).setURI(syncItemsUrl).setHandle(c).setMethod("GET").setData(d).setDataType("json").send()}),Event.delegate(document,"click mouseenter mouseleave",".J_listItem",function(a){var b=DOM.attr(a.currentTarget,"data"),c=DOM.val("#J_CurrentTab"),d=DOM.get("#J_PromoBox_"+b),e=DOM.get("#J_Operation_"+b),f=DOM.val("#J_PromoType_"+b),g=DOM.val("#J_LastEditValue"),h=DOM.val("#J_LastEditMode");if(a.type=="click"){DOM.hide("#J_BatchTip");var i=DOM.get("#J_check"+b);i.disabled||i.checked||(S.inArray(c,tbTabArray)&&(DOM.removeClass([d,e],"ks-hidden"),promotionControl.isSelected||(promotionControl.isSelected=!0,DOM.replaceClass("#J_BtmAddToPromo",".button-gray",".button-green"))),promotionControl.Form.setCheckboxOn(i),g!="none"&&(h=="1"?(DOM.val("#J_PromoValue_"+b,g),Event.fire("#J_PromoValue_"+b,"keyup")):(DOM.val("#J_Promo2Value_"+b,g),Event.fire("#J_Promo2Value_"+b,"keyup"))))}else a.type=="mouseenter"?DOM.addClass(a.currentTarget,"current"):DOM.removeClass(a.currentTarget,"current")}),promotionControl.skuPriceTip||(promotionControl.skuPriceTip=new Overly({width:260,elCls:"J_ShowSkuPriceTip"})),Event.delegate(document,"mouseenter mouseleave",".J_ShowSkuPrice",function(a){var b=$(a.target);if(a.type=="mouseenter"){var c=DOM.siblings(a.currentTarget,".J_ItemSkuPrice"),d=DOM.html(c),e=Number(DOM.height(c)+65),f='<div class="bui-tooltip bui-ext-position ui-tip x-align-bottom x-align-tc-bc">'+d+'<s class="x-align-arrow"><s class="x-align-arrow-inner"></s></s>';promotionControl.skuPriceTip.set("content",f),promotionControl.skuPriceTip.set("align",{node:b,points:["bc","tc"],offset:[0,-e]}),promotionControl.skuPriceTip.show()}else promotionControl.skuPriceTip.hide()});var a=null;Event.delegate(document,"click dblclick",".J_AddToPromo",function(b){promotionControl.processStatus=0;if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8")){promotionControl.processStatus=1;return}promotionControl.addBefore();var c=DOM.attr(b.currentTarget,"data");c==1?(DOM.val("#J_ExpiredActionType","addItems"),DOM.val("#J_joinType","all")):(DOM.val("#J_ExpiredActionType","addItem"),DOM.attr("#J_ExpiredActionType","data",c),DOM.val("#J_joinType",c)),DOM.removeAttr("#J_joinType","item-id"),DOM.val("#J_joinAgain",""),b.type=="click"&&(clearTimeout(a),a=setTimeout(function(){var a=function(a){if(a.payload>=150&&!KISSY.inArray(typeId,["130","10","22","2","32","107","105","207"]))promotionControl.addAfter(),new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u975e\u5168\u5e97\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e150\u4e2a\uff0c\u73b0\u5728\u5df2\u7ecf\u52a0\u5165"+a.payload+"\u8bf7\u5220\u9664\u591a\u4f59\u7684\u5b9d\u8d1d\uff0c\u6216\u914c\u60c5\u5206\u591a\u6b21\u6d3b\u52a8\u521b\u5efa",type:"info"}),promotionControl.processStatus=2;else{var b=IsExpired();if(b>-5e3){var d=function(a){promotionControl.joinLowestDis(c)},e=function(a){KISSY.Event.fire(".J_TopExpired","click"),promotionControl.addAfter(),promotionControl.processStatus=3},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}else promotionControl.joinLowestDis(c)}},b=function(a){promotionControl.addAfter(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error"})},d="promo_id="+pid;(new H.widget.asyncRequest).setURI(getPromoItemNumUrl).setMethod("GET").setHandle(a).setErrorHandle(b).setData(d).send()},300));if(b.type=="dblclick"){clearTimeout(a);var d=function(a){if(a.payload>=150&&!KISSY.inArray(typeId,["130","10","22","2","32","107","105","207"]))promotionControl.addAfter(),new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u975e\u5168\u5e97\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e150\u4e2a\uff0c\u73b0\u5728\u5df2\u7ecf\u52a0\u5165"+a.payload+"\u8bf7\u5220\u9664\u591a\u4f59\u7684\u5b9d\u8d1d\uff0c\u6216\u914c\u60c5\u5206\u591a\u6b21\u6d3b\u52a8\u521b\u5efa",type:"info"}),promotionControl.processStatus=2;else{var b=IsExpired();if(b>-5e3){var d=function(a){promotionControl.joinLowestDis(c)},e=function(a){KISSY.Event.fire(".J_TopExpired","click"),promotionControl.addAfter(),promotionControl.processStatus=3},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}else promotionControl.joinLowestDis(c)}},e=function(a){promotionControl.addAfter(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error"})},f="promo_id="+pid;(new H.widget.asyncRequest).setURI(getPromoItemNumUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}}),Event.on("#J_AddFinish","click",function(a){if(promotionControl.hasItems()&&!promotionControl.isTarget){var b='<div class="msgBoxImage ui-msg"><span class="img-32-4"></span></div><div class="msgBoxContent">\u786e\u5b9a\u4fee\u6539\u52fe\u9009\u5b9d\u8d1d\uff1f</div>';(new Overlay.Dialog({title:"\u64cd\u4f5c\u63d0\u793a",width:440,mask:!0,buttons:[{text:"\u786e\u5b9a",elCls:"bui-button bui-button-primary",handler:function(){Event.fire("#J_BtmAddToPromo","click");var a=function(){switch(promotionControl.processStatus){case 1:case 2:case 3:case 4:case 6:clearInterval(b);break;case 5:clearInterval(b),promotionControl.isTarget=!0,window.location.href=finishPageUrl}},b=setInterval(a,100);this.destroy()}},{text:"\u53d6\u6d88",elCls:"bui-button J_buttonCancel",handler:function(){this.destroy()}}],bodyContent:b})).show()}else window.location.href=finishPageUrl}),promotionControl.getLowestDis(),Event.on("#J_updateDiscount","click",function(){DOM.val("#J_isDiscount","1");var a=IsExpired();if(a>-5e3){var b=function(a){promotionControl.getLowestDis()},c=function(a){KISSY.Event.fire(".J_TopExpired","click")},d="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(b).setErrorHandle(c).setData(d).send()}else promotionControl.getLowestDis()}),Event.delegate(document,"click",".J_isEdit",function(a){var b=DOM.attr(a.currentTarget,"pid"),c=DOM.attr(a.currentTarget,"item-id");DOM.val("#J_joinType",b),DOM.attr("#J_joinType",{"item-id":c})}),Event.on("#J_EditPromoItem","click",function(){DOM.val("#J_joinType","all")}),Event.delegate(document,"click dblclick",".J_removeToPromo",function(a){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;DOM.val("#J_joinAgain",""),DOM.val("#J_joinType",DOM.attr(a.currentTarget,"item-id"));var b=DOM.attr(a.currentTarget,"tid");DOM.val("#J_ExpiredActionType",b);if(b=="editorOne"){var c=DOM.attr(a.currentTarget,"data");DOM.attr("#J_ExpiredActionType","data",c)}else b=="restartOne"&&(c=DOM.attr(a.currentTarget,"data"),pidd=DOM.attr(a.currentTarget,"pid"),DOM.attr("#J_ExpiredActionType","data",c),DOM.attr("#J_ExpiredActionType","pid",pidd));var d=IsExpired();if(d>-5e3){var e=function(a){b=="editorOne"?promotionControl.editItem(c):b=="editorAll"?promotionControl.editPromoItem():b=="restartOne"?promotionControl.restartPromotionItemHandle(c,pidd):b=="restartAll"?promotionControl.restartPromotionItemHandle():b=="batchRetryAll"&&promotionControl.batchRetry()},f=function(a){KISSY.Event.fire(".J_TopExpired","click")},g="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(e).setErrorHandle(f).setData(g).send()}else b=="editorOne"?promotionControl.editItem(c):b=="editorAll"?promotionControl.editPromoItem():b=="restartOne"?promotionControl.restartPromotionItemHandle(c,pidd):b=="restartAll"?promotionControl.restartPromotionItemHandle():b=="batchRetryAll"&&promotionControl.batchRetry()}),Event.delegate(document,"click dblclick","#J_BatchAddItems",function(b){DOM.val("#J_ExpiredActionType","batchAdd"),b.type=="click"&&(clearTimeout(a),a=setTimeout(function(){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;DOM.attr("#J_BatchAddItems","disabled",!0),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray","btm-caozuo-gray-none");var a=IsExpired();if(a>-5e3){var b=function(a){promotionControl.batchAddItems()},c=function(a){DOM.attr("#J_BatchAddItems","disabled",!1),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray-none","btm-caozuo-gray"),KISSY.Event.fire(".J_TopExpired","click")},d="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(b).setErrorHandle(c).setData(d).send()}else promotionControl.batchAddItems()},300));if(b.type=="dblclick"){clearTimeout(a);if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;DOM.attr("#J_BatchAddItems","disabled",!0),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray","btm-caozuo-gray-none");var c=IsExpired();if(c>-5e3){var d=function(a){promotionControl.batchAddItems()},e=function(a){DOM.attr("#J_BatchAddItems","disabled",!1),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray-none","btm-caozuo-gray"),KISSY.Event.fire(".J_TopExpired","click")},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}else promotionControl.batchAddItems()}}),Event.on("#J_SearchBtn","click",promotionControl.searchTbItems),Event.on("#J_RightSearchBtn","click",promotionControl.loadPromotionItems),Event.on("#J_TopCheckAll","click",promotionControl.checkAll)},searchReset:function(){DOM.val("#J_StartPrice",""),DOM.val("#J_EndPrice",""),DOM.val("#J_RightStartPrice",""),DOM.val("#J_RightEndPrice",""),DOM.val("#J_SearchTitle")!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801"&&DOM.val("#J_SearchTitle","\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801"),DOM.val("#J_RightSearchTitle")!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801"&&DOM.val("#J_RightSearchTitle","\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801"),promotionControl.select.setSelectedValue("0"),Event.fire("#J_CancelEditAll","click"),DOM.hide(".J_BatchControlHolder")},moveLayer:function(){var a=DOM.height("#J_ControlBtm"),b=DOM.viewportHeight(),c=DOM.offset("#J_IndexMain").top,d=DOM.height("#J_IndexMain"),e=c+d+a+20,f=DOM.scrollTop(document),g=Number(f+b);return e<g?(DOM.removeClass("#J_ControlBtm","fix-bottom"),!0):(DOM.addClass("#J_ControlBtm","fix-bottom"),!1)},getLowestDis:function(){var a=function(a){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.val("#J_Discount",a.payload),DOM.text("#J_storeDiscount",a.payload+" \u6298")},b=function(a){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.text("#J_storeDiscount","\u83b7\u53d6\u4e0d\u5230")};DOM.show("#J_loadingDiscount"),DOM.hide("#J_storeDiscount");var c=DOM.val("#J_isDiscount"),d="fg="+c;(new H.widget.asyncRequest).setURI(getLowestDisUrl).setMethod("GET").setHandle(a).setErrorHandle(b).setData(d).send()},joinLowestDis:function(a){var b=function(b){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.val("#J_Discount",b.payload),DOM.text("#J_storeDiscount",b.payload+" \u6298"),a=="1"?promotionControl.addSelectItemsToPromotion():promotionControl.addSelectItemsToPromotion(a)},c=function(b){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.text("#J_storeDiscount","\u83b7\u53d6\u4e0d\u5230"),promotionControl.addAfter(),checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var c=checkBoxs.length,d=[];for(i=0;i<c;i++)if(checkBoxs[i].checked&&!checkBoxs[i].disabled){var e=checkBoxs[i].value,f=DOM.val(DOM.get("#J_PromoValue_"+e));d.push(f)}DOM.val("#J_minPrivilege",Math.min.apply(null,d));var g=DOM.val("#J_minPrivilege");new H.widget.msgBox({title:"\u5e97\u94fa\u6298\u6263\u83b7\u53d6\u5931\u8d25",content:'\u60a8\u8bbe\u7f6e\u7684\u5b9d\u8d1d\u6700\u4f4e\u6298\u6263\u4e3a <em class="color-red">'+g+"</em> \u6298\uff0c\u8bf7\u786e\u4fdd\u60a8\u7684\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u4f4e\u4e8e\u60a8\u7684\u5b9d\u8d1d\u6298\u6263 "+'<a target="_blank" href="http://ecrm.taobao.com/promotion/show_other_activity.htm">\u4fee\u6539\u5e97\u94fa\u6700\u4f4e\u6298\u6263>></a>',type:"confirm",buttons:[{value:"\u5df2\u4fee\u6539\u5b8c\u6298\u6263\uff0c\u786e\u5b9a\u52a0\u5165\u6d3b\u52a8"}],success:function(b){b=="\u5df2\u4fee\u6539\u5b8c\u6298\u6263\uff0c\u786e\u5b9a\u52a0\u5165\u6d3b\u52a8"&&(DOM.val("#J_joinAgain","again"),a=="1"?promotionControl.addSelectItemsToPromotion():promotionControl.addSelectItemsToPromotion(a))}})};DOM.show("#J_loadingDiscount"),DOM.hide("#J_storeDiscount");var d=DOM.val("#J_isDiscount"),e="fg="+d;(new H.widget.asyncRequest).setURI(getLowestDisUrl).setMethod("GET").setHandle(b).setErrorHandle(c).setData(e).send()},getLowestDisAgain:function(){var a=DOM.val(DOM.get("#J_joinType")),b=DOM.attr("#J_joinType","item-id");a=="all"?b!=undefined?promotionControl.editPromoItem():promotionControl.addSelectItemsToPromotion():b!=undefined?promotionControl.editPromoItem(a,b):promotionControl.addSelectItemsToPromotion(a),clearTimeout(c);var c=setTimeout(function(){var a=function(a){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.val("#J_Discount",a.payload),DOM.text("#J_storeDiscount",a.payload+" \u6298")},b=function(a){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.text("#J_storeDiscount",a.desc)};DOM.show("#J_loadingDiscount"),DOM.hide("#J_storeDiscount");var c=DOM.val("#J_isDiscount"),d="fg=1";(new H.widget.asyncRequest).setURI(getLowestDisUrl).setMethod("GET").setHandle(a).setErrorHandle(b).setData(d).send()},500)},getLowestDisAdd:function(){var a=IsExpired();if(a>-5e3){var b=function(a){promotionControl.getLowestDisAgain()},c=function(a){KISSY.Event.fire(".J_TopExpired","click")},d="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(b).setErrorHandle(c).setData(d).send()}else promotionControl.getLowestDisAgain()},deleteTbSpec:function(a,b){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;var c=function(a){promotionControl.paginator?promotionControl.paginator.toPage(promotionControl.paginator.page):promotionControl.searchPromoItems()},d=function(b){DOM.show("#J_deleteTbSpec_"+a),DOM.hide("#J_MinLoading_"+a)};DOM.hide("#J_deleteTbSpec_"+a),DOM.show("#J_MinLoading_"+a);var e="item_id="+a;(new H.widget.asyncRequest).setURI(delTbSpecUrl).setMethod("GET").setHandle(c).setErrorHandle(d).setData(e).setDataType("json").send()},batchAddItems:function(){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;var a=function(a){new H.widget.msgBox({title:"\u6210\u529f\u63d0\u793a",content:"\u64cd\u4f5c\u6210\u529f",type:"info"}),S.later(function(){window.location.reload()},1e3,!1,null,null)},b="&pid="+pid,c=DOM.val(DOM.get("#J_SelectItemCid"));if(DOM.val(DOM.get("#J_SearchTitle"))!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801")var d=encodeURIComponent(DOM.val(DOM.get("#J_SearchTitle")));else var d="";var e=DOM.val(DOM.get("#J_SearchSelling"));b+="&title="+d+"&cid="+c+"&type="+e;var f=DOM.val(DOM.get("#J_StartPrice")),g=DOM.val(DOM.get("#J_EndPrice"));b+="&start_price="+f+"&end_price="+g,DOM.attr("#J_BatchAddItems","disabled",!0),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray","btm-caozuo-gray-none"),(new H.widget.asyncRequest).setURI(batchAddUrl).setMethod("GET").setHandle(a).setData(b).send()},getParamsData:function(){if(DOM.val(DOM.get("#J_SearchTitle"))!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801")var a=encodeURIComponent(DOM.val(DOM.get("#J_SearchTitle")));else var a="";var b=DOM.val("#J_filter"),c=DOM.val("#J_FilterGrade"),d=DOM.val(DOM.get("#J_SelectItemCidHide")),e=DOM.val(DOM.get("#J_TBTabType")),f=DOM.val("#J_SortValue");if(f==0||f==1)var g=0;else var g=f;var h=10,i=DOM.val(DOM.get("#J_StartPrice")),j=DOM.val(DOM.get("#J_EndPrice")),k="q="+a+"&cid="+d+"&type="+e;return k+="&itemOrder="+g+"&pageSize="+h,k+="&pid="+pid,k+="&is_filter="+b,k+="&pids="+c,k+="&start_price="+i+"&end_price="+j,k},searchTbItems:function(){var a=function(a){DOM.get("#J_NoteIcon").style.display="none",totalRecords=a.payload.totalRecords,totalRecords>0?(DOM.get("#J_LEmpty").style.display="none",DOM.css(DOM.query(".J_ItemSelectBtnHolder"),"display","")):(DOM.get("#J_LEmpty").style.display="",DOM.css(DOM.query(".J_ItemSelectBtnHolder"),"display","none")),promotionControl.renderItems(a.payload.body),a.payload.count_promo!=0?(DOM.show("#J_CountPromo"),DOM.html("#J_CountPromo",a.payload.count_promo)):DOM.hide("#J_CountPromo"),a.payload.count_pause!=0?(DOM.show("#J_pauseItem"),DOM.html("#J_CountPause",a.payload.count_pause)):DOM.hide("#J_pauseItem"),a.payload.count_fail!=0?(DOM.show("#J_failureItem"),DOM.html("#J_CountFail",a.payload.count_fail)):DOM.hide("#J_failureItem"),pageCount=Math.ceil(totalRecords/a.payload.pageNum),totalRecords>a.payload.pageNum&&(DOM.addClass("#J_ControlBtm","fix-bottom"),window.onscroll=function(){promotionControl.moveLayer()}),promotionControl.paginator=(new showPages("promotionControl.paginator")).setRender(promotionControl.handlePagination).setPageCount(pageCount).printHtml("#J_Paging",2),promotionControl.paginator=(new showPages("promotionControl.paginator")).setRender(promotionControl.handlePagination).setPageCount(pageCount).printHtml("#J_TopPaging",3),DOM.hide("#J_TopPaging .count"),DOM.hide("#J_LeftLoading"),DOM.show("#J_MainLeftContent")},b=function(a){DOM.hide("#J_Loading"),DOM.show("#J_MainLeftContent"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error",autoClose:!0,timeOut:3e3})},c=promotionControl.getParamsData();DOM.show("#J_LeftLoading"),DOM.hide("#J_MainLeftContent"),(new H.widget.asyncRequest).setURI(getItemsFromTbUrl).setMethod("GET").setHandle(a).setErrorHandle(b).setData(c).setDataType("json").send()},renderItems:function(a){DOM.html(DOM.get("#J_TbItemList"),a,!0),promotionControl.Form.setCheckboxOff(DOM.get("#J_TopCheckAll"));var b=DOM.query("#J_TbItemList .J_CheckBox");Event.on(b,"click",promotionControl.checkBoxClick);var c=DOM.filter(DOM.query("input"),function(a){if(a.type=="text")return!0});Event.on(c,"focus",function(a){a.currentTarget.select()});var d=new Overly({width:160,elCls:"J_ShowTbJoinPop"}),e=null;Event.on(".J_ShowTbJoin","mouseenter",function(a){var b=$(a.target);e&&e.cancel();var c=DOM.siblings(a.currentTarget,".J_TbItemJoin"),f=DOM.html(c),g=Number(DOM.height(c)+57),h='<div class="ui-tip">'+f+'<s class="x-align-arrow"><s class="x-align-arrow-inner"></s></s>';d.set("content",h),d.set("align",{node:b,points:["bc","tc"],offset:[0,-g]}),d.show()}),Event.on(".J_ShowTbJoin","mouseleave",function(a){e=S.later(function(){d.hide()},1800,!1)});var f=new Overly({width:160,elCls:"J_ShowTbJoinPop"});Event.on(".J_ShowPriceTip","mouseenter mouseleave",function(a){if(a.type=="mouseenter"){var b=$(a.target),c=DOM.siblings(a.currentTarget,".J_PriceTip"),d=DOM.html(c),e=Number(DOM.height(c)+67),g='<div class="bui-tooltip bui-ext-position ui-tip x-align-bottom x-align-tc-bc">'+d+'<s class="x-align-arrow"><s class="x-align-arrow-inner"></s></s>';f.set("content",g),f.set("align",{node:b,points:["bc","tc"],offset:[0,-e]}),f.show()}else f.hide()}),Event.on(".J_SpecType","focus blur",function(a){var b=DOM.attr(a.currentTarget,"data"),c=DOM.attr(a.currentTarget,"promoType"),d=DOM.val(a.currentTarget);a.type=="focus"?DOM.hasClass(a.currentTarget,"input-price-focus")||(DOM.removeClass(a.currentTarget,"text-error"),DOM.replaceClass(DOM.query(".J_SpecType","#J_TbItem_"+b),"input-price-focus","input-price"),DOM.removeClass(a.currentTarget,"input-price"),DOM.addClass(a.currentTarget,"input-price-focus"),DOM.val("#J_PromoType_"+b,c)):a.type=="blur"&&(DOM.val("#J_LastEditMode",c),DOM.val("#J_LastEditValue",d))}),promotionControl.Form.renderAll("#J_TbItemList")},checkBoxClick:function(a){var b=this.value,c=DOM.get("#J_PromoBox_"+b),d=DOM.get("#J_Operation_"+b),e=DOM.val("#J_LastEditValue"),f=DOM.val("#J_LastEditMode");DOM.hide("#J_BatchTip");if(!this.checked)promotionControl.Form.setCheckboxOff(DOM.get("#J_TopCheckAll")),DOM.addClass([c,d],"ks-hidden"),e!="none"&&(f=="1"?(DOM.val("#J_PromoValue_"+b,e),Event.fire("#J_PromoValue_"+b,"keyup")):(DOM.val("#J_Promo2Value_"+b,e),Event.fire("#J_Promo2Value_"+b,"keyup")));else{var g=DOM.query("#J_TbItemList .J_CheckBox"),h=g.length,j=!0;for(i=0;i<h;i++){if(g[i].disabled)continue;if(!g[i].checked){j=!1;break}}j&&promotionControl.Form.setCheckboxOn("#J_TopCheckAll"),DOM.removeClass([c,d],"ks-hidden")}},handlePagination:function(a){pageId=a;var b=function(a){totalRecords=a.payload.totalRecords,totalRecords>0?(DOM.get("#J_LEmpty").style.display="none",DOM.css(DOM.query(".J_ItemSelectBtnHolder"),"display","")):(DOM.get("#J_LEmpty").style.display="",DOM.css(DOM.query(".J_ItemSelectBtnHolder"),"display","none")),pageCount=Math.ceil(totalRecords/a.payload.pageNum),totalRecords>a.payload.pageNum&&(DOM.addClass("#J_ControlBtm","fix-bottom"),window.onscroll=function(){promotionControl.moveLayer()}),promotionControl.paginator.setPage(pageId).setPageCount(pageCount).printHtml("#J_Paging",2),promotionControl.paginator.setPage(pageId).setPageCount(pageCount).printHtml("#J_TopPaging",3),promotionControl.renderItems(a.payload.body),a.payload.count_promo!=0?(DOM.show("#J_CountPromo"),DOM.html("#J_CountPromo",a.payload.count_promo)):DOM.hide("#J_CountPromo"),a.payload.count_pause!=0?(DOM.show("#J_pauseItem"),DOM.html("#J_CountPause",a.payload.count_pause)):DOM.hide("#J_pauseItem"),a.payload.count_fail!=0?(DOM.show("#J_failureItem"),DOM.html("#J_CountFail",a.payload.count_fail)):DOM.hide("#J_failureItem"),DOM.hide("#J_LeftLoading"),DOM.show("#J_MainLeftContent")},c=promotionControl.getParamsData();c+="&page_id="+pageId,DOM.show("#J_LeftLoading"),DOM.hide("#J_MainLeftContent"),(new H.widget.asyncRequest).setURI(getItemsFromTbUrl).setMethod("GET").setHandle(b).setData(c).send()},checkAll:function(a){DOM.hide("#J_BatchTip"),checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var b=checkBoxs.length;for(i=0;i<b;i++){var c=checkBoxs[i].value;if(checkBoxs[i].disabled)continue;this.checked?(DOM.removeClass(DOM.get("#J_PromoBox_"+c),"ks-hidden"),DOM.removeClass(DOM.get("#J_Operation_"+c),"ks-hidden"),promotionControl.Form.setCheckboxOn(checkBoxs[i])):(DOM.addClass(DOM.get("#J_PromoBox_"+c),"ks-hidden"),DOM.addClass(DOM.get("#J_Operation_"+c),"ks-hidden"),promotionControl.Form.setCheckboxOff(checkBoxs[i]))}},rightCheckAll:function(a){DOM.hide("#J_BatchTip"),checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox"),len=checkBoxs.length;for(i=0;i<len;i++){var b=checkBoxs[i].value;if(checkBoxs[i].disabled)continue;this.checked?promotionControl.Form.setCheckboxOn(checkBoxs[i]):promotionControl.Form.setCheckboxOff(checkBoxs[i])}},loadPromotionItems:function(){var a=function(a){totalRecords=a.payload.totalRecords,totalRecords>0?(DOM.get("#J_REmpty").style.display="none",DOM.css(DOM.query(".J_PromotionItemBtnHolder"),"display",""),KISSY.inArray(typeId,["108","106","111","208"])&&a.payload.sucNum==1&&new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:'\u6dd8\u5b9d\u89c4\u5b9a\u8be5\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u81f3\u5c11<em style="color:red">2</em>\u4e2a\u624d\u53ef\u751f\u6548\uff0c\u8bf7\u518d\u6dfb\u52a0\u5b9d\u8d1d\uff01&nbsp;&nbsp;<a target="_blank" href="http://bangpai.taobao.com/group/thread/474028-276305668.htm">\u67e5\u770b\u5b98\u65b9\u89c4\u5219</a>',type:"info",buttons:[{value:"\u6dfb\u52a0\u5b9d\u8d1d"}],success:function(a){a=="\u6dfb\u52a0\u5b9d\u8d1d"&&tabs.switchTo(0)}}),DOM.val("#J_TotalPromoItems",totalRecords)):(DOM.get("#J_REmpty").style.display="",DOM.css(DOM.query(".J_PromotionItemBtnHolder"),"display","none")),a.payload.count_promo!=0?(DOM.show("#J_CountPromo"),DOM.html("#J_CountPromo",a.payload.count_promo)):DOM.hide("#J_CountPromo"),a.payload.count_pause!=0?(DOM.show("#J_pauseItem"),DOM.html("#J_CountPause",a.payload.count_pause)):DOM.hide("#J_pauseItem"),a.payload.count_fail!=0?(DOM.show("#J_failureItem"),DOM.html("#J_CountFail",a.payload.count_fail)):DOM.hide("#J_failureItem"),DOM.html(DOM.get("#J_PromotionItemList"),a.payload.body,!0);var b=DOM.query("#J_PromotionItemList .J_CheckBox");Event.on(b,"click",function(a){DOM.hide("#J_BatchTip")}),Event.on(".J_SpecType","focus",function(a){var b=DOM.attr(a.currentTarget,"data"),c=DOM.attr(a.currentTarget,"promoType");DOM.hasClass(a.currentTarget,"input-price-focus")||(DOM.removeClass(a.currentTarget,"text-error"),DOM.replaceClass(DOM.query(".J_SpecType","#J_TbItem_"+b),"input-price-focus","input-price"),DOM.removeClass(a.currentTarget,"input-price"),DOM.addClass(a.currentTarget,"input-price-focus"),DOM.val("#J_PromoType_"+b,c))});var c=DOM.filter(DOM.query("input"),function(a){if(a.type=="text")return!0});Event.on(c,"focus",function(a){a.currentTarget.select()}),totalRecords>a.payload.pageNum&&(DOM.addClass("#J_ControlBtm","fix-bottom"),window.onscroll=function(){promotionControl.moveLayer()}),promotionControl.Form.renderAll("#J_PromotionItemList"),pageCount=Math.ceil(totalRecords/a.payload.pageNum),promotionControl.promotionItemPaginator=(new showPages("promotionControl.promotionItemPaginator")).setRender(promotionControl.promotionItemPaginationHandle).setPageCount(pageCount).printHtml("#J_PromotionItemPaging",2),DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent")};if(DOM.val(DOM.get("#J_SearchTitle"))!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801")var b=encodeURIComponent(DOM.val(DOM.get("#J_SearchTitle")));else var b="";var c=DOM.val(DOM.get("#J_PromoTabType")),d=10,e=DOM.val(DOM.get("#J_RightStartPrice")),f=DOM.val(DOM.get("#J_RightEndPrice")),g="promo_id="+promotionId+"&status="+c+"&title="+b+"&pageSize="+d+"&start_price="+e+"&end_price="+f;DOM.show("#J_RightLoading"),DOM.hide("#J_MainRightContent"),(new H.widget.asyncRequest).setURI(loadPromotionItemsUrl).setMethod("GET").setHandle(a).setData(g).send()},promotionItemPaginationHandle:function(a,b){pageId=a;var c=function(a){totalRecords=a.payload.totalRecords,totalRecords>0?(DOM.get("#J_REmpty").style.display="none",DOM.css(DOM.query(".J_PromotionItemBtnHolder"),"display",""),DOM.val("#J_TotalPromoItems",totalRecords),KISSY.inArray(typeId,["108","106","111","208"])&&a.payload.sucNum==1&&new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:'\u90e8\u5206\u53c2\u4e0e\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u9700<em style="color:red">\u81f3\u5c11\u4e24\u4e2a</em>\uff0c\u5426\u5219\u6d3b\u52a8\u4e0d\u4f1a\u751f\u6548\uff01',type:"info",buttons:[{value:"\u6dfb\u52a0\u5b9d\u8d1d"}],success:function(a){a=="\u6dfb\u52a0\u5b9d\u8d1d"&&tabs.switchTo(0)}}),DOM.val("#J_TotalPromoItems",totalRecords)):(DOM.get("#J_REmpty").style.display="",DOM.css(DOM.query(".J_PromotionItemBtnHolder"),"display","none")),a.payload.count_promo!=0?(DOM.show("#J_CountPromo"),DOM.html("#J_CountPromo",a.payload.count_promo)):DOM.hide("#J_CountPromo"),a.payload.count_pause!=0?(DOM.show("#J_pauseItem"),DOM.html("#J_CountPause",a.payload.count_pause)):DOM.hide("#J_pauseItem"),a.payload.count_fail!=0?(DOM.show("#J_failureItem"),DOM.html("#J_CountFail",a.payload.count_fail)):DOM.hide("#J_failureItem"),DOM.html(DOM.get("#J_PromotionItemList"),a.payload.body);var c=DOM.query("#J_PromotionItemList .J_CheckBox");Event.on(c,"click",function(a){DOM.hide("#J_BatchTip")}),Event.on(".J_SpecType","focus",function(a){var b=DOM.attr(a.currentTarget,"data"),c=DOM.attr(a.currentTarget,"promoType");DOM.hasClass(a.currentTarget,"input-price-focus")||(DOM.removeClass(a.currentTarget,"text-error"),DOM.replaceClass(DOM.query(".J_SpecType","#J_TbItem_"+b),"input-price-focus","input-price"),DOM.removeClass(a.currentTarget,"input-price"),DOM.addClass(a.currentTarget,"input-price-focus"),DOM.val("#J_PromoType_"+b,c))});var d=DOM.filter(DOM.query("input"),function(a){if(a.type=="text")return!0});Event.on(d,"focus",function(a){a.currentTarget.select()}),totalRecords>a.payload.pageNum&&(DOM.addClass("#J_ControlBtm","fix-bottom"),window.onscroll=function(){promotionControl.moveLayer()}),promotionControl.Form.renderAll("#J_PromotionItemList"),pageCount=Math.ceil(totalRecords/a.payload.pageNum),promotionControl.promotionItemPaginator.setPage(pageId).setPageCount(pageCount).printHtml("#J_PromotionItemPaging",2),b!="update"&&(DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent"))};b!="update"&&(DOM.show("#J_RightLoading"),DOM.hide("#J_MainRightContent"));if(DOM.val(DOM.get("#J_SearchTitle"))!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801")var d=encodeURIComponent(DOM.val(DOM.get("#J_SearchTitle")));else var d="";var e=10,f=DOM.val(DOM.get("#J_PromoTabType")),g="promo_id="+promotionId+"&status="+f+"&title="+d+"&page_id="+pageId+"&pageSize="+e,h=DOM.val(DOM.get("#J_RightStartPrice")),i=DOM.val(DOM.get("#J_RightEndPrice"));g+="&start_price="+h+"&end_price="+i,(new H.widget.asyncRequest).setURI(loadPromotionItemsUrl).setMethod("GET").setHandle(c).setData(g).send()},removePromotionItemHandle:function(a,b,c){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;if(c=="promoItems")var d=DOM.val("#J_TypeIdItem_"+a);if(d==10){var e=IsExpired();if(e>-5e3){var f=function(d){promotionControl.deletePromotionItemHandle(a,b,c)},g=function(a){KISSY.Event.fire(".J_TopExpired","click")},h="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(f).setErrorHandle(g).setData(h).send()}else promotionControl.deletePromotionItemHandle(a,b,c)}else promotionControl.deletePromotionItemHandle(a,b,c)},deletePromotionItemHandle:function(a,b,c){var d='<div class="msgBoxImage ui-msg"><span class="img-32-4"></span></div><div class="msgBoxContent">\u786e\u5b9a\u5220\u9664\u5417\uff1f</div>';(new Overlay.Dialog({title:"\u5220\u9664\u63d0\u793a",width:440,mask:!0,buttons:[{text:"\u786e\u5b9a",elCls:"bui-button bui-button-primary",handler:function(){itemIds=[],c=="promoItems"?(DOM.hide("#J_RemovePromo_"+a),DOM.show("#J_MinLoading_"+a)):(DOM.attr("#J_RemovePromotionItems","disabled",!0),DOM.replaceClass("#J_RemovePromotionItems","btm-caozuo-orange","btm-caozuo-gray-none"));if(a&&b)itemIds.push(a),pid=b;else{checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var d=checkBoxs.length;for(i=0;i<d;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&itemIds.push(checkBoxs[i].value);if(itemIds.length==0){new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u62e9\u4efb\u4f55\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:2e3}),DOM.attr("#J_RemovePromotionItems","disabled",!1),DOM.replaceClass("#J_RemovePromotionItems","btm-caozuo-gray-none","btm-caozuo-orange");return}}var e=function(a){DOM.attr("#J_RemovePromotionItems","disabled",!1),DOM.replaceClass("#J_RemovePromotionItems","btm-caozuo-gray-none","btm-caozuo-orange"),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page,"update"):promotionControl.loadPromotionItems()},f="pid="+pid+"&item_ids="+itemIds+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(removePromotionItemUrl).setMethod("POST").setHandle(e).setData(f).send(),this.destroy()}},{text:"\u53d6\u6d88",elCls:"bui-button J_buttonCancel",handler:function(){this.destroy()}}],bodyContent:d})).show()},hasItems:function(){checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var a=checkBoxs.length,b=!1;for(i=0;i<a;i++)if(checkBoxs[i].checked&&!checkBoxs[i].disabled){b=!0;break}return b},addSelectItemsToPromotion:function(iid){promotionControl.addBefore(),checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var json=[],longTitleItemIds=[];itemXml="";var error=!1,len=checkBoxs.length,translateDiv=DOM.get("#J_Translate"),privilegeJson=[];for(i=0;i<len;i++)if(checkBoxs[i].checked&&!checkBoxs[i].disabled){var id=checkBoxs[i].value,PreferentialType=DOM.val("#J_PromoType_"+id),z=DOM.val(DOM.get("#J_PromoValue_"+id));privilegeJson.push(z)}DOM.val("#J_minPrivilege",Math.min.apply(null,privilegeJson));for(i=0;i<len;i++){var flag=!1;iid!=undefined?checkBoxs[i].value==iid&&!checkBoxs[i].disabled&&(flag=!0):checkBoxs[i].checked&&!checkBoxs[i].disabled&&(flag=!0);if(flag==1){var totalNum=Number(DOM.val("#J_TotalPromoItems"));totalNum+=1;if(totalNum>150&&!KISSY.inArray(typeId,["130","10","22","2","32","107","105","207"])){new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u975e\u5168\u5e97\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e150\u4e2a\uff0c\u73b0\u5728\u5df2\u7ecf\u52a0\u5165"+totalNum+"\u8bf7\u5220\u9664\u591a\u4f59\u7684\u5b9d\u8d1d\uff0c\u6216\u914c\u60c5\u5206\u591a\u6b21\u6d3b\u52a8\u521b\u5efa\uff01",type:"info"});break}DOM.val("#J_TotalPromoItems",totalNum);var id=checkBoxs[i].value,title=itemCheck.strProcess(DOM.val(DOM.get("#J_ItemTitle_"+id))),picUrl=DOM.val(DOM.get("#J_ItemPic_"+id)),price=DOM.val(DOM.get("#J_ItemPrice_"+id)),updatePic=DOM.val(DOM.get("#J_ItemUpdatePic_"+id)),outId=itemCheck.strProcess(DOM.val(DOM.get("#J_ItemOuterId_"+id))),paramsStr="";type=="spec"?(r=itemHandle.generalSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tbspec"||type=="onetbspec"||type=="tbspec_buyerLimit"?(r=itemHandle.generalTbSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tg"?(r=itemHandle.generalTgParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="jtj"&&(r=itemHandle.generalJtjParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params));if(error!==!1)break;o='{"id":"'+id+'", "outer_id":"'+outId+'", "title":"'+title+'", "price":"'+price+'", "pic_url":"'+picUrl+'", "update_pic":"'+updatePic+'"'+paramsStr+"}",o=eval("("+o+")"),json.push(o);if(iid!=undefined)break}}if(error){promotionControl.addAfter(),promotionControl.processStatus=4;return}if(json.length==0){new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u62e9\u4efb\u4f55\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:2e3}),promotionControl.addAfter();return}var itemsJson=KISSY.JSON.stringify(json),submitHandle=function(a){promotionControl.addAfter();if(a.payload.limit!=null)status="\u64cd\u4f5c\u5931\u8d25",new H.widget.msgBox({title:"\u64cd\u4f5c\u5931\u8d25",content:a.payload.limit,type:"error"});else{var b=a.payload.waitTime,c=a.payload.finishAt,d=checkBoxs.length;promotionControl.paginator?promotionControl.paginator.toPage(promotionControl.paginator.page):promotionControl.searchTbItems()}promotionControl.processStatus=5},errorHandle=function(a){promotionControl.processStatus=6,promotionControl.addAfter(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error"})},data="pid="+pid+"&items="+itemsJson+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(addItemsToPromotionUrl).setMethod("POST").setHandle(submitHandle).setErrorHandle(errorHandle).setData(data).send()},addBefore:function(){DOM.show(DOM.query(".J_adding")),DOM.attr("#J_BtmAddToPromo","disabled",!0),DOM.replaceClass("#J_BtmAddToPromo","btm-caozuo-orange","btm-caozuo-gray-none")},addAfter:function(){DOM.hide(DOM.query(".J_adding")),DOM.attr("#J_BtmAddToPromo","disabled",!1),DOM.replaceClass("#J_BtmAddToPromo","btm-caozuo-gray-none","btm-caozuo-orange ")},getTjtSpecPrice:function(a,b,c){var d=Number(DOM.get("#J_PromoValue_"+a).value),e=Number(DOM.get("#J_Type_"+a).value),f=Number(DOM.val(DOM.get("#J_ItemPrice_"+b)));if(c=="promoItem")var g=0;else var g=DOM.get("#J_IsInt_"+b).value;var h,i,j;e=="1"?(h=d/10*f,h=Math.floor(h*100)/100,j=f-h):(h=Math.floor((f-d)*100)/100,i=Number(h/f*10).toFixed(2)),g==1?h=Math.floor(h):g==2&&(h=itemCheck.FormatNumber(h,1));if(e=="1"){if(!KISSY.isNumber(d)||d<0||d>=10)return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),!1;var k=/(^[0-9]([.][0-9]{1,2})?$)|(^1[0-9]([.][0-9]{1,2})?$)|(^2[0-3]([.][0-9]{1,2})?$)|(^10([.]0{1,2})?$)/;if(!k.test(d))return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),!1}c=="promoItem"&&DOM.val("#J_IsInt_"+a,"0"),DOM.removeClass(DOM.get("#J_PromoValue_"+a),"text-error"),DOM.val(DOM.get("#J_SpecPrice_"+a),h),DOM.val(DOM.get(".J_discount"+a),i),DOM.val(DOM.get(".J_discountMoney"+a),j)},getTjtPromoValue:function(a,b,c){var d=DOM.get("#J_Type_"+a).value,e=Number(DOM.get("#J_ItemPrice_"+b).value),f=Number(DOM.get("#J_SpecPrice_"+a).value),g;d=="0"?(g=Math.floor((e-f)*100)/100,DOM.val(DOM.get("#J_PromoValue_"+a))=g):(g=Number((f/e*10).toFixed(2)),DOM.val(DOM.get("#J_PromoValue_"+a))=g),c=="promoItem"&&DOM.val("#J_IsInt_"+a,"1");return},showTitleParam:function(a){var b=DOM.get("#J_ParamsTitle_"+a);b.style.display=="none"?(b.style.display="",DOM.get("#J_UpdateTitle_"+a).value="1"):(b.style.display="none",DOM.get("#J_UpdateTitle_"+a).value="0");return},toggleSku:function(a){var b=DOM.get("#J_SkuTable_"+a);DOM.hasClass(b,"ks-hidden")?DOM.removeClass(b,"ks-hidden"):DOM.addClass(b,"ks-hidden")},checkPromoPrice:function(a){return promoPrice=Number(a.value),itemHandle.checkPrice(promoPrice)===!1?(DOM.addClass(a,"text-error"),a.value="",!1):(id=a.id,id=id.replace("Promo","Item"),itemPrice=Number(DOM.get("#"+id).value),DOM.removeClass(a,"text-error"),promotionControl.autoSkuPrice(a),!0)},autoSkuPrice:function(a){value=a.value,id=a.id.replace("J_PromoPrice_","");var b=DOM.query("#J_SkuTable_"+id+" .J_SkuPromoPrice"),c=b.length;for(var d=0;d<c;d++)b[d].value=value;return},getSpecPrice:function(a,b,c){DOM.hide("#J_ZheWarn_"+a);var d=DOM.val("#J_CurrentTab");!promotionControl.isChanged&&S.inArray(d,promoTabArray)&&(promotionControl.isChanged=!0,DOM.replaceClass("#J_PromoSave",".button-gray",".button-green"));var e=DOM.val(DOM.get("#J_PromoType_"+a));if(e=="1"){var f=DOM.val("#J_PromoValue_"+a);(f<0||f>10||isNaN(f))&&DOM.val(DOM.get("#J_PromoValue_"+a),"10");if(f<.01||f>10||isNaN(f))f=10;f!=10&&f.indexOf(".")>0&&f.toString().split(".")[1].length>2&&(f=Number(f).toFixed(2),DOM.val(DOM.get("#J_PromoValue_"+a),f))}else{var f=DOM.val("#J_Promo2Value_"+a);if(f<0||isNaN(f))DOM.val(DOM.get("#J_Promo2Value_"+a),"0"),f=0;f.indexOf(".")>0&&f.toString().split(".")[1].length>2&&(f=Number(f).toFixed(2),DOM.val(DOM.get("#J_Promo2Value_"+a),f))}var g=Number(DOM.val(DOM.get("#J_IsSku_"+a))),h=Number(DOM.val(DOM.get("#J_ItemPrice_"+a))),i=Number(DOM.val(DOM.get("#J_PromoIsInt_"+a))),j;DOM.val(DOM.get("#J_FinalType_"+a),"0");if(g==1)j=f/10*h,j=Math.floor(j*100)/100;else{var k=DOM.val(DOM.get("#J_IsInt_"+a));i&&k!=2&&DOM.val("#J_IsInt_"+a,"1"),e=="1"?(KISSY.one("#J_PromoBox_"+a+" .duoguige")&&DOM.hide("#J_PromoBox_"+a+" .duoguige"),j=f/10*h,j=Math.floor(j*100)/100):(KISSY.one("#J_PromoBox_"+a+" .duoguige")&&DOM.show("#J_PromoBox_"+a+" .duoguige"),j=Math.floor((h-f)*100)/100);var k=DOM.val(DOM.get("#J_IsInt_"+a));k==1?j=Math.floor(j):k==2&&(j=itemCheck.FormatNumber(j,1));if(e=="1"){var l=h-j;DOM.val("#J_Promo2Value_"+a,Number(l).toFixed(2))}else{var m=j/h*10;m<.01&&DOM.show("#J_ZheWarn_"+a),DOM.val("#J_PromoValue_"+a,Number(m).toFixed(2))}}DOM.replaceClass("#J_BtmAddToPromo","button-gray","button-green"),DOM.val(DOM.get("#J_SpecPrice_"+a),j)},getPromoValue:function(a,b){DOM.hide("#J_ZheWarn_"+a);var c=DOM.val("#J_CurrentTab");!promotionControl.isChanged&&S.inArray(c,promoTabArray)&&(promotionControl.isChanged=!0,DOM.replaceClass("#J_PromoSave",".button-gray",".button-green")),DOM.val("#J_IsInt_"+a,"0"),DOM.val(DOM.get("#J_FinalType_"+a),"3");var d=DOM.val(DOM.get("#J_PromoType_"+a)),e=Number(DOM.val(DOM.get("#J_ItemPrice_"+a))),f=DOM.val("#J_SpecPrice_"+a);if(f<0||isNaN(f))DOM.val(DOM.get("#J_SpecPrice_"+a),e),f=e;var g,h;KISSY.one("#J_PromoBox_"+a+".duoguige")&&DOM.show("#J_PromoBox_"+a+".duoguige"),h=Math.floor((e-f)*100)/100,DOM.val(DOM.get("#J_Promo2Value_"+a),h),g=(f/e*10).toFixed(2),DOM.val(DOM.get("#J_PromoValue_"+a),g),DOM.val(DOM.get("#J_PromoType_"+a),0),DOM.hasClass("#J_Promo2Value_"+a,"input-price-focus")||(DOM.removeClass("#J_Promo2Value_"+a,"input-price"),DOM.addClass("#J_Promo2Value_"+a,"input-price-focus"),DOM.replaceClass("#J_PromoValue_"+a,"input-price-focus","input-price"));return},checkSkuPrice:function(a){return skupromoPrice=Number(DOM.val(a)),itemHandle.checkPrice(skupromoPrice)===!1?(DOM.addClass(a,"text-error"),a.value="",!1):(id=a.id,id=id.replace("Promo","Orig"),skuorigPrice=Number(DOM.val(DOM.get("#"+id))),DOM.removeClass(a,"text-error"),!0)},forceDelItem:function(a){var b=function(b){DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent"),DOM.html(DOM.get("#J_Status_"+a),'<div class="status-success"><div>\u6210\u529f\u9000\u51fa</div></div>'),DOM.hide("#J_forceDelItem_"+a)},c="promo_item_id="+a;DOM.show("#J_RightLoading"),DOM.hide("#J_MainRightContent"),(new H.widget.asyncRequest).setURI(forceDelUrl).setMethod("GET").setHandle(b).setData(c).send()},pausePromotionItemHandle:function(a,b){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;if(typeId==10){var c=IsExpired();if(c>-5e3){var d=function(c){promotionControl.pauseAction(a,b)},e=function(a){KISSY.Event.fire(".J_TopExpired","click")},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}else promotionControl.pauseAction(a,b)}else promotionControl.pauseAction(a,b)},pauseAction:function(a,b){var c='<div class="msgBoxImage ui-msg"><span class="img-32-4"></span></div><div class="msgBoxContent">\u786e\u5b9a\u6682\u505c\u5417\uff1f</div>';(new Overlay.Dialog({title:"\u6682\u505c\u63d0\u793a",width:440,mask:!0,buttons:[{text:"\u786e\u5b9a",elCls:"bui-button bui-button-primary",handler:function(){DOM.attr("#J_PausePromotionItems","disbaled",!0),itemIds=[],DOM.show("#J_RightLoading"),DOM.hide("#J_MainRightContent");if(a&&b)itemIds.push(a),pid=b;else{checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var c=checkBoxs.length;for(i=0;i<c;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&itemIds.push(checkBoxs[i].value)}if(itemIds.length==0){DOM.attr("#J_PausePromotionItems","disbaled",!1),DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:3e3});return}var d=function(a){DOM.attr("#J_PausePromotionItems","disbaled",!1),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems(),DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent")},e=function(a){DOM.attr("#J_PausePromotionItems","disbaled",!1),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error",autoClose:!0,timeOut:3e3}),DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent")},f="pid="+pid+"&item_ids="+itemIds+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(pausePromotionItemUrl).setMethod("POST").setHandle(d).setErrorHandle(e).setData(f).send(),this.destroy()}},{text:"\u53d6\u6d88",elCls:"bui-button J_buttonCancel",handler:function(){this.destroy()}}],bodyContent:c})).show()},restartPromotionItemHandle:function(a,b){itemIds=[],DOM.attr("#J_RestartPromotionItems","disbaled",!0),promotionControl.msg=new H.widget.msgBox({title:"",dialogType:"loading",content:"\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u5019"});if(a&&b)itemIds.push(a),pid=b;else{checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var c=checkBoxs.length;for(i=0;i<c;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&itemIds.push(checkBoxs[i].value)}if(itemIds.length==0){DOM.attr("#J_RestartPromotionItems","disbaled",!1),promotionControl.msg.hide(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:2e3});return}var d=function(d){promotionControl.msg.hide(),DOM.attr("#J_RestartPromotionItems","disbaled",!1);if(a&&b)DOM.hide(DOM.prev(DOM.get("#J_RestartPromoItem_"+a))),DOM.show(DOM.get("#J_RestartPromoItem_"+a));else for(i=0;i<c;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&(DOM.get("#J_Status_"+checkBoxs[i].value).innerHTML='<div class="status-pendding"><div>\u7b49\u5f85\u5904\u7406</div></div>',checkBoxs[i].disabled="disabled");var e=d.payload.waitTime,f=d.payload.finishAt;promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},e=function(a){promotionControl.msg.hide(),DOM.attr("#J_RestartPromotionItems","disbaled",!1),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error",autoClose:!0,timeOut:3e3})},f="pid="+pid+"&item_ids="+itemIds+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(restartPromotionItemUrl).setMethod("POST").setHandle(d).setErrorHandle(e).setData(f).send()},retry:function(a,b){var c=function(a){promotionControl.msg.hide(),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},d="promo_item_id="+a+"&force="+b;promotionControl.msg=new H.widget.msgBox({title:"",dialogType:"loading",content:"\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u5019"}),(new H.widget.asyncRequest).setURI(retryUrl).setMethod("GET").setHandle(c).setData(d).send()},batchRetry:function(){var a=function(a){promotionControl.msg.hide(),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},b="pid="+pid;promotionControl.msg=new H.widget.msgBox({title:"",dialogType:"loading",content:"\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u5019"}),(new H.widget.asyncRequest).setURI(batchRetryUrl).setMethod("GET").setHandle(a).setData(b).send()},editItem:function(a){var b=DOM.get("#J_itemBox_"+a);DOM.hasClass(b,"ks-hidden")?(DOM.removeClass(b,"ks-hidden"),DOM.attr(DOM.get("#J_TbItem_"+a+" .J_CheckBox"),"checked",!0)):(DOM.addClass(b,"ks-hidden"),DOM.attr(DOM.get("#J_TbItem_"+a+" .J_CheckBox"),"checked",!1)),checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var c=checkBoxs.length,d=0;for(i=0;i<c;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&d++;d>=2?DOM.show("#J_EditPromoItem"):DOM.hide("#J_EditPromoItem")},editPromoItem:function(promo_item_id,item_id){promotionControl.msg=new H.widget.msgBox({title:"",dialogType:"loading",content:"\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u5019"});var json=[],error=!1;DOM.attr("#J_EditPromoItem","disabled",!0),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-orange","btm-caozuo-gray-none");if(promo_item_id&&item_id){var id=promo_item_id,title=itemCheck.strProcess(DOM.val(DOM.get("#J_ItemTitle_"+id))),picUrl=DOM.val(DOM.get("#J_ItemPic_"+id)),price=DOM.val(DOM.get("#J_ItemPrice_"+id)),updatePic=DOM.val(DOM.get("#J_ItemUpdatePic_"+id)),paramsStr="";type=="spec"?(r=itemHandle.generalSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tbspec"||type=="onetbspec"||type=="tbspec_buyerLimit"?(r=itemHandle.generalTbSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tg"?(r=itemHandle.generalTgParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="jtj"&&(r=itemHandle.generalJtjParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params));if(error!==!1){promotionControl.msg.hide(),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange");return}o='{"id":"'+item_id+'", "title":"'+title+'","price":"'+price+'", "pic_url":"'+picUrl+'", "update_pic":"'+updatePic+'"'+paramsStr+"}",o=eval("("+o+")"),json.push(o)}else{Event.fire("#J_CancelEditAll","click"),checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var len=checkBoxs.length,privilegeJson=[];for(i=0;i<len;i++)if(checkBoxs[i].checked&&!checkBoxs[i].disabled){var id=checkBoxs[i].value,z=DOM.val(DOM.get("#J_PromoValue_"+id));privilegeJson.push(z)}DOM.val("#J_minPrivilege",Math.min.apply(null,privilegeJson));for(i=0;i<len;i++)if(checkBoxs[i].checked&&!checkBoxs[i].disabled){var id=checkBoxs[i].value,title=itemCheck.strProcess(DOM.val(DOM.get("#J_ItemTitle_"+id))),picUrl=DOM.val(DOM.get("#J_ItemPic_"+id)),price=DOM.val(DOM.get("#J_ItemPrice_"+id)),updatePic=DOM.val(DOM.get("#J_ItemUpdatePic_"+id)),itemId=DOM.val(DOM.get("#J_ItemId_"+id)),paramsStr="";type=="spec"?(r=itemHandle.generalSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tbspec"||type=="onetbspec"||type=="tbspec_buyerLimit"?(r=itemHandle.generalTbSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tg"?(r=itemHandle.generalTgParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="jtj"&&(r=itemHandle.generalJtjParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params));if(error!==!1){promotionControl.msg.hide(),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange");return}o='{"promoItemId":"'+id+'","id":"'+itemId+'", "title":"'+title+'","price":"'+price+'", "pic_url":"'+picUrl+'", "update_pic":"'+updatePic+'"'+paramsStr+"}",o=eval("("+o+")"),json.push(o)}}if(json.length==0){promotionControl.msg.hide(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:3e3}),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange");return}var itemsJson=KISSY.JSON.stringify(json),submitHandle=function(a){promotionControl.msg.hide(),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange"),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},errorHandle=function(a){promotionControl.msg.hide(),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error"})};if(promo_item_id&&item_id){var data="promoItemId="+promo_item_id+"&items="+itemsJson+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(editPromoItemUrl).setMethod("POST").setHandle(submitHandle).setErrorHandle(errorHandle).setData(data).send()}else{var data="&items="+itemsJson+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(batchEditPromoItemUrl).setMethod("POST").setHandle(submitHandle).setErrorHandle(errorHandle).setData(data).send()}},editAll:function(){var a=DOM.val("#J_Zhe");if(a=="1"){var b=DOM.val("#J_valueToAll");(b<0||b>10||isNaN(b))&&DOM.val("#J_valueToAll","10");if(b<.01||b>10||isNaN(b))b=10;b!=10&&b.indexOf(".")>0&&b.toString().split(".")[1].length>2&&(b=Number(b).toFixed(2),DOM.val(DOM.get("#J_valueToAll"),b))}else{var b=DOM.val("#J_value2ToAll");if(b<0||isNaN(b))DOM.val("#J_value2ToAll","0"),b=0;b.indexOf(".")>0&&b.toString().split(".")[1].length>2&&(b=Number(b).toFixed(2),DOM.val(DOM.get("#J_value2ToAll"),b))}DOM.val("#J_CurrentTab")>2?checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox"):checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var c=checkBoxs.length;for(m=0;m<c;m++)if(!checkBoxs[m].disabled){var d=checkBoxs[m].value,e=DOM.val("#J_ItemPrice_"+d),f=Number(DOM.val(DOM.get("#J_IsSku_"+d))),g=Number(DOM.val(DOM.get("#J_IsSkuNumUp_"+d)));if(g=="1"){var h=DOM.query("#J_PromoBox_"+d+" .J_SkuUpPrice");for(var i=0;i<h.length;i++){if(a=="1"){DOM.val(DOM.get("#J_PromoType_"+d),1),DOM.hasClass("#J_PromoValue_"+d,"input-price-focus")||(DOM.removeClass("#J_PromoValue_"+d,"input-price"),DOM.addClass("#J_PromoValue_"+d,"input-price-focus"),DOM.replaceClass("#J_Promo2Value_"+d,"input-price-focus","input-price"));var j=e-specPrice;DOM.val("#J_Promo2Value_"+d,Number(j).toFixed(2)),DOM.val(DOM.get("#J_PromoValue_"+d),Number(b).toFixed(2)),specPrice=b/10*e,specPrice=Math.floor(specPrice*100)/100}else{DOM.val(DOM.get("#J_PromoType_"+d),0),DOM.hasClass("#J_Promo2Value_"+d,"input-price-focus")||(DOM.removeClass("#J_Promo2Value_"+d,"input-price"),DOM.addClass("#J_Promo2Value_"+d,"input-price-focus"),DOM.replaceClass("#J_PromoValue_"+d,"input-price-focus","input-price"));var k=specPrice/e*10;DOM.val("#J_PromoValue_"+d,Number(k).toFixed(2)),DOM.val(DOM.get("#J_Promo2Value_"+d),Number(b).toFixed(2)),specPrice=Math.floor((e-b)*100)/100}DOM.html(h[i],Number(specPrice).toFixed(2))}}else if(a!="0"||f!="1"){a=="1"?(specPrice=b/10*e,specPrice=Math.floor(specPrice*100)/100):specPrice=Math.floor((e-b)*100)/100,f==0&&(a=="1"?(DOM.val(DOM.get("#J_PromoType_"+d),1),DOM.hasClass("#J_PromoValue_"+d,"input-price-focus")||(DOM.removeClass("#J_PromoValue_"+d,"input-price"),DOM.addClass("#J_PromoValue_"+d,"input-price-focus"),DOM.replaceClass("#J_Promo2Value_"+d,"input-price-focus","input-price"))):(DOM.val(DOM.get("#J_PromoType_"+d),0),DOM.hasClass("#J_Promo2Value_"+d,"input-price-focus")||(DOM.removeClass("#J_Promo2Value_"+d,"input-price"),DOM.addClass("#J_Promo2Value_"+d,"input-price-focus"),DOM.replaceClass("#J_PromoValue_"+d,"input-price-focus","input-price"))));var l=DOM.val(DOM.get("#J_IsInt_"+d));S.one("#J_PromoBox_"+d+" .duoguige")&&(l!=0&&a=="0"?DOM.show("#J_PromoBox_"+d+" .duoguige"):DOM.hide("#J_PromoBox_"+d+" .duoguige"));if(a=="1"){var j=e-specPrice;DOM.val("#J_Promo2Value_"+d,Number(j).toFixed(2)),DOM.val(DOM.get("#J_PromoValue_"+d),b)}else{var k=specPrice/e*10;DOM.val("#J_PromoValue_"+d,Number(k).toFixed(2)),DOM.val(DOM.get("#J_Promo2Value_"+d),b)}DOM.val(DOM.get("#J_SpecPrice_"+d),Number(specPrice).toFixed(2))}}},editAllJtj:function(){var a=DOM.val("#J_valueToAll"),b=DOM.val("#J_Zhe"),c=DOM.query("#J_TbItemList .J_CheckBox"),d=c.length,e=DOM.val("#J_laddersNum");for(m=0;m<d;m++)if(!c[m].disabled){var f=c[m].value,g=DOM.val("#J_ItemPrice_"+f),h=Number(DOM.val(DOM.get("#J_IsSku_"+f)));if(b!="0"||h!=1){b=="1"?(specPrice=a/10*g,specPrice=Math.floor(specPrice*100)/100):specPrice=Math.floor((g-a)*100)/100,h!=0;for(var i=1;i<=e;i++)DOM.val(DOM.get("#J_PromoValue_"+f+i),a),DOM.val(DOM.get("#J_SpecPrice_"+f+i),specPrice),h==0&&(b=="1"?DOM.val(DOM.get("#J_Type_"+f+i),1):DOM.val(DOM.get("#J_Type_"+f+i),0))}}},editTbspecQuZheng:function(){var a=0;DOM.prop("#J_QuzhengTo1","checked")?a=1:!DOM.prop("#J_QuzhengTo1","checked")&&DOM.prop("#J_QuzhengTo2","checked")?a=2:!DOM.prop("#J_QuzhengTo1","checked")&&!DOM.prop("#J_QuzhengTo2","checked")&&(a=0),DOM.val("#J_CurrentTab")>2?checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox"):checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var b=checkBoxs.length;for(m=0;m<b;m++)if(!checkBoxs[m].disabled){var c=checkBoxs[m].value,d=DOM.val("#J_ItemPrice_"+c),e=Number(DOM.val(DOM.get("#J_SpecPrice_"+c))),f=Number(DOM.val(DOM.get("#J_IsSku_"+c))),g=DOM.val(DOM.get("#J_PromoType_"+c));if(g=="1")var h=Number(DOM.val(DOM.get("#J_PromoValue_"+c)));else var h=Number(DOM.val(DOM.get("#J_Promo2Value_"+c)));if(g!="0"||f!="1")g=="1"?(e=h/10*d,e=Math.floor(e*100)/100):e=Math.floor((d-h)*100)/100,f==0&&(a==1?(e=Math.floor(e),DOM.val(DOM.get("#J_IsInt_"+c),a)):a==2?(e=itemCheck.FormatNumber(e,1),DOM.val(DOM.get("#J_IsInt_"+c),a)):a==0&&DOM.val(DOM.get("#J_IsInt_"+c),a)),S.one("#J_PromoBox_"+c+" .duoguige")&&(a!=0&&g=="0"?DOM.show("#J_PromoBox_"+c+" .duoguige"):DOM.hide("#J_PromoBox_"+c+" .duoguige")),DOM.val(DOM.get("#J_SpecPrice_"+c),e)}},editJtjQuZheng:function(){var a=0;DOM.prop("#J_QuzhengTo1","checked")?a=1:!DOM.prop("#J_QuzhengTo1","checked")&&DOM.prop("#J_QuzhengTo2","checked")?a=2:!DOM.prop("#J_QuzhengTo1","checked")&&!DOM.prop("#J_QuzhengTo2","checked")&&(a=0);var b=DOM.query("#J_TbItemList .J_CheckBox"),c=b.length,d=DOM.val("#J_laddersNum");for(m=0;m<c;m++)if(!b[m].disabled){var e=b[m].value,f=DOM.val("#J_ItemPrice_"+e),g=Number(DOM.val(DOM.get("#J_IsSku_"+e)));for(var h=1;h<=d;h++){var i=DOM.val(DOM.get("#J_PromoValue_"+e+h)),j=DOM.val(DOM.get("#J_Type_"+e+h));if(j!="0"||g!=1)j=="1"?(specPrice=i/10*f,specPrice=Math.floor(specPrice*100)/100):specPrice=Math.floor((f-i)*100)/100,g==0&&(a==1?(specPrice=Math.floor(specPrice),DOM.get("#J_IsInt_"+e).value=a):a==2?(specPrice=itemCheck.FormatNumber(specPrice,1),DOM.get("#J_IsInt_"+e).value=a):a==0&&(DOM.get("#J_IsInt_"+e).value=a)),DOM.val(DOM.get("#J_SpecPrice_"+e+h),specPrice)}}}}},{requires:["utils/showPages/index","./mods/item-handle","bui/select","utils/beautifyForm/index","bui/tooltip","overlay","./mods/check","bui/overlay","bui/calendar"]}); 