KISSY.add("utils/showPages/index",function(a){function e(a){var b=this;if(!(b instanceof e))return new e(a);this.pageNum=4,this.name=a,this.page=1,this.pageCount=200,this.argName="page"}var b=a.DOM,c=a.Event,d=document;return a.mix(e.prototype,{jump:function(){return undefined},checkPages:function(){isNaN(parseInt(this.page))&&(this.page=1),isNaN(parseInt(this.pageCount))&&(this.pageCount=1),this.page<1&&(this.page=1),this.pageCount<1&&(this.pageCount=1),this.page>this.pageCount&&(this.page=this.pageCount),this.page=parseInt(this.page),this.pageCount=parseInt(this.pageCount)},_createHtml:function(a){var b=this,c="",d=this.page-1,e=this.page+1;if(a==""||typeof a=="undefined")a=1;switch(a){case 1:c+='<span class="number">',this.page!=1&&(c+='<span title="Page 1"><a href="javascript:'+b.name+'.toPage(1);">1</a></span>'),this.page>=5&&(c+="<span>...</span>");if(this.pageCount>this.page+2)var f=this.page+2;else var f=this.pageCount;for(var g=this.page-2;g<=f;g++)g>0&&(g==this.page?c+='<span title="Page '+g+'">'+g+"</span>":g!=1&&g!=this.pageCount&&(c+='<span title="Page '+g+'"><a href="javascript:'+b.name+".toPage("+g+');">'+g+"</a></span>"));this.page+3<this.pageCount&&(c+="<span>...</span>"),this.page!=this.pageCount&&(c+='<span title="Page '+this.pageCount+'"><a href="javascript:'+b.name+".toPage("+this.pageCount+');">'+this.pageCount+"</a></span>"),c+="</span><br />";break;case 2:if(this.pageCount>1){c+='<div class="page-bottom"> <div class="sabrosus">',d<1?c+='<span class="pre-none page-pic-no"></span>':c+='<a class="" href="javascript:'+b.name+".toPage("+d+');" title="\u4e0a\u4e00\u9875"><span class="pre page-pic-no"></span></a>',this.page==1;if(this.page-2<=0){var h=1;if(this.pageCount>this.page+4)var f=this.page+4;else var f=this.pageCount}else if(this.page+2>=this.pageCount){var h=this.pageCount-4;if(this.pageCount>this.page+4)var f=this.page+4;else var f=this.pageCount}else{var h=this.page-2;if(this.pageCount>this.page+2)var f=this.page+2;else var f=this.pageCount}for(var g=h;g<=f;g++)g>0&&(g==this.page?c+='<span class="current a-padding">'+g+"</span>":c+='<a class="a-padding" href="javascript:'+b.name+".toPage("+g+');">'+g+"</a>");this.page+5<this.pageCount&&(c+='<a class="a-padding" title="" href="javascript:'+b.name+".toPage("+(this.page+3)+');">...</a>'),this.page==this.pageCount,e>this.pageCount?c+='<span class="next-none page-pic-no"></span>':c+='<a class="" href="javascript:'+b.name+".toPage("+e+');" title="\u4e0b\u4e00\u9875"><span class="next page-pic-no"></span></a>',this.pageCount>5&&(c+='<font class="number">',c+="\u5171"+this.pageCount+"\u9875&nbsp;\u5230\u7b2c&nbsp;",this.page>=this.pageCount?c+='<input style="" type="text" class="page-pic-no w-30 bg-img" id="pageInput'+b.name+'"  value="'+this.pageCount+'" onkeypress="return window.'+b.name+'.formatInputPage(event);" onfocus="this.select()">&nbsp;\u9875':c+='<input style="" type="text" class="page-pic-no w-30 bg-img" id="pageInput'+b.name+'"  value="'+(this.page+1)+'" onkeypress="return window.'+b.name+'.formatInputPage(event);" onfocus="this.select()">&nbsp;\u9875',c+='<input type="button" value="" class="page-pic-no gray-btm-h-go w-30 btm-go" onclick="javascript:var page = document.getElementById(\'pageInput'+b.name+"').value; if(isNaN(Number(page))|| Number(page)==0) { var turnTo = 1;} else if(page>"+this.pageCount+"){ var turnTo = "+this.pageCount+";} else{var turnTo = page;}  window."+b.name+'.toPage(turnTo);">',c+="</font>"),c+='<div style="clear:both"></div></div></div> '}break;case 3:c+='<div class="page-top"><div class="sabrosus"><span class="count">'+this.page+" / "+this.pageCount+"</span>",d<1?c+=' <span class="pre-none page-pic-no"></span>':c+='<a class="border-left-dedede" href="javascript:'+b.name+".toPage("+d+');" title="\u4e0a\u4e00\u9875"><span class="pre page-pic-no"></span></a>',e>this.pageCount?c+='<span class="next-none page-pic-no"></span>':c+='<a href="javascript:'+b.name+".toPage("+e+');" title="\u4e0b\u4e00\u9875"><span class="next page-pic-no"></span></a>',c+='<div style="clear:both"></div></div></div>'}return c},formatInputPage:function(a){var b=navigator.appName=="Microsoft Internet Explorer"?!0:!1;if(!b)var c=a.which;else var c=event.keyCode;return c==8||c==46||c>=48&&c<=57?!0:!1},toPage:function(a,b){var c=1,d=this;typeof a=="object"?c=a.options[a.selectedIndex].value:c=a,d.jump(c,b,"")},printHtml:function(a,c){return this.checkPages(),b.html(a,this._createHtml(c)),this},setPageCount:function(a){return this.pageCount=a,this},getPageCount:function(){return this.pageCount},setRender:function(a){return this.jump=a,this},setPageNum:function(a){return this.pageNum=a,this},setPage:function(a){return this.page=a,this}}),e}),KISSY.add("page/mods/item-handle",function(a){return itemHandle={strProcess:function(a){return a.replace(/\\/g,"\\\\").replace(/\"/g,'\\"').replace(/[\t\n&]/g,"%26")},checkPrice:function(a){return KISSY.isNumber(a)===!1||a<=0?!1:!0},isNull:function(a){return a==null||a==""?!0:!1},isDate:function(a){if(a==null)return!1;if(a.length!=19)return!1;var b=a.substring(0,4),c=a.substring(5,7),e=a.substring(8,10),f=a.substring(11,13),g=a.substring(14,16),h=a.substring(17,19);if(parseInt(b)<2011)return!1;y=parseInt(b,10),d=parseInt(e,10);switch(c){case"01":case"03":case"05":case"07":case"08":case"10":case"12":if(d>31)return!1;break;case"02":if(y%4==0&&d>29||y%4!=0&&d>28)return!1;break;case"04":case"06":case"09":case"11":if(d>30)return!1;break;default:return!1}return parseInt(f)>23||parseInt(g)>59||parseInt(h)>59?!1:a.substring(4,5)!="-"||a.substring(7,8)!="-"||a.substring(13,14)!=":"||a.substring(16,17)!=":"?!1:!0},generalTgParams:function(a,b){var c=[],d=[];result=itemHandle._generalTbSpecParams(a,b),paramsGeneral=result[0];var e=paramsGeneral[0],f=paramsGeneral[1],g=paramsGeneral[2],b=result[1];if(b)DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error");else{d.push(e),d.push(f);var h=DOM.val(DOM.get("#J_Promo_Start_Time")),i=DOM.val(DOM.get("#J_Promo_End_Time")),j=Number(DOM.val(DOM.get("#J_ItemParam_startNum_"+a))),k=Number(DOM.val(DOM.get("#J_ItemParam_minNum_"+a))),l=Number(DOM.val(DOM.get("#J_ItemParam_maxNum_"+a))),m=Number(DOM.val(DOM.get("#J_ItemParam_maxBuy_"+a))),n=DOM.val(DOM.get("#J_ItemParam_startAt_"+a)),o=DOM.val(DOM.get("#J_ItemParam_endAt_"+a)),p=DOM.val(DOM.get("#J_ItemParam_lastBuy_"+a)),q=DOM.val(DOM.get("#J_ItemParam_time_interval_"+a)),r=DOM.val(DOM.get("#J_ItemParam_tgtype_"+a));!KISSY.isNumber(j)||j<0?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u56e2\u8d2d\u521d\u59cb\u53c2\u56e2\u4eba\u6570\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e0\uff01",type:"error"}),DOM.get("#J_ItemParam_startNum_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_startNum_"+a),"text-error"),b=!0):!KISSY.isNumber(k)||k<0?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u6700\u5c11\u53c2\u56e2\u4eba\u6570\u5fc5\u987b\u5927\u4e8e0\uff01",type:"error"}),DOM.get("#J_ItemParam_minNum_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_minNum_"+a),"text-error"),b=!0):!KISSY.isNumber(l)||l<0||l<k?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u6700\u5927\u53c2\u56e2\u4eba\u6570\u5fc5\u987b\u5927\u4e8e0\u4e14\u5927\u4e8e\u7b49\u4e8e\u6700\u5c0f\u53c2\u56e2\u4eba\u6570\uff01",type:"error"}),DOM.get("#J_ItemParam_maxNum_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_maxNum_"+a),"text-error"),b=!0):!KISSY.isNumber(m)||m<0?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u6bcf\u4eba\u6700\u5927\u8d2d\u4e70\u91cf\u5fc5\u987b\u5927\u4e8e0\uff01",type:"error"}),DOM.get("#J_ItemParam_maxBuy_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_maxBuy_"+a),"text-error"),b=!0):itemHandle.isNull(n)||!itemHandle.isDate(n)?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u56e2\u8d2d\u5f00\u59cb\u65f6\u95f4\u5fc5\u987b\u4e3a\u65e5\u671f\u683c\u5f0f(\u4f8b2010-01-01 18:00:00\uff01",type:"error"}),DOM.get("#J_ItemParam_startAt_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_startAt_"+a),"text-error"),b=!0):itemHandle.isNull(o)||!itemHandle.isDate(o)?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u56e2\u8d2d\u7ed3\u675f\u65f6\u95f4\u5fc5\u987b\u4e3a\u65e5\u671f\u683c\u5f0f(\u4f8b2010-01-01 18:00:00)\uff09\uff01",type:"error"}),DOM.get("#J_ItemParam_endAt_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_endAt_"+a),"text-error"),b=!0):itemHandle.isNull(p)||!itemHandle.isDate(p)?(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4ed8\u6b3e\u622a\u81f3\u65f6\u95f4\u5fc5\u987b\u4e3a\u65e5\u671f\u683c\u5f0f\uff01",type:"error"}),DOM.get("#J_ItemParam_lastBuy_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_lastBuy_"+a),"text-error"),b=!0):n<h&&(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u56e2\u8d2d\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u65e9\u4e8e\u6d3b\u52a8\u5f00\u59cb\u65f6\u95f4"+h+"\uff01",type:"error"}),DOM.get("#J_ItemParam_startAt_"+a).focus(),DOM.addClass(DOM.get("#J_ItemParam_startAt_"+a),"text-error"),b=!0)}return d.push(j),d.push(k),d.push(l),d.push(m),d.push(p),d.push(n),d.push(o),d.push(g),d.push(r),d.push(q),c.push(b),c.push(d),c},_generalTbSpecParams:function(a,b){var c=[],d=DOM.get("#J_IsInt_"+a).value,e=Number(DOM.val(DOM.get("#J_SpecPrice_"+a))),f=Number(DOM.val(DOM.get("#J_ItemPrice_"+a))),g=Number(DOM.attr(DOM.get("#J_DecreaseNum_"+a),"title")),h=Number(DOM.val(DOM.get("#J_IsSku_"+a))),i=DOM.val(DOM.get("#J_Discount")),j=DOM.val("#J_minPrivilege"),k=DOM.val(DOM.get("#J_joinType")),l=0;if(h==1){var m="1";l=Number(DOM.val(DOM.get("#J_PromoValue_"+a)))}else if(d!=0||Number(DOM.val(DOM.get("#J_FinalType_"+a)))==3){var m="0";l=Number((f-e).toFixed(2))}else{var m=Number(DOM.get("#J_PromoType_"+a).value);m=="0"?l=Number((f-e).toFixed(2)):l=Number(DOM.val(DOM.get("#J_PromoValue_"+a)))}if(e>=f||itemHandle.checkPrice(l)===!1||itemHandle.checkPrice(e)==0)new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u7279\u4ef7\u91d1\u989d\u6709\u8bef\uff08\u7279\u4ef7\u5fc5\u987b\u5c0f\u4e8e\u539f\u4ef7\uff09\uff0c\u8bf7\u68c0\u67e5\u540e\u518d\u52a0\u5165\uff01",type:"error"}),b=!0;if(m=="0"){if(type=="tbspec"||type=="onetbspec"||type=="tbspec_buyerLimit"||type=="tg"||type=="jtj "||type=="onetbspec"){if(k=="all")var n=j;else var n=l;l>Number((f*((10-i)/10)).toFixed(2))&&(new H.widget.msgBox({title:"\u52a0\u5165\u6d3b\u52a8\u5931\u8d25",content:'\u6700\u4f4e\u6298\u6263\u7387\u4e3a  <em class="color-red">'+(10-l/f*10).toFixed(2)+'</em> \u6298\uff0c\u60a8\u7684\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u4e3a <em class="color-red" id="J_latest">'+i+"</em> \u6298\uff0c\u8bf7\u4fee\u6539\u60a8\u7684\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u540e\u518d\u91cd\u8bd5\uff01",type:"confirm",buttons:[{value:"\u7acb\u5373\u4fee\u6539"}],success:function(a){a=="\u7acb\u5373\u4fee\u6539"&&(window.open("http://ecrm.taobao.com/promotion/show_other_activity.htm"),promotionControl.getLowestDisAdd())}}),b=!0)}type!="tbspec"&&type!="tbspec_buyerLimit"&&type!="onetbspec"&&type!="tg"&&l>Number((f*.3).toFixed(2))&&(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f18\u60e0\u91d1\u989d\u6709\u8bef\uff0c\u6298\u6263\u6709\u6548\u8303\u56f4\u5728 7.00~9.99\u4e4b\u95f4\uff01",type:"error"}),b=!0)}else{if(type=="tbspec"||type=="onetbspec"||type=="tbspec_buyerLimit"||type=="tg"||type=="jtj "||type=="onetbspec"){if(k=="all")var n=j;else var n=l;l<i&&(new H.widget.msgBox({title:"\u52a0\u5165\u6d3b\u52a8\u5931\u8d25",content:'\u60a8\u8bbe\u7f6e\u7684\u5b9d\u8d1d\u6700\u4f4e\u6298\u6263\u4e3a <em class="color-red">'+n+'</em> \u6298\uff0c\u60a8\u7684\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u4e3a <em class="color-red" id="J_latest">'+i+"</em> \u6298\u8bf7\u4fee\u6539\u5e97\u94fa\u6700\u4f4e\u6298\u6263\u540e\u91cd\u65b0\u52a0\u5165\u6d3b\u52a8\uff01",type:"confirm",buttons:[{value:"\u7acb\u5373\u4fee\u6539"}],success:function(a){a=="\u7acb\u5373\u4fee\u6539"&&(window.open("http://ecrm.taobao.com/promotion/show_other_activity.htm"),promotionControl.getLowestDisAdd())}}),b=!0)}if(type!="tbspec"&&type!="tbspec_buyerLimit"&&type!="tg"&&type!="onetbspec")if(!KISSY.isNumber(l)||l<7||l>=10)new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 7.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),b=!0;else{var o=/(^[0-9]([.][0-9]{1,2})?$)|(^1[0-9]([.][0-9]{1,2})?$)|(^2[0-3]([.][0-9]{1,2})?$)|(^10([.]0{1,2})?$)/;o.test(l)||(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 7.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),b=!0)}}return l.toFixed(2),c.push(m),c.push(l),c.push(g),[c,b]},generalSpecParams:function(a,b){var c=[],d=[],e=Number(DOM.val(DOM.get("#J_PromoPrice_"+a)));itemHandle.checkPrice(e)===!1&&(b=!0,DOM.addClass(DOM.get("#J_PromoPrice_"+a),"text-error")),d.push(e);if(DOM.get("#J_ItemSkus_"+a)==null)return d.push(""),c.push(b),c.push(d),c;var f=DOM.val(DOM.get("#J_ItemSkus_"+a)),g=DOM.val(DOM.get("#J_PropsName_"+a)),h=DOM.val(DOM.get("#J_PropsValue_"+a)),i=[],j="",k="",l=DOM.query("#J_SkuTable_"+a+" .J_SkuOrigPrice"),m=DOM.query("#J_SkuTable_"+a+" .J_SkuPromoPrice"),n=l.length;for(var o=0;o<n;o++)spp=Number(m[o].value),sop=Number(l[o].value),itemHandle.checkPrice(spp)===!1?(DOM.addClass(m[o],"text-error"),b=!0):DOM.removeClass(m[o],"text-error"),k+=m[o].value+",",j+=l[o].value+",";return j=j.substring(0,j.length-1),k=k.substring(0,k.length-1),i.push(j),i.push(k),i.push(f),i.push(g),i.push(h),d.push(i),c.push(b),c.push(d),c},generalTbSpecParams:function(a,b){var c=[],d=[];result=itemHandle._generalTbSpecParams(a,b),d=result[0];var b=result[1];return b&&DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),c.push(b),c.push(d),c},generalJtjParams:function(a,b){var c=[],d=DOM.val("#J_IsSku_"+a),e=Number(DOM.val(DOM.get("#J_ItemPrice_"+a))),f=DOM.query("#J_PromoType_"+a+" .J_promoType"),g=DOM.query("#J_PromoType_"+a+" .J_PromoValue"),h=DOM.query("#J_PromoType_"+a+" .J_PromoIsInt");if(h.length<=0)var i=DOM.get("#J_IsInt_"+a).value;var j=g.length;for(var k=0;k<j;k++){if(h.length>0)var i=Number(DOM.val(h[k]));if(i!=0){var l="0",m=g[k].id.replace("PromoValue","SpecPrice"),n=Number(DOM.val(DOM.get("#"+m)));newValue=Number((e-n).toFixed(2))}else{var l=Number(DOM.val(f[k]));if(l=="0"){var m=g[k].id.replace("PromoValue","SpecPrice"),n=Number(DOM.val(DOM.get("#"+m)));newValue=Number((e-n).toFixed(2))}else newValue=Number(DOM.val(g[k]))}n>=e&&(DOM.addClass(g[k],"text-error"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u7279\u4ef7\u91d1\u989d\u6709\u8bef\uff08\u7279\u4ef7\u5fc5\u987b\u5c0f\u4e8e\u539f\u4ef7\uff09\uff0c\u8bf7\u68c0\u67e5\u540e\u518d\u52a0\u5165\uff01",type:"error"}),b=!0);if(d=="1"||l=="1")if(!KISSY.isNumber(newValue)||newValue<=0||newValue>=10)DOM.addClass(g[k],"text-error"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\uff01",type:"error"}),b=!0;else{var o=/(^[0-9]([.][0-9]{1,2})?$)|(^1[0-9]([.][0-9]{1,2})?$)|(^2[0-3]([.][0-9]{1,2})?$)|(^10([.]0{1,2})?$)/;o.test(newValue)||(new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(g[k],"text-error"),b=!0)}else itemHandle.checkPrice(newValue)===!1&&(DOM.addClass(g[k],"text-error"),b=!0);if(b==1)break;param=[l,newValue],c.push(param)}return[b,c]}}},{requires:[]}),KISSY.add("page/item-init",function(S,showPages,itemHandle){var DOM=S.DOM,Event=S.Event;return promotionControl={isTarget:!1,processStatus:0,paginator:null,promotionItemPaginator:null,itemCache:null,promotionItemCache:null,panel:null,titlePanel:null,designIconPanel:null,initDesignFlag:!1,initiconPanelFlag:!1,iconPanel:null,iconArr:[],msg:null,bd:null,tabs:null,init:function(){var a=null;Event.delegate(document,"click dblclick",".J_AddToPromo",function(b){promotionControl.processStatus=0;if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8")){promotionControl.processStatus=1;return}promotionControl.addBefore();var c=DOM.attr(b.currentTarget,"data");c==1?(DOM.val("#J_ExpiredActionType","addItems"),DOM.val("#J_joinType","all")):(DOM.val("#J_ExpiredActionType","addItem"),DOM.attr("#J_ExpiredActionType","data",c),DOM.val("#J_joinType",c)),DOM.removeAttr("#J_joinType","item-id"),b.type=="click"&&(clearTimeout(a),a=setTimeout(function(){var a=function(a){if(a.payload>=150&&!KISSY.inArray(typeId,["130","10","22","2","32","107","105","207"]))promotionControl.addAfter(),new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u975e\u5168\u5e97\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e150\u4e2a\uff0c\u73b0\u5728\u5df2\u7ecf\u52a0\u5165"+a.payload+"\u8bf7\u5220\u9664\u591a\u4f59\u7684\u5b9d\u8d1d\uff0c\u6216\u914c\u60c5\u5206\u591a\u6b21\u6d3b\u52a8\u521b\u5efa",type:"info"}),promotionControl.processStatus=2;else{var b=IsExpired();if(b>-5e3){var d=function(a){promotionControl.joinLowestDis(c)},e=function(a){KISSY.Event.fire(".J_TopExpired","click"),promotionControl.addAfter(),promotionControl.processStatus=3},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}else promotionControl.joinLowestDis(c)}},b=function(a){promotionControl.addAfter(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error"})},d="promo_id="+pid;(new H.widget.asyncRequest).setURI(getPromoItemNumUrl).setMethod("GET").setHandle(a).setErrorHandle(b).setData(d).send()},300));if(b.type=="dblclick"){clearTimeout(a);var d=function(a){if(a.payload>=150&&!KISSY.inArray(typeId,["130","10","22","2","32","107","105","207"]))promotionControl.addAfter(),new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u975e\u5168\u5e97\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e150\u4e2a\uff0c\u73b0\u5728\u5df2\u7ecf\u52a0\u5165"+a.payload+"\u8bf7\u5220\u9664\u591a\u4f59\u7684\u5b9d\u8d1d\uff0c\u6216\u914c\u60c5\u5206\u591a\u6b21\u6d3b\u52a8\u521b\u5efa",type:"info"}),promotionControl.processStatus=2;else{var b=IsExpired();if(b>-5e3){var d=function(a){promotionControl.joinLowestDis(c)},e=function(a){KISSY.Event.fire(".J_TopExpired","click"),promotionControl.addAfter(),promotionControl.processStatus=3},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}else promotionControl.joinLowestDis(c)}},e=function(a){promotionControl.addAfter(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error"})},f="promo_id="+pid;(new H.widget.asyncRequest).setURI(getPromoItemNumUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}}),promotionControl.getLowestDis(),Event.on("#J_updateDiscount","click",function(){DOM.val("#J_isDiscount","1");var a=IsExpired();if(a>-5e3){var b=function(a){promotionControl.getLowestDis()},c=function(a){KISSY.Event.fire(".J_TopExpired","click")},d="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(b).setErrorHandle(c).setData(d).send()}else promotionControl.getLowestDis()}),Event.delegate(document,"click",".J_isEdit",function(a){var b=DOM.attr(a.currentTarget,"pid"),c=DOM.attr(a.currentTarget,"item-id");DOM.val("#J_joinType",b),DOM.attr("#J_joinType",{"item-id":c})}),Event.on("#J_EditPromoItem","click",function(){DOM.val("#J_joinType","all")}),Event.delegate(document,"click dblclick",".J_removeToPromo",function(a){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;var b=DOM.attr(a.currentTarget,"tid");DOM.val("#J_ExpiredActionType",b);if(b=="editorOne"){var c=DOM.attr(a.currentTarget,"data");DOM.attr("#J_ExpiredActionType","data",c)}else b=="restartOne"&&(c=DOM.attr(a.currentTarget,"data"),pidd=DOM.attr(a.currentTarget,"pid"),DOM.attr("#J_ExpiredActionType","data",c),DOM.attr("#J_ExpiredActionType","pid",pidd));var d=IsExpired();if(d>-5e3){var e=function(a){b=="editorOne"?promotionControl.editItem(c):b=="editorAll"?promotionControl.editPromoItem():b=="restartOne"?promotionControl.restartPromotionItemHandle(c,pidd):b=="restartAll"?promotionControl.restartPromotionItemHandle():b=="batchRetryAll"&&promotionControl.batchRetry()},f=function(a){KISSY.Event.fire(".J_TopExpired","click")},g="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(e).setErrorHandle(f).setData(g).send()}else b=="editorOne"?promotionControl.editItem(c):b=="editorAll"?promotionControl.editPromoItem():b=="restartOne"?promotionControl.restartPromotionItemHandle(c,pidd):b=="restartAll"?promotionControl.restartPromotionItemHandle():b=="batchRetryAll"&&promotionControl.batchRetry()}),Event.delegate(document,"click dblclick","#J_BatchAddItems",function(b){DOM.val("#J_ExpiredActionType","batchAdd"),b.type=="click"&&(clearTimeout(a),a=setTimeout(function(){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;DOM.attr("#J_BatchAddItems","disabled",!0),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray","btm-caozuo-gray-none");var a=IsExpired();if(a>-5e3){var b=function(a){promotionControl.batchAddItems()},c=function(a){DOM.attr("#J_BatchAddItems","disabled",!1),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray-none","btm-caozuo-gray"),KISSY.Event.fire(".J_TopExpired","click")},d="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(b).setErrorHandle(c).setData(d).send()}else promotionControl.batchAddItems()},300));if(b.type=="dblclick"){clearTimeout(a);if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;DOM.attr("#J_BatchAddItems","disabled",!0),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray","btm-caozuo-gray-none");var c=IsExpired();if(c>-5e3){var d=function(a){promotionControl.batchAddItems()},e=function(a){DOM.attr("#J_BatchAddItems","disabled",!1),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray-none","btm-caozuo-gray"),KISSY.Event.fire(".J_TopExpired","click")},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}else promotionControl.batchAddItems()}}),Event.on("#J_filterCurrent","click",function(a){a.currentTarget.checked==1?(DOM.removeAttr("#J_filterSimilar","checked"),DOM.val("#J_filter","1")):DOM.val("#J_filter","0"),promotionControl.searchTbItems()}),Event.on("#J_filterSimilar","click",function(a){a.currentTarget.checked==1?(DOM.removeAttr("#J_filterCurrent","checked"),DOM.val("#J_filter","2")):DOM.val("#J_filter","0"),promotionControl.searchTbItems()}),Event.on("#J_SyncItemsButton","click",function(a){var b=DOM.parent(a.currentTarget);DOM.hide(b);var c=function(a){new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u540c\u6b65\u6570\u636e\u8bf7\u6c42\u6210\u529f\uff0c\u8bf7\u70b9\u51fb\u641c\u7d22\u67e5\u770b\u5b9d\u8d1d\u3002\u5982\u65e0\u6cd5\u663e\u793a\u8bf7\u8fc71\u5206\u949f\u5de6\u53f3\u518d\u67e5\u770b\uff01",type:"info"}),KISSY.later(function(a){DOM.show(a)},6e4,!1,null,b)},d="";(new H.widget.asyncRequest).setURI(syncItemsUrl).setHandle(c).setMethod("GET").setData(d).setDataType("json").send()}),Event.on("#J_SearchBtn","click",promotionControl.searchTbItems),Event.on("#J_RightSearchBtn","click",promotionControl.loadPromotionItems),Event.on("#J_CheckAll","click",promotionControl.checkAll),Event.on("#J_TopCheckAll","click",promotionControl.checkAll),Event.on("#J_RightCheckAll","click",promotionControl.rightCheckAll),Event.on("#J_RemovePromotionItems","click",promotionControl.removePromotionItemHandle),Event.on("#J_PausePromotionItems","click",promotionControl.pausePromotionItemHandle),Event.on("#J_Sort .sort","click",function(a){if(DOM.hasClass(a.currentTarget,"current"))return;DOM.removeClass(DOM.query("#J_Sort .sort"),"current"),DOM.addClass(a.currentTarget,"current");var b=DOM.attr(a.currentTarget,"data")+":desc";DOM.val("#J_SortValue",b),promotionControl.searchTbItems(),DOM.html("#J_SortName",DOM.html(a.currentTarget))})},joinLowestDis:function(a){var b=function(b){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.val("#J_Discount",b.payload),DOM.text("#J_storeDiscount",b.payload+" \u6298"),a=="1"?promotionControl.addSelectItemsToPromotion():promotionControl.addSelectItemsToPromotion(a)},c=function(b){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.text("#J_storeDiscount",b.desc),a=="1"?promotionControl.addSelectItemsToPromotion():promotionControl.addSelectItemsToPromotion(a)};DOM.show("#J_loadingDiscount"),DOM.hide("#J_storeDiscount");var d=0,e="fg="+d;(new H.widget.asyncRequest).setURI(getLowestDisUrl).setMethod("GET").setHandle(b).setErrorHandle(c).setData(e).send()},getLowestDis:function(){var a=function(a){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.val("#J_Discount",a.payload),DOM.text("#J_storeDiscount",a.payload+" \u6298")},b=function(a){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.text("#J_storeDiscount",a.desc)};DOM.show("#J_loadingDiscount"),DOM.hide("#J_storeDiscount");var c=DOM.val("#J_isDiscount"),d="fg="+c;(new H.widget.asyncRequest).setURI(getLowestDisUrl).setMethod("GET").setHandle(a).setErrorHandle(b).setData(d).send()},getLowestDisAgain:function(){var a=DOM.val(DOM.get("#J_joinType")),b=DOM.attr("#J_joinType","item-id"),c=function(c){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.val("#J_Discount",c.payload),DOM.text("#J_storeDiscount",c.payload+" \u6298"),DOM.html("#J_latest",c.payload),a=="all"?b!=undefined?promotionControl.editPromoItem():promotionControl.addSelectItemsToPromotion():b!=undefined?promotionControl.editPromoItem(a,b):promotionControl.addSelectItemsToPromotion(a)},d=function(c){DOM.hide("#J_loadingDiscount"),DOM.show("#J_storeDiscount"),DOM.text("#J_storeDiscount",c.desc),a=="all"?b!=undefined?promotionControl.editPromoItem():promotionControl.addSelectItemsToPromotion():b!=undefined?promotionControl.editPromoItem(a,b):promotionControl.addSelectItemsToPromotion(a)};DOM.show("#J_loadingDiscount"),DOM.hide("#J_storeDiscount");var e=DOM.val("#J_isDiscount"),f="fg="+e;(new H.widget.asyncRequest).setURI(getLowestDisUrl).setMethod("GET").setHandle(c).setErrorHandle(d).setData(f).send()},getLowestDisAdd:function(){new H.widget.msgBox({title:"\u91cd\u65b0\u52a0\u5165\u6d3b\u52a8",content:"\u6211\u5df2\u7ecf\u4fee\u6539\u5b8c\u6298\u6263\uff0c\u91cd\u65b0\u52a0\u5165\u6d3b\u52a8\uff1f",type:"popup",buttons:[{value:"\u91cd\u65b0\u52a0\u5165"},{value:"\u53d6\u6d88"}],success:function(a){if(a=="\u91cd\u65b0\u52a0\u5165"){var b=IsExpired();if(b>-5e3){var c=function(a){promotionControl.getLowestDisAgain()},d=function(a){KISSY.Event.fire(".J_TopExpired","click")},e="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(c).setErrorHandle(d).setData(e).send()}else promotionControl.getLowestDisAgain()}}})},deleteTbSpec:function(a,b){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;var c=function(a){promotionControl.paginator?promotionControl.paginator.toPage(promotionControl.paginator.page):promotionControl.searchPromoItems()},d=function(b){DOM.show("#J_deleteTbSpec_"+a),DOM.hide("#J_MinLoading_"+a)};DOM.hide("#J_deleteTbSpec_"+a),DOM.show("#J_MinLoading_"+a);var e="item_id="+a;(new H.widget.asyncRequest).setURI(delTbSpecUrl).setMethod("GET").setHandle(c).setErrorHandle(d).setData(e).setDataType("json").send()},batchAddItems:function(){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;var a=function(a){new H.widget.msgBox({title:"\u6210\u529f\u63d0\u793a",content:"\u64cd\u4f5c\u6210\u529f",type:"info"}),S.later(function(){window.location.reload()},1e3,!1,null,null)},b="&pid="+pid,c=DOM.val(DOM.get("#J_SelectItemCid"));if(DOM.val(DOM.get("#J_SearchTitle"))!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801")var d=encodeURIComponent(DOM.val(DOM.get("#J_SearchTitle")));else var d="";var e=DOM.val(DOM.get("#J_SearchSelling"));b+="&title="+d+"&cid="+c+"&type="+e;var f=DOM.val(DOM.get("#J_StartPrice")),g=DOM.val(DOM.get("#J_EndPrice"));b+="&start_price="+f+"&end_price="+g,DOM.attr("#J_BatchAddItems","disabled",!0),DOM.replaceClass("#J_BatchAddItems","btm-caozuo-gray","btm-caozuo-gray-none"),(new H.widget.asyncRequest).setURI(batchAddUrl).setMethod("GET").setHandle(a).setData(b).send()},getParamsData:function(){if(DOM.val(DOM.get("#J_SearchTitle"))!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801")var a=encodeURIComponent(DOM.val(DOM.get("#J_SearchTitle")));else var a="";var b=DOM.val("#J_filter"),c=DOM.val(DOM.get("#J_SelectItemCid")),d=DOM.val(DOM.get("#J_SearchSelling")),e=DOM.val("#J_SortValue");if(e==0||e==1)var f=DOM.val(DOM.get("#J_SelectItemOrder"));else var f=e;var g=DOM.val(DOM.get("#J_SelectItemPage")),h="q="+a+"&cid="+c+"&type="+d;h+="&itemOrder="+f+"&pageSize="+g,h+="&pid="+pid,h+="&is_filter="+b;var i=DOM.val(DOM.get("#J_StartPrice")),j=DOM.val(DOM.get("#J_EndPrice"));return h+="&start_price="+i+"&end_price="+j,h},searchTbItems:function(){var a=function(a){DOM.removeClass(".J_ItemSelectBtnHolder","ks-hidden"),DOM.get("#J_NoteIcon").style.display="none",totalRecords=a.payload.totalRecords,totalRecords>0?(DOM.get("#J_LEmpty").style.display="none",DOM.css(DOM.query(".J_ItemSelectBtnHolder"),"display","")):(DOM.get("#J_LEmpty").style.display="",DOM.css(DOM.query(".J_ItemSelectBtnHolder"),"display","none")),promotionControl.renderItems(a.payload.body),pageCount=Math.ceil(totalRecords/a.payload.pageNum),promotionControl.paginator=(new showPages("promotionControl.paginator")).setRender(promotionControl.handlePagination).setPageCount(pageCount).printHtml("#J_Paging",2),promotionControl.paginator=(new showPages("promotionControl.paginator")).setRender(promotionControl.handlePagination).setPageCount(pageCount).printHtml("#J_TopPaging",3),DOM.hide("#J_LeftLoading"),DOM.show("#J_MainLeftContent")},b=function(a){DOM.hide("#J_Loading"),DOM.show("#J_MainLeftContent"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error",autoClose:!0,timeOut:3e3})},c=promotionControl.getParamsData();DOM.show("#J_LeftLoading"),DOM.hide("#J_MainLeftContent"),(new H.widget.asyncRequest).setURI(getItemsFromTbUrl).setMethod("GET").setHandle(a).setErrorHandle(b).setData(c).setDataType("json").send()},renderItems:function(a){DOM.html(DOM.get("#J_TbItemList"),a,!0);var b=DOM.val("#J_SortValue");b==0||b==1?(DOM.hide(DOM.query(".J_NormVal")),DOM.html("#J_SortName","")):DOM.show(DOM.query(".J_NormVal")),DOM.attr("#J_TopCheckAll","checked",!1),DOM.attr("#J_CheckAll","checked",!1);var c=DOM.query("#J_TbItemList .J_CheckBox");Event.on(c,"click",promotionControl.checkBoxClick);var d=DOM.filter(DOM.query("input"),function(a){if(a.type=="text")return!0});Event.on(d,"focus blur",function(a){a.type=="focus"?(DOM.removeClass(a.target,"input-text text text-error"),DOM.addClass(a.target,"input-text-on")):a.type=="blur"&&(DOM.removeClass(a.target,"input-text-on"),DOM.addClass(a.target,"input-text"))})},checkBoxClick:function(a){var b=this.value,c=DOM.get("#J_PromoBox_"+b),d=DOM.get("#J_Operation_"+b),e=DOM.get("#J_tejia_"+b);this.checked||(DOM.attr("#J_TopCheckAll","checked",!1),DOM.attr("#J_CheckAll","checked",!1)),DOM.hasClass(c,"ks-hidden")?DOM.removeClass([c,d,e],"ks-hidden"):DOM.addClass([c,d,e],"ks-hidden")},handlePagination:function(a){pageId=a;var b=function(a){totalRecords=a.payload.totalRecords,totalRecords>0?(DOM.get("#J_LEmpty").style.display="none",DOM.css(DOM.query(".J_ItemSelectBtnHolder"),"display","")):(DOM.get("#J_LEmpty").style.display="",DOM.css(DOM.query(".J_ItemSelectBtnHolder"),"display","none")),pageCount=Math.ceil(totalRecords/a.payload.pageNum),promotionControl.paginator.setPage(pageId).setPageCount(pageCount).printHtml("#J_Paging",2),promotionControl.paginator.setPage(pageId).setPageCount(pageCount).printHtml("#J_TopPaging",3),promotionControl.renderItems(a.payload.body),DOM.hide("#J_LeftLoading"),DOM.show("#J_MainLeftContent")},c=promotionControl.getParamsData();c+="&page_id="+pageId,DOM.show("#J_LeftLoading"),DOM.hide("#J_MainLeftContent"),(new H.widget.asyncRequest).setURI(getItemsFromTbUrl).setMethod("GET").setHandle(b).setData(c).send()},checkAll:function(a){checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var b=checkBoxs.length;for(i=0;i<b;i++){var c=checkBoxs[i].value;if(checkBoxs[i].disabled)continue;this.checked?(DOM.removeClass(DOM.get("#J_PromoBox_"+c),"ks-hidden"),DOM.removeClass(DOM.get("#J_Operation_"+c),"ks-hidden"),DOM.removeClass(DOM.get("#J_tejia_"+c),"ks-hidden"),checkBoxs[i].checked=!0):(DOM.addClass(DOM.get("#J_tejia_"+c),"ks-hidden"),DOM.addClass(DOM.get("#J_PromoBox_"+c),"ks-hidden"),DOM.addClass(DOM.get("#J_Operation_"+c),"ks-hidden"),checkBoxs[i].checked=!1)}this.id=="J_CheckAll"?this.checked?DOM.attr("#J_TopCheckAll","checked",!0):DOM.attr("#J_TopCheckAll","checked",!1):this.checked?DOM.attr("#J_CheckAll","checked",!0):DOM.attr("#J_CheckAll","checked",!1)},rightCheckAll:function(a){checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var b=checkBoxs.length;for(i=0;i<b;i++){var c=checkBoxs[i].value;if(checkBoxs[i].disabled)continue;this.checked?checkBoxs[i].checked=!0:checkBoxs[i].checked=!1}},loadPromotionItems:function(){var a=function(a){totalRecords=a.payload.totalRecords,totalRecords>0?(DOM.get("#J_REmpty").style.display="none",DOM.css(DOM.query(".J_PromotionItemBtnHolder"),"display",""),KISSY.inArray(typeId,["108","106","111","208"])&&a.payload.sucNum==1&&new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:'\u6dd8\u5b9d\u89c4\u5b9a\u8be5\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u81f3\u5c11<em style="color:red">2</em>\u4e2a\u624d\u53ef\u751f\u6548\uff0c\u8bf7\u518d\u6dfb\u52a0\u5b9d\u8d1d\uff01&nbsp;&nbsp;<a target="_blank" href="http://bangpai.taobao.com/group/thread/474028-276305668.htm">\u67e5\u770b\u5b98\u65b9\u89c4\u5219</a>',type:"info",buttons:[{value:"\u6dfb\u52a0\u5b9d\u8d1d"}],success:function(a){a=="\u6dfb\u52a0\u5b9d\u8d1d"&&tabs.switchTo(0)}}),DOM.val("#J_TotalPromoItems",totalRecords)):(DOM.get("#J_REmpty").style.display="",DOM.css(DOM.query(".J_PromotionItemBtnHolder"),"display","none")),DOM.html(DOM.get("#J_PromotionItemList"),a.payload.body,!0);var b=DOM.query("#J_PromotionItemList .J_CheckBox");Event.on(b,"click",function(a){this.checked||DOM.attr("#J_RightCheckAll","checked",!1)}),DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent");var c=DOM.filter(DOM.query("input"),function(a){if(a.type=="text")return!0});Event.on(c,"focus blur",function(a){a.type=="focus"?(DOM.removeClass(a.target,"input-text text text-error"),DOM.addClass(a.target,"input-text-on")):a.type=="blur"&&(DOM.removeClass(a.target,"input-text-on"),DOM.addClass(a.target,"input-text"))}),pageCount=Math.ceil(totalRecords/a.payload.pageNum),promotionControl.promotionItemPaginator=(new showPages("promotionControl.promotionItemPaginator")).setRender(promotionControl.promotionItemPaginationHandle).setPageCount(pageCount).printHtml("#J_PromotionItemPaging",2)};if(DOM.val(DOM.get("#J_RightSearchTitle"))!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801")var b=encodeURIComponent(DOM.val(DOM.get("#J_RightSearchTitle")));else var b="";var c=DOM.val(DOM.get("#J_SearchStatus")),d=DOM.val(DOM.get("#J_RightSelectItemPage")),e="promo_id="+promotionId+"&status="+c+"&title="+b+"&pageSize="+d,f=DOM.val(DOM.get("#J_RightStartPrice")),g=DOM.val(DOM.get("#J_RightEndPrice"));e+="&start_price="+f+"&end_price="+g,DOM.show("#J_RightLoading"),DOM.hide("#J_MainRightContent"),(new H.widget.asyncRequest).setURI(loadPromotionItemsUrl).setMethod("GET").setHandle(a).setData(e).send()},promotionItemPaginationHandle:function(a,b){pageId=a;var c=function(a){DOM.get("#J_RightCheckAll").checked=!1,totalRecords=a.payload.totalRecords,totalRecords>0?(DOM.get("#J_REmpty").style.display="none",DOM.css(DOM.query(".J_PromotionItemBtnHolder"),"display",""),DOM.val("#J_TotalPromoItems",totalRecords),KISSY.inArray(typeId,["108","106","111","208"])&&a.payload.sucNum==1&&new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:'\u90e8\u5206\u53c2\u4e0e\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u9700<em style="color:red">\u81f3\u5c11\u4e24\u4e2a</em>\uff0c\u5426\u5219\u6d3b\u52a8\u4e0d\u4f1a\u751f\u6548\uff01',type:"info",buttons:[{value:"\u6dfb\u52a0\u5b9d\u8d1d"}],success:function(a){a=="\u6dfb\u52a0\u5b9d\u8d1d"&&tabs.switchTo(0)}}),DOM.val("#J_TotalPromoItems",totalRecords)):(DOM.get("#J_REmpty").style.display="",DOM.css(DOM.query(".J_PromotionItemBtnHolder"),"display","none")),pageCount=Math.ceil(totalRecords/a.payload.pageNum),promotionControl.promotionItemPaginator.setPage(pageId).setPageCount(pageCount).printHtml("#J_PromotionItemPaging",2),DOM.html(DOM.get("#J_PromotionItemList"),a.payload.body);var c=DOM.query("#J_PromotionItemList .J_CheckBox");Event.on(c,"click",function(a){this.checked||DOM.attr("#J_RightCheckAll","checked",!1)}),b!="update"&&(DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent"));var d=DOM.filter(DOM.query("input"),function(a){if(a.type=="text")return!0});Event.on(d,"focus blur",function(a){a.type=="focus"?(DOM.removeClass(a.target,"input-text text text-error"),DOM.addClass(a.target,"input-text-on")):a.type=="blur"&&(DOM.removeClass(a.target,"input-text-on"),DOM.addClass(a.target,"input-text"))})};b!="update"&&(DOM.show("#J_RightLoading"),DOM.hide("#J_MainRightContent"));if(DOM.val(DOM.get("#J_RightSearchTitle"))!="\u5173\u952e\u5b57\u3001\u5546\u54c1\u94fe\u63a5\u3001\u5546\u54c1\u7f16\u7801")var d=encodeURIComponent(DOM.val(DOM.get("#J_RightSearchTitle")));else var d="";var e=DOM.val(DOM.get("#J_RightSelectItemPage")),f=DOM.val(DOM.get("#J_SearchStatus")),g="promo_id="+promotionId+"&status="+f+"&title="+d+"&page_id="+pageId+"&pageSize="+e,h=DOM.val(DOM.get("#J_RightStartPrice")),i=DOM.val(DOM.get("#J_RightEndPrice"));g+="&start_price="+h+"&end_price="+i,(new H.widget.asyncRequest).setURI(loadPromotionItemsUrl).setMethod("GET").setHandle(c).setData(g).send()},removePromotionItemHandle:function(a,b,c){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;if(c=="promoItems")var d=DOM.val("#J_TypeIdItem_"+a);if(d==10){var e=IsExpired();if(e>-5e3){var f=function(d){promotionControl.deletePromotionItemHandle(a,b,c)},g=function(a){KISSY.Event.fire(".J_TopExpired","click")},h="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(f).setErrorHandle(g).setData(h).send()}else promotionControl.deletePromotionItemHandle(a,b,c)}else promotionControl.deletePromotionItemHandle(a,b,c)},deletePromotionItemHandle:function(a,b,c){itemIds=[],c=="promoItems"?(DOM.hide("#J_RemovePromo_"+a),DOM.show("#J_MinLoading_"+a)):(DOM.attr("#J_RemovePromotionItems","disabled",!0),DOM.replaceClass("#J_RemovePromotionItems","btm-caozuo-orange","btm-caozuo-gray-none"));if(a&&b)itemIds.push(a),pid=b;else{checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var d=checkBoxs.length;for(i=0;i<d;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&itemIds.push(checkBoxs[i].value);if(itemIds.length==0){new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u62e9\u4efb\u4f55\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:2e3}),DOM.attr("#J_RemovePromotionItems","disabled",!1),DOM.replaceClass("#J_RemovePromotionItems","btm-caozuo-gray-none","btm-caozuo-orange");return}}var e=function(a){DOM.attr("#J_RemovePromotionItems","disabled",!1),DOM.replaceClass("#J_RemovePromotionItems","btm-caozuo-gray-none","btm-caozuo-orange"),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page,"update"):promotionControl.loadPromotionItems()},f="pid="+pid+"&item_ids="+itemIds+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(removePromotionItemUrl).setMethod("POST").setHandle(e).setData(f).send()},hasItems:function(){checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var a=checkBoxs.length,b=!1;for(i=0;i<a;i++)if(checkBoxs[i].checked&&!checkBoxs[i].disabled){b=!0;break}return b},addSelectItemsToPromotion:function(iid){promotionControl.addBefore(),checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var json=[],longTitleItemIds=[];itemXml="";var error=!1,len=checkBoxs.length,translateDiv=DOM.get("#J_Translate"),privilegeJson=[];for(i=0;i<len;i++){var id=checkBoxs[i].value,z=DOM.val(DOM.get("#J_PromoValue_"+id));privilegeJson.push(z)}DOM.val("#J_minPrivilege",Math.min.apply(null,privilegeJson));for(i=0;i<len;i++){var flag=!1;iid!=undefined?checkBoxs[i].value==iid&&!checkBoxs[i].disabled&&(flag=!0):checkBoxs[i].checked&&!checkBoxs[i].disabled&&(flag=!0);if(flag==1){var totalNum=Number(DOM.val("#J_TotalPromoItems"));totalNum+=1;if(totalNum>150&&!KISSY.inArray(typeId,["130","10","22","2","32","107","105","207"])){new H.widget.msgBox({title:"\u6e29\u99a8\u63d0\u793a",content:"\u975e\u5168\u5e97\u6d3b\u52a8\u5b9d\u8d1d\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e150\u4e2a\uff0c\u73b0\u5728\u5df2\u7ecf\u52a0\u5165"+totalNum+"\u8bf7\u5220\u9664\u591a\u4f59\u7684\u5b9d\u8d1d\uff0c\u6216\u914c\u60c5\u5206\u591a\u6b21\u6d3b\u52a8\u521b\u5efa\uff01",type:"info"});break}DOM.val("#J_TotalPromoItems",totalNum);var id=checkBoxs[i].value,title=H.util.strProcess(DOM.val(DOM.get("#J_ItemTitle_"+id))),picUrl=DOM.val(DOM.get("#J_ItemPic_"+id)),price=DOM.val(DOM.get("#J_ItemPrice_"+id)),updatePic=DOM.val(DOM.get("#J_ItemUpdatePic_"+id)),outId=H.util.strProcess(DOM.val(DOM.get("#J_ItemOuterId_"+id))),paramsStr="";type=="spec"?(r=itemHandle.generalSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tbspec"||type=="onetbspec"||type=="tbspec_buyerLimit"?(r=itemHandle.generalTbSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tg"?(r=itemHandle.generalTgParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="jtj"&&(r=itemHandle.generalJtjParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params));if(error!==!1)break;o='{"id":"'+id+'", "outer_id":"'+outId+'", "title":"'+title+'", "price":"'+price+'", "pic_url":"'+picUrl+'", "update_pic":"'+updatePic+'"'+paramsStr+"}",o=eval("("+o+")"),json.push(o);if(iid!=undefined)break}}if(error){promotionControl.addAfter(),promotionControl.processStatus=4;return}if(json.length==0){new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u62e9\u4efb\u4f55\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:2e3}),promotionControl.addAfter();return}var itemsJson=KISSY.JSON.stringify(json),submitHandle=function(a){promotionControl.addAfter();if(a.payload.limit!=null)status="\u64cd\u4f5c\u5931\u8d25",new H.widget.msgBox({title:"\u64cd\u4f5c\u5931\u8d25",content:a.payload.limit,type:"error"});else{var b=a.payload.waitTime,c=a.payload.finishAt,d=checkBoxs.length;promotionControl.paginator?promotionControl.paginator.toPage(promotionControl.paginator.page):promotionControl.searchTbItems()}promotionControl.processStatus=5},errorHandle=function(a){promotionControl.processStatus=6,promotionControl.addAfter(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error"})},data="pid="+pid+"&items="+itemsJson+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(addItemsToPromotionUrl).setMethod("POST").setHandle(submitHandle).setErrorHandle(errorHandle).setData(data).send()},addAfter:function(){DOM.show(DOM.query(".J_addItem")),DOM.hide(DOM.query(".J_adding")),DOM.attr("#J_TopAddToPromo","disabled",!1),DOM.replaceClass("#J_TopAddToPromo","btm-caozuo-gray-none","btm-caozuo-orange "),DOM.attr("#J_BtmAddToPromo","disabled",!1),DOM.replaceClass("#J_BtmAddToPromo","btm-caozuo-gray-none","btm-caozuo-orange ")},addBefore:function(){DOM.hide(DOM.query(".J_addItem")),DOM.show(DOM.query(".J_adding")),DOM.attr("#J_TopAddToPromo","disabled",!0),DOM.replaceClass("#J_TopAddToPromo","btm-caozuo-orange","btm-caozuo-gray-none"),DOM.attr("#J_BtmAddToPromo","disabled",!0),DOM.replaceClass("#J_BtmAddToPromo","btm-caozuo-orange","btm-caozuo-gray-none")},getTjtSpecPrice:function(a,b,c){var d=Number(DOM.get("#J_PromoValue_"+a).value),e=Number(DOM.get("#J_Type_"+a).value),f=Number(DOM.get("#J_ItemPrice_"+b).value);if(c=="promoItem")var g=0;else var g=DOM.get("#J_IsInt_"+b).value;var h;e=="1"?(h=d/10*f,h=Math.round(h*100)/100):h=Math.round((f-d)*100)/100,g==1?h=Math.ceil(h):g==2&&(h=H.util.FormatNumber(h,1));if(e=="1"){if(!KISSY.isNumber(d)||d<0||d>=10)return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),!1;var i=/(^[0-9]([.][0-9]{1,2})?$)|(^1[0-9]([.][0-9]{1,2})?$)|(^2[0-3]([.][0-9]{1,2})?$)|(^10([.]0{1,2})?$)/;if(!i.test(d))return new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u4f20\u5165\u4e86\u4e0d\u5408\u6cd5\u6216\u4e0d\u6b63\u786e\u7684\u53c2\u6570,\u6709\u6548\u8303\u56f4\u5728 0.00~9.99\u4e4b\u95f4\uff01",type:"error"}),DOM.addClass(DOM.get("#J_PromoValue_"+a),"text-error"),!1}c=="promoItem"&&DOM.val("#J_IsInt_"+a,"0"),DOM.removeClass(DOM.get("#J_PromoValue_"+a),"text-error"),DOM.val(DOM.get("#J_SpecPrice_"+a),h)},getTjtPromoValue:function(a,b,c){Event.fire(DOM.query("#options_J_Type_"+a+" li")[1],"click");var d=DOM.get("#J_Type_"+a).value,e=Number(DOM.get("#J_ItemPrice_"+b).value),f=Number(DOM.get("#J_SpecPrice_"+a).value),g;d=="0"?(g=Math.round((e-f)*100)/100,DOM.get("#J_PromoValue_"+a).value=g):(g=Number((f/e*10).toFixed(2)),DOM.get("#J_PromoValue_"+a).value=g),c=="promoItem"&&DOM.val("#J_IsInt_"+a,"1");return},showTitleParam:function(a){var b=DOM.get("#J_ParamsTitle_"+a);b.style.display=="none"?(b.style.display="",DOM.get("#J_UpdateTitle_"+a).value="1"):(b.style.display="none",DOM.get("#J_UpdateTitle_"+a).value="0");return},toggleSku:function(a){var b=DOM.get("#J_SkuTable_"+a);DOM.hasClass(b,"ks-hidden")?DOM.removeClass(b,"ks-hidden"):DOM.addClass(b,"ks-hidden")},checkPromoPrice:function(a){return promoPrice=Number(a.value),itemHandle.checkPrice(promoPrice)===!1?(DOM.addClass(a,"text-error"),a.value="",!1):(id=a.id,id=id.replace("Promo","Item"),itemPrice=Number(DOM.get("#"+id).value),DOM.removeClass(a,"text-error"),promotionControl.autoSkuPrice(a),!0)},autoSkuPrice:function(a){value=a.value,id=a.id.replace("J_PromoPrice_","");var b=DOM.query("#J_SkuTable_"+id+" .J_SkuPromoPrice"),c=b.length;for(var d=0;d<c;d++)b[d].value=value;return},getSpecPrice:function(a,b,c){var d=Number(DOM.get("#J_PromoValue_"+a).value),e=DOM.get("#J_PromoType_"+a).value,f=Number(DOM.val(DOM.get("#J_IsSku_"+a))),g=Number(DOM.get("#J_ItemPrice_"+a).value),h=Number(DOM.val(DOM.get("#J_PromoIsInt_"+a))),i;DOM.val(DOM.get("#J_FinalType_"+a),"0");if(f==1)i=d/10*g,i=Math.round(i*100)/100;else{var j=DOM.get("#J_IsInt_"+a).value;h&&j!=2&&DOM.val("#J_IsInt_"+a,"1"),e=="1"?(KISSY.one("#J_PromoBox_"+a+" .duoguige")&&DOM.hide("#J_PromoBox_"+a+" .duoguige"),i=d/10*g,i=Math.round(i*100)/100):(KISSY.one("#J_PromoBox_"+a+" .duoguige")&&DOM.show("#J_PromoBox_"+a+" .duoguige"),i=Math.round((g-d)*100)/100);var j=DOM.get("#J_IsInt_"+a).value;j==1?i=Math.ceil(i):j==2&&(i=H.util.FormatNumber(i,1))}DOM.val(DOM.get("#J_SpecPrice_"+a),i)},getPromoValue:function(a,b){DOM.val("#J_IsInt_"+a,"0"),DOM.val(DOM.get("#J_FinalType_"+a),"3"),Event.fire(DOM.query("#options_J_PromoType_"+a+" li")[1],"click");var c=DOM.get("#J_PromoType_"+a).value,d=Number(DOM.get("#J_ItemPrice_"+a).value),e=Number(DOM.get("#J_SpecPrice_"+a).value),f;c=="0"?(KISSY.one("#J_PromoBox_"+a+" .duoguige")&&DOM.show("#J_PromoBox_"+a+" .duoguige"),f=Math.round((d-e)*100)/100,DOM.get("#J_PromoValue_"+a).value=f):(f=(e/d*10).toFixed(2),DOM.get("#J_PromoValue_"+a).value=f);return},checkSkuPrice:function(a){return skupromoPrice=Number(a.value),itemHandle.checkPrice(skupromoPrice)===!1?(DOM.addClass(a,"text-error"),a.value="",!1):(id=a.id,id=id.replace("Promo","Orig"),skuorigPrice=Number(DOM.get("#"+id).value),DOM.removeClass(a,"text-error"),!0)},forceDelItem:function(a){var b=function(b){DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent"),DOM.html(DOM.get("#J_Status_"+a),'<div class="status-success"><div>\u6210\u529f\u9000\u51fa</div></div>'),DOM.hide("#J_forceDelItem_"+a)},c="promo_item_id="+a;DOM.show("#J_RightLoading"),DOM.hide("#J_MainRightContent"),(new H.widget.asyncRequest).setURI(forceDelUrl).setMethod("GET").setHandle(b).setData(c).send()},pausePromotionItemHandle:function(a,b){if(!showPermissions("editor_promotion","\u7f16\u8f91\u4fc3\u9500\u6d3b\u52a8"))return;if(typeId==10){var c=IsExpired();if(c>-5e3){var d=function(c){promotionControl.pauseAction(a,b)},e=function(a){KISSY.Event.fire(".J_TopExpired","click")},f="";(new H.widget.asyncRequest).setURI(isExpiredUrl).setMethod("GET").setHandle(d).setErrorHandle(e).setData(f).send()}else promotionControl.pauseAction(a,b)}else promotionControl.pauseAction(a,b)},pauseAction:function(a,b){DOM.attr("#J_PausePromotionItems","disbaled",!0),itemIds=[],DOM.show("#J_RightLoading"),DOM.hide("#J_MainRightContent");if(a&&b)itemIds.push(a),pid=b;else{checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var c=checkBoxs.length;for(i=0;i<c;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&itemIds.push(checkBoxs[i].value)}if(itemIds.length==0){DOM.attr("#J_PausePromotionItems","disbaled",!1),DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:3e3});return}var d=function(a){DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent"),DOM.attr("#J_PausePromotionItems","disbaled",!1),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},e=function(a){DOM.attr("#J_PausePromotionItems","disbaled",!1),DOM.hide("#J_RightLoading"),DOM.show("#J_MainRightContent"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error",autoClose:!0,timeOut:3e3})},f="pid="+pid+"&item_ids="+itemIds+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(pausePromotionItemUrl).setMethod("POST").setHandle(d).setErrorHandle(e).setData(f).send()},restartPromotionItemHandle:function(a,b){itemIds=[],DOM.attr("#J_RestartPromotionItems","disbaled",!0),promotionControl.msg=new H.widget.msgBox({title:"",dialogType:"loading",content:"\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u5019"});if(a&&b)itemIds.push(a),pid=b;else{checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var c=checkBoxs.length;for(i=0;i<c;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&itemIds.push(checkBoxs[i].value)}if(itemIds.length==0){DOM.attr("#J_RestartPromotionItems","disbaled",!1),promotionControl.msg.hide(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:2e3});return}var d=function(d){promotionControl.msg.hide(),DOM.attr("#J_RestartPromotionItems","disbaled",!1);if(a&&b)DOM.hide(DOM.prev(DOM.get("#J_RestartPromoItem_"+a))),DOM.show(DOM.get("#J_RestartPromoItem_"+a));else for(i=0;i<c;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&(DOM.get("#J_Status_"+checkBoxs[i].value).innerHTML='<div class="status-pendding"><div>\u7b49\u5f85\u5904\u7406</div></div>',checkBoxs[i].disabled="disabled");var e=d.payload.waitTime,f=d.payload.finishAt;promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},e=function(a){DOM.attr("#J_RestartPromotionItems","disbaled",!1),promotionControl.msg.hide(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error",autoClose:!0,timeOut:3e3})},f="pid="+pid+"&item_ids="+itemIds+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(restartPromotionItemUrl).setMethod("POST").setHandle(d).setErrorHandle(e).setData(f).send()},retry:function(a,b){var c=function(a){promotionControl.msg.hide(),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},d="promo_item_id="+a+"&force="+b;promotionControl.msg=new H.widget.msgBox({title:"",dialogType:"loading",content:"\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u5019"}),(new H.widget.asyncRequest).setURI(retryUrl).setMethod("GET").setHandle(c).setData(d).send()},batchRetry:function(){var a=function(a){promotionControl.msg.hide(),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},b="pid="+pid;promotionControl.msg=new H.widget.msgBox({title:"",dialogType:"loading",content:"\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u5019"}),(new H.widget.asyncRequest).setURI(batchRetryUrl).setMethod("GET").setHandle(a).setData(b).send()},editItem:function(a){var b=DOM.get("#J_itemBox_"+a),c=DOM.get("#J_itemPromoDetail_"+a);DOM.hasClass(c,"ks-hidden")?DOM.removeClass(c,"ks-hidden"):DOM.addClass(c,"ks-hidden"),DOM.hasClass(b,"ks-hidden")?(DOM.removeClass(b,"ks-hidden"),DOM.attr(DOM.get("#J_Item_"+a+" .J_CheckBox"),"checked",!0)):(DOM.addClass(b,"ks-hidden"),DOM.attr(DOM.get("#J_Item_"+a+" .J_CheckBox"),"checked",!1)),checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var d=checkBoxs.length,e=0;for(i=0;i<d;i++)checkBoxs[i].checked&&!checkBoxs[i].disabled&&e++;e>=2?DOM.show("#J_EditPromoItem"):DOM.hide("#J_EditPromoItem")},editPromoItem:function(promo_item_id,item_id){promotionControl.msg=new H.widget.msgBox({title:"",dialogType:"loading",content:"\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u5019"});var json=[],error=!1;DOM.attr("#J_EditPromoItem","disabled",!0),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-orange","btm-caozuo-gray-none");if(promo_item_id&&item_id){var id=promo_item_id,title=H.util.strProcess(DOM.val(DOM.get("#J_ItemTitle_"+id))),picUrl=DOM.val(DOM.get("#J_ItemPic_"+id)),price=DOM.val(DOM.get("#J_ItemPrice_"+id)),updatePic=DOM.val(DOM.get("#J_ItemUpdatePic_"+id)),paramsStr="";type=="spec"?(r=itemHandle.generalSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tbspec"||type=="onetbspec"||type=="tbspec_buyerLimit"?(r=itemHandle.generalTbSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tg"?(r=itemHandle.generalTgParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="jtj"&&(r=itemHandle.generalJtjParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params));if(error!==!1){promotionControl.msg.hide(),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange");return}o='{"id":"'+item_id+'", "title":"'+title+'","price":"'+price+'", "pic_url":"'+picUrl+'", "update_pic":"'+updatePic+'"'+paramsStr+"}",o=eval("("+o+")"),json.push(o)}else{checkBoxs=DOM.query("#J_PromotionItemList .J_CheckBox");var len=checkBoxs.length,privilegeJson=[];for(i=0;i<len;i++){var id=checkBoxs[i].value,z=DOM.val(DOM.get("#J_PromoValue_"+id));privilegeJson.push(z)}DOM.val("#J_minPrivilege",Math.min.apply(null,privilegeJson));for(i=0;i<len;i++)if(checkBoxs[i].checked&&!checkBoxs[i].disabled){var id=checkBoxs[i].value,title=H.util.strProcess(DOM.val(DOM.get("#J_ItemTitle_"+id))),picUrl=DOM.val(DOM.get("#J_ItemPic_"+id)),price=DOM.val(DOM.get("#J_ItemPrice_"+id)),updatePic=DOM.val(DOM.get("#J_ItemUpdatePic_"+id)),itemId=DOM.val(DOM.get("#J_ItemId_"+id)),paramsStr="";type=="spec"?(r=itemHandle.generalSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tbspec"||type=="onetbspec"||type=="tbspec_buyerLimit"?(r=itemHandle.generalTbSpecParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="tg"?(r=itemHandle.generalTgParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params)):type=="jtj"&&(r=itemHandle.generalJtjParams(id,error),error=r[0],params=r[1],paramsStr=', "params":'+KISSY.JSON.stringify(params));if(error!==!1){promotionControl.msg.hide(),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange");return}o='{"promoItemId":"'+id+'","id":"'+itemId+'", "title":"'+title+'","price":"'+price+'", "pic_url":"'+picUrl+'", "update_pic":"'+updatePic+'"'+paramsStr+"}",o=eval("("+o+")"),json.push(o)}}if(json.length==0){promotionControl.msg.hide(),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:"\u672a\u9009\u5b9d\u8d1d\uff01",type:"error",autoClose:!0,timeOut:3e3}),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange");return}var itemsJson=KISSY.JSON.stringify(json),submitHandle=function(a){promotionControl.msg.hide(),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange"),promotionControl.promotionItemPaginator?promotionControl.promotionItemPaginator.toPage(promotionControl.promotionItemPaginator.page):promotionControl.loadPromotionItems()},errorHandle=function(a){promotionControl.msg.hide(),DOM.attr("#J_EditPromoItem","disabled",!1),DOM.replaceClass("#J_EditPromoItem","btm-caozuo-gray-none","btm-caozuo-orange"),new H.widget.msgBox({title:"\u9519\u8bef\u63d0\u793a",content:a.desc,type:"error"})};if(promo_item_id&&item_id){var data="promoItemId="+promo_item_id+"&items="+itemsJson+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(editPromoItemUrl).setMethod("POST").setHandle(submitHandle).setErrorHandle(errorHandle).setData(data).send()}else{var data="&items="+itemsJson+"&form_key="+FORM_KEY;(new H.widget.asyncRequest).setURI(batchEditPromoItemUrl).setMethod("POST").setHandle(submitHandle).setErrorHandle(errorHandle).setData(data).send()}},editAll:function(){var a=DOM.val("#J_valueToAll"),b=DOM.val("#J_Zhe");checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var c=checkBoxs.length;for(m=0;m<c;m++)if(!checkBoxs[m].disabled){var d=checkBoxs[m].value,e=DOM.val("#J_ItemPrice_"+d),f=Number(DOM.val(DOM.get("#J_IsSku_"+d)));if(b!="0"||f!="1"){b=="1"?(specPrice=a/10*e,specPrice=Math.round(specPrice*100)/100):specPrice=Math.round((e-a)*100)/100,f==0&&(b=="1"?DOM.val(DOM.get("#J_PromoType_"+d),1):DOM.val(DOM.get("#J_PromoType_"+d),0));var g=DOM.get("#J_IsInt_"+d).value;S.one("#J_PromoBox_"+d+" .duoguige")&&(g!=0&&b=="0"?DOM.show("#J_PromoBox_"+d+" .duoguige"):DOM.hide("#J_PromoBox_"+d+" .duoguige")),DOM.val(DOM.get("#J_PromoValue_"+d),a),DOM.val(DOM.get("#J_SpecPrice_"+d),specPrice)}}},editAllJtj:function(){var a=DOM.val("#J_valueToAll"),b=DOM.val("#J_Zhe"),c=DOM.query("#J_TbItemList .J_CheckBox"),d=c.length,e=DOM.val("#J_laddersNum");for(m=0;m<d;m++)if(!c[m].disabled){var f=c[m].value,g=DOM.val("#J_ItemPrice_"+f),h=Number(DOM.val(DOM.get("#J_IsSku_"+f)));if(b!="0"||h!=1){b=="1"?(specPrice=a/10*g,specPrice=Math.round(specPrice*100)/100):specPrice=Math.round((g-a)*100)/100,h!=0;for(var i=1;i<=e;i++)DOM.val(DOM.get("#J_PromoValue_"+f+i),a),DOM.val(DOM.get("#J_SpecPrice_"+f+i),specPrice),h==0&&(b=="1"?DOM.val(DOM.get("#J_Type_"+f+i),1):DOM.val(DOM.get("#J_Type_"+f+i),0))}}},editTbspecQuZheng:function(){var a=0;DOM.prop("#J_QuzhengTo1","checked")?a=1:!DOM.prop("#J_QuzhengTo1","checked")&&DOM.prop("#J_QuzhengTo2","checked")?a=2:!DOM.prop("#J_QuzhengTo1","checked")&&!DOM.prop("#J_QuzhengTo2","checked")&&(a=0),checkBoxs=DOM.query("#J_TbItemList .J_CheckBox");var b=checkBoxs.length;for(m=0;m<b;m++)if(!checkBoxs[m].disabled){var c=checkBoxs[m].value,d=DOM.val("#J_ItemPrice_"+c),e=Number(DOM.val(DOM.get("#J_IsSku_"+c))),f=DOM.val(DOM.get("#J_PromoValue_"+c)),g=DOM.val(DOM.get("#J_PromoType_"+c));if(g!="0"||e!="1")g=="1"?(specPrice=f/10*d,specPrice=Math.round(specPrice*100)/100):specPrice=Math.round((d-f)*100)/100,e==0&&(a==1?(specPrice=Math.ceil(specPrice),DOM.get("#J_IsInt_"+c).value=a):a==2?(specPrice=H.util.FormatNumber(specPrice,1),DOM.get("#J_IsInt_"+c).value=a):a==0&&(DOM.get("#J_IsInt_"+c).value=a)),S.one("#J_PromoBox_"+c+" .duoguige")&&(a!=0&&g=="0"?DOM.show("#J_PromoBox_"+c+" .duoguige"):DOM.hide("#J_PromoBox_"+c+" .duoguige")),DOM.val(DOM.get("#J_SpecPrice_"+c),specPrice)}},editJtjQuZheng:function(){var a=0;DOM.prop("#J_QuzhengTo1","checked")?a=1:!DOM.prop("#J_QuzhengTo1","checked")&&DOM.prop("#J_QuzhengTo2","checked")?a=2:!DOM.prop("#J_QuzhengTo1","checked")&&!DOM.prop("#J_QuzhengTo2","checked")&&(a=0);var b=DOM.query("#J_TbItemList .J_CheckBox"),c=b.length,d=DOM.val("#J_laddersNum");for(m=0;m<c;m++)if(!b[m].disabled){var e=b[m].value,f=DOM.val("#J_ItemPrice_"+e),g=Number(DOM.val(DOM.get("#J_IsSku_"+e)));for(var h=1;h<=d;h++){var i=DOM.val(DOM.get("#J_PromoValue_"+e+h)),j=DOM.val(DOM.get("#J_Type_"+e+h));if(j!="0"||g!=1)j=="1"?(specPrice=i/10*f,specPrice=Math.round(specPrice*100)/100):specPrice=Math.round((f-i)*100)/100,g==0&&(a==1?(specPrice=Math.ceil(specPrice),DOM.get("#J_IsInt_"+e).value=a):a==2?(specPrice=H.util.FormatNumber(specPrice,1),DOM.get("#J_IsInt_"+e).value=a):a==0&&(DOM.get("#J_IsInt_"+e).value=a)),DOM.val(DOM.get("#J_SpecPrice_"+e+h),specPrice)}}}}},{requires:["utils/showPages/index","./mods/item-handle"]}); 