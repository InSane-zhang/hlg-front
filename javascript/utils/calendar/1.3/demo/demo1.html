<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>弹出式日历</title>
    <!--
  		<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
      -->
      <link href="http://tb-new.huanleguang.com/css/hlg/v3/region/base.css" rel="stylesheet">

    <script src="http://g.tbcdn.cn/kissy/k/1.3.0/kissy-min.js" charset="utf-8"></script>
</head>
<body>

 <div class="container">
         <div class="span12">



            <h4>Simple Date &amp; Time Picker</h4>
            <div class="well">

               <form class="form-horizontal">
                 <fieldset>
                  <div class="control-group">
                    <label class="control-label" for="reservationtime">Reservation dates:</label>
                    <div class="controls">
                     <div class="input-prepend">
                       <span class="add-on"><i class="glyphicon glyphicon-calendar icon-calendar"></i></span>
                       <input type="text" style="width: 300px" name="reservation" id="reservationtime" value="2013年10月08日 06:44 到 2013年12月12日 18:27"  class="span4"/>
                     </div>
                    </div>
                  </div>
                 </fieldset>
               </form>

            </div>            



         </div>








      </div>
<input id="single" type="text" />



<style type="text/css">
#list input{width:20em;padding:5px;}
</style>

<input id="list-1" type="hidden" >
<div id="list">

<div style="padding:20px;"><input class="aaa" type="text" value="2013-08-23 13:05 到 2014-02-21 12:09" /></div>
<div style="padding:20px;"><input class="aaa" type="text" value="2013-09-15 08:24 到 2014-09-15 22:35" /></div>
<div style="padding:20px;"><input class="aaa" type="text" value="2013-08-23 13:05 到 2014-02-21 12:09" /></div>
<div style="padding:20px;"><input class="aaa" type="text" value="" /></div>
</div>





<script>
var S = KISSY;
S.Config.debug = true;
if (S.Config.debug) {
    var srcPath = "../../../";
    S.config({
        packages:[
            {
                name:"gallery",
                path:srcPath,
                charset:"utf-8",
                ignorePackageNameInUri:true
            }
        ]
    });
}

S.use('gallery/calendar/1.3/index,gallery/calendar/1.3/moment', function(S, Calendar, moment) {
    var $ = S.all, Event = S.Event;
    console.log(moment);

 	var abc = new Calendar('#reservationtime',{
                    timePicker: true,
                    format: 'YYYY年MM月DD日 HH:mm',
					separator: ' 到 ',
					timePicker12Hour : false,
					minDate: new Date("2013/9/09 20:08")
                  });

  var calender2 = new Calendar('.aaa',{
                    single: true,
                    timePicker: true,
                    format: 'YYYY年MM月DD日 HH:mm',
          separator: ' 到 ',
          timePicker12Hour : false,
          minDate: new Date("2013/9/09 20:08")
                  }, function(start, end){
                    this.element[0].value = start.format('YYYY-MM-DD');
                  });

  //建立公用的日历对象
  var calendar3 = new Calendar('#list-1', {
    timePicker: true
  }, function(start, end, agent){
    $(agent).val(start.format('YYYY-MM-DD HH:mm') + ' 到 ' + end.format('YYYY-MM-DD HH:mm'));
  });

  //构建对象 (输入框, 指向的日历对象)
  function multiCalendar(elems, which){
    this.calendar = which;
    this.elems = $(elems);

    this.create();
    return this;
  }

  S.augment(multiCalendar, {
    create: function(){
      var self = this;
      //获取
      var calendar = self.calendar;
      Event.on(self.elems, 'focus', function(ev){
        var elem = $(ev.currentTarget);

        var value = elem.val().split(' 到 ');
        var startDay = value[0].split(' ')[0].split('-');
        var startTime = value[0].split(' ')[1].split(':');
        var endDay = value[1].split(' ')[0].split('-');
        var endTime = value[1].split(' ')[1].split(':');

        var startY = Number(startDay[0]);
        var startMon = Number(startDay[1]);
        var startD = Number(startDay[2]);
        var startH = Number(startTime[0]);
        var startMin = Number(startTime[1]);

        var endY = Number(endDay[0]);
        var endMon = Number(endDay[1]);
        var endD = Number(endDay[2]);
        var endH = Number(endTime[0]);
        var endMin = Number(endTime[1]);

        
        calendar.startDate = moment(new Date(startY, startMon-1, startD, startH, startMin, 0));
        calendar.endDate = moment(new Date(endY, endMon-1, endD, endH, endMin, 59));

        calendar.updateView();
        calendar.updateCalendars();



        calendar.agent = elem;

        var _left = elem.offset().left;
        var _top = elem.offset().top + elem.outerHeight();
        calendar.container.css({'left': _left + 'px', 'top': _top + 'px'}).show();

        $(document).on('mousedown', calendar.hide, calendar);
        
      });
    }
  });

  //new multiCalendar('#list input', calendar3);


});
</script>
</body>
</html>