KISSY.add("utils/beautifyForm/index",function(a){function g(b,c){var d=this;defaultCfg={init:!0};if(!(d instanceof g))return new g(b,c);var e=a.merge(defaultCfg,c);d._init(b,e)}var b=a.DOM,c=a.Event,d=document,e=b.get("body"),f=!1;return a.UA.safari!="undefined"&&a.UA.safari<3&&(f=!0),a.UA.ie==6&&b.replaceClass("#J_BodyHtml","has-js","no-js"),a.augment(g,{_init:function(a,b){var c=this;c.renderAll(a)},renderAll:function(a){var c=this;a=typeof a=="undefined"?"#J_BodyHtml":a;var d=b.filter(b.query(a+" input"),function(a){if(a.type=="checkbox"||a.type=="radio")return!0});for(var e=d.length-1;e>=0;e--)c.renderInput(d[e])},renderInput:function(a){var c=this,d=b.get(a),e=b.parent(d);e.tagName.toUpperCase()=="LABEL"&&e.className.indexOf("beautify_")>-1?e.className=="beautify_check"?c.renderCheckbox(d):e.className=="beautify_radio"&&c.renderRadio(d):e.tagName.toUpperCase()=="SPAN"&&b.hasClass(d,"beautify_input")&&c.renderCheckPro(d)},renderAllCheckPro:function(a){var c=this,d=b.filter(b.query(a+" input"),function(a){if((a.type=="checkbox"||a.type=="radio")&&b.hasClass(a,"beautify_input"))return!0});if(d.length<1)return;for(var e=d.length-1;e>=0;e--)c.renderCheckPro(d[e])},renderAllCheckbox:function(c){var d=this,e=b.filter(b.query(c+" input"),function(a){if(a.type=="checkbox")return!0});if(e.length<1){a.log("\u6b64id\u4e0b\u6ca1\u6709input(renderAllCheckbox)");return}for(var f=e.length-1;f>=0;f--)d.renderCheckbox(e[f])},renderAllRadio:function(c){var d=this,e=b.filter(b.query(c+" input"),function(a){if(a.type=="radio")return!0});if(e.length<1){a.log("\u6b64id\u4e0b\u6ca1\u6709input(renderAllRadio)");return}for(var f=e.length-1;f>=0;f--)d.renderRadio(e[f])},renderCheckPro:function(d){var e=this,g=b.get(d),h=b.prop(g,"type")=="checkbox",i=b.parent(g,"label")||b.parent(g,"span");if(!b.hasClass(g,"beautify_input")){a.log("input\u5fc5\u987b\u6709class=\u201dbeautify_input\u201c(renderCheckPro)");return}h?f&&g.checked==1||g.checked?(b.removeClass(i,"radio-checkoff-span"),b.addClass(i,"radio-checkon-span"),b.addClass(b.parent(i),"radio-checkstyle")):(b.removeClass(i,"radio-checkon-span"),b.addClass(i,"radio-checkoff-span"),b.removeClass(b.parent(i),"radio-checkstyle")):f&&g.checked==1||g.checked?(b.removeClass(i,"beautify_radio_off"),b.addClass(i,"beautify_radio_on"),b.addClass(b.parent(i),"radio-checkstyle")):(b.removeClass(i,"beautify_radio_on"),b.addClass(i,"beautify_radio_off"),b.removeClass(b.parent(i),"radio-checkstyle")),c.on(i,"click",function(a){a.stopPropagation();if(a.target.tagName.toUpperCase()=="LABEL")return;e.toggleCheckPro(g)})},renderCheckbox:function(a){var d=this,e=b.get(a),g=b.parent(e,"label")||b.parent(e,"span");if(!b.hasClass(g,"beautify_check"))return;b.append(b.create("<i>&nbsp;</i>"),g),e.disabled==1?f&&e.checked==1||e.checked?g.className="beautify_check c_on_disable":g.className="beautify_check beautify_check_disable":(f&&e.checked==1||e.checked?g.className="beautify_check c_on":g.className="beautify_check c_off",c.on(g,"click",function(a){a.stopPropagation();if(a.target.tagName.toUpperCase()=="LABEL")return;d.toggleCheckbox(e)}))},renderRadio:function(a){var d=this,e=b.get(a),g=b.parent(e,"label")||b.parent(e,"span");if(!b.hasClass(g,"beautify_radio"))return;b.append(b.create("<i>&nbsp;</i>"),g),e.disabled==1?f&&e.checked==1||e.checked?g.className="beautify_radio r_on_disable":g.className="beautify_radio beautify_radio_disable":(f&&e.checked==1||e.checked?g.className="beautify_radio r_on":g.className="beautify_radio r_off",c.on(g,"click",function(a){a.stopPropagation();if(a.target.tagName.toUpperCase()=="LABEL")return;d.toggleRadio(e)}))},setCheckboxOn:function(a){var c=b.get(a),d=b.parent(c,"label");d.className="beautify_check c_on",c.checked=!0},setCheckboxOff:function(a){var c=b.get(a),d=b.parent(c,"label");d.className="beautify_check c_off",c.checked=!1},setCheckboxDisabled:function(a){var c=b.get(a),d=b.parent(c,"label");f&&c.checked==1||c.checked?d.className="beautify_check c_on_disable":d.className="beautify_check beautify_check_disable",c.disabled=!0},setCheckboxNoDisabled:function(a){var c=b.get(a),d=b.parent(c,"label");f&&c.checked==1||c.checked?d.className="beautify_check c_on_disable":d.className="beautify_check beautify_check_disable",c.disabled=!1},toggleCheckbox:function(a){var c=b.get(a),d=b.parent(c,"label");d.className=="beautify_check c_off"?(d.className=="beautify_check c_on_disable"?d.className="beautify_check c_on_disable":d.className="beautify_check c_on",f&&c.click()):d.className=="beautify_check c_on_disable"?(d.className="beautify_check c_on_disable",f&&c.click()):d.className=="beautify_check beautify_check_disable"?(d.className="beautify_check beautify_check_disable",f&&c.click()):(d.className="beautify_check c_off",f&&c.click())},toggleRadio:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(c,"label");if(e.className=="beautify_radio r_off"||c.checked){var g=b.filter(b.query("input"),function(a){if(a.type=="radio")return!0});for(var h=0;h<g.length;h++){var i=b.parent(g[h]);if(i.className.indexOf("beautify_radio")==-1)continue;if(b.attr(g[h],"name")!==d)continue;i.className="beautify_radio r_off"}e.className="beautify_radio r_on",f&&c.click()}else e.className=="beautify_radio beautify_radio_disable"?(e.className="beautify_radio beautify_radio_disable",f&&c.click()):(e.className="beautify_radio r_off",f&&c.click())},setRadioOn:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(c,"label");if(e.className=="beautify_radio r_off"||c.checked){var f=b.filter(b.query("input"),function(a){if(a.type=="radio")return!0});for(var g=0;g<f.length;g++){var h=b.parent(f[g]);if(h.className.indexOf("beautify_radio")==-1)continue;if(b.attr(f[g],"name")!==d)continue;h.className="beautify_radio r_off"}e.className="beautify_radio r_on",c.checked=!0}},toggleCheckPro:function(a){var c=b.get(a),d=b.prop(c,"type")=="checkbox",e=b.attr(c,"name"),g=b.parent(a,"span");if(d)b.hasClass(g,"radio-checkon-span")?(b.removeClass(b.parent(g),"radio-checkstyle"),b.removeClass(g,"radio-checkon-span"),b.hasClass(g,"radio-checkoff-span")||b.addClass(g,"radio-checkoff-span")):(b.addClass(b.parent(g),"radio-checkstyle"),b.toggleClass(g,"radio-checkon-span","radio-checkoff-span"));else if(b.hasClass(g,"beautify_radio_off")){var h=b.filter(b.query(".beautify_input"),function(a){if(a.type=="radio")return!0});for(var c=0;c<h.length;c++){var i=h[c],j=b.parent(h[c]);if(i.className.indexOf("beautify_input")==-1)continue;if(b.attr(i,"name")!==e)continue;j.className="beautify_radio_off",b.removeClass(b.parent(j),"radio-checkstyle")}b.addClass(b.parent(g),"radio-checkstyle"),g.className="beautify_radio_on",f&&c.click()}else b.addClass(b.parent(g),"radio-checkstyle"),g.className="beautify_radio_on",f&&c.click()},setRadioPro:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(a,"span"),f=b.filter(b.query(".beautify_input"),function(a){if(a.type=="radio")return!0});for(var c=0;c<f.length;c++){var g=f[c],h=b.parent(f[c]);if(g.className.indexOf("beautify_input")==-1)continue;if(b.attr(g,"name")!==d)continue;h.className="beautify_radio_off",b.removeClass(b.parent(h),"radio-checkstyle")}b.addClass(b.parent(e),"radio-checkstyle"),e.className="beautify_radio_on",b.get(a).checked=!0},setRadioProOff:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(a,"span"),f=b.filter(b.query(".beautify_input"),function(a){if(a.type=="radio")return!0});for(var c=0;c<f.length;c++){var g=f[c],h=b.parent(f[c]);if(g.className.indexOf("beautify_input")==-1)continue;if(b.attr(g,"name")!==d)continue;h.className="beautify_radio_on"}e.className="beautify_radio_off",b.get(a).checked=!1},setCheckboxProOn:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(a,"span");b.addClass(b.parent(e),"radio-checkstyle"),b.toggleClass(e,"radio-checkon-span","radio-checkoff-span"),b.get(a).checked=!0},setCheckboxProOff:function(a){var c=b.get(a),d=b.attr(c,"name"),e=b.parent(a,"span");b.removeClass(b.parent(e),"radio-checkstyle"),b.removeClass(e,"radio-checkon-span"),b.hasClass(e,"radio-checkoff-span")||b.addClass(e,"radio-checkoff-span"),b.get(a).checked=!1}}),g}),KISSY.add("page/create-init",function(a,b,c,d){var e=a.DOM,f=a.Event;return createGroup={msg:null,rule_num:0,ruleMsg:!1,groupRule:[],groupRule_num:0,leftRule:0,init:function(){f.on("#J_BtnPublish","click",function(a){if(isVersionPer("crm"))return;return createGroup.save(),!1});var a=new d.DatePicker({trigger:".timing",autoRender:!0});f.on(".term","click",function(a){var b=e.attr(a.currentTarget,"data");a.currentTarget.checked==1?e.show(".group_"+b):e.hide(".group_"+b)}),f.on("#J_Stat","click",function(a){ParamsErrorBox=KISSY.one("#J_ParamsErrorBox");var b=function(a){e.show(".J_StatContent"),e.html(".J_StatNum",a.desc)},c=function(a){e.html("#J_ParamsErrorMsg",a.desc),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown()},d="";(new H.widget.asyncRequest).setURI(getMemberCountUrl).setMethod("POST").setForm("#promotion_edit_form").setHandle(b).setErrorHandle(c).setData(d).send()}),createGroup.Form=new c;var g=[{text:"\u4e0d\u9650\u7ea7\u522b",value:"0"},{text:"\u666e\u901a\u4f1a\u5458",value:"1"},{text:"\u9ad8\u7ea7\u4f1a\u5458",value:"2"},{text:"VIP\u4f1a\u5458",value:"3"},{text:"\u81f3\u5c0aVIP\u4f1a\u5458",value:"4"}],h=new b.Select({render:"#J_Member",valueField:"#J_Grade",items:g});h.render(),h.setSelectedValue("0");var g=[{text:"\u5ba2\u6237\u6765\u6e90",value:"0"},{text:"\u4ea4\u6613\u6210\u529f",value:"1"},{text:"\u672a\u6210\u4ea4",value:"2"}],h=new b.Select({render:"#J_MemberSource",valueField:"#J_Source",items:g});h.render(),h.setSelectedValue("0")},save:function(){ParamsErrorBox=KISSY.one("#J_ParamsErrorBox");var a=document.getElementsByName("group_name");if(a[0].value==""){result="\u5206\u7ec4\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a",e.html("#J_ParamsErrorMsg",result),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown();return}var b=e.val("#J_MinCount"),c=e.val("#J_MaxCount");if(b||c)if(isNaN(Number(b))==1||b<0||isNaN(Number(c))==1||b<0)return e.html("#J_ParamsErrorMsg","\u4ea4\u6613\u6b21\u6570\u8981\u5927\u4e8e0"),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown(),error=!0;var d=e.val("#J_MinItems"),f=e.val("#J_MaxItems");if(d||f)if(isNaN(Number(d))==1||d<0||isNaN(Number(f))==1||f<0)return e.html("#J_ParamsErrorMsg","\u5546\u54c1\u4ef6\u6570\u8981\u5927\u4e8e0"),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown(),error=!0;var g=e.val("#J_MinAmount"),h=e.val("#J_MaxAmount");if(g||h){result=H.util.checkPrice(g),result1=H.util.checkPrice(g),error=result[0],error1=result1[0],msg=result[1];if(error||error1){e.html("#J_ParamsErrorMsg",result[1]),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown();return}}var i=e.val("#J_MinAvgPrice"),j=e.val("#J_MaxAvgPrice");if(i||j){result=H.util.checkPrice(i),result1=H.util.checkPrice(j),error=result[0],error1=result1[0],msg=result[1];if(error||error1){e.html("#J_ParamsErrorMsg",result[1]),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown();return}}var k=e.val("#J_MinCloseNum"),l=e.val("#J_MaxCloseNum");if(k||l)if(isNaN(Number(k))==1||k<0||isNaN(Number(l))==1||l<0){e.html("#J_ParamsErrorMsg","\u4ea4\u6613\u5173\u95ed\u6570\u8981\u5927\u4e8e0"),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown();return}var m=e.val("#J_Grade"),n=e.val("#J_MinCount"),o=e.val("#J_MaxCount"),p=e.val("#J_MinAmount"),q=e.val("#J_MaxAmount"),r=e.val("#J_MinAvgPrice"),s=e.val("#J_MaxAvgPrice"),t=e.val("#J_MinCloseNum"),u=e.val("#J_MaxCloseNum"),v=e.val("#J_StartDate"),w=e.val("#J_EndDate"),d=e.val("#J_MinItems"),f=e.val("#J_MaxItems"),x=e.val("#J_Source"),y=m+n+o+p+q+r+s+t+u+v+w+d+f+x;if(y==""||y==0){e.html("#J_ParamsErrorMsg","\u8bf7\u81f3\u5c11\u586b\u5199\u4e00\u4e2a\u6761\u4ef6\uff01"),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown();return}var z=function(a){ParamsErrorBox.hide(),ParamsSucessBox=KISSY.one("#J_ParamsSucessBox"),e.html("#J_ParamsSucessMsg",a.desc),ParamsSucessBox.css("display")==="none"&&ParamsSucessBox.slideDown(),window.location.href=successUrl},A=function(a){e.html("#J_ParamsErrorMsg",a.desc),ParamsErrorBox.css("display")==="none"&&ParamsErrorBox.slideDown()},B="";(new H.widget.asyncRequest).setURI(editorSaveUrl).setMethod("POST").setForm("#promotion_edit_form").setHandle(z).setErrorHandle(A).setData(B).send()}}},{requires:["bui/select","utils/beautifyForm/index","bui/calendar"]}); 